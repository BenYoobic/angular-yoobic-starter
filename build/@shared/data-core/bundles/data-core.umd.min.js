!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common/http"),require("ng2-file-upload"),require("@auth0/angular-jwt"),require("xlsx"),require("file-saver"),require("papaparse"),require("@ionic-native/file-transfer/ngx"),require("@ionic-native/document-viewer/ngx"),require("@ionic-native/device/ngx"),require("@ionic-native/file/ngx"),require("@ionic-native/file-opener/ngx"),require("@ionic-native/onesignal/ngx"),require("@ionic-native/push/ngx"),require("@shared/common"),require("@shared/translate"),require("@shared/stencil"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("lodash-es")):"function"==typeof define&&define.amd?define("data-core",["exports","@angular/common/http","ng2-file-upload","@auth0/angular-jwt","xlsx","file-saver","papaparse","@ionic-native/file-transfer/ngx","@ionic-native/document-viewer/ngx","@ionic-native/device/ngx","@ionic-native/file/ngx","@ionic-native/file-opener/ngx","@ionic-native/onesignal/ngx","@ionic-native/push/ngx","@shared/common","@shared/translate","@shared/stencil","@angular/core","rxjs","rxjs/operators","lodash-es"],t):t(e["data-core"]={},e.ng.common.http,e.ng2FileUpload,e.angularJWT,e.xlsx,e.FileSaver,e.papaparse,e.FileTransfer,e.DocumentViewer,e.Device,e.File,e.FileOpener,e.Onesignal,e.Push,e["@shared/common"],e["@shared/translate"],e.DesignSystem,e.ng.core,e.rxjs,e.rxjs.operators,e["lodash-es"])}(this,function(e,s,i,r,u,n,a,o,l,p,c,d,y,f,g,m,b,h,v,F,T){"use strict";n=n&&n.hasOwnProperty("default")?n["default"]:n;var S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function _(e,t){function o(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var O=function(){return(O=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function A(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(a=(n<3?r(a):3<n?r(t,o,a):r(t,o))||a);return 3<n&&a&&Object.defineProperty(t,o,a),a}function x(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function C(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,r,n=o.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(i=n.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}return a}function D(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}var I=function(){function t(e,t,o){this.localStorage=e,this.coreConfig=t,this.translate=o}return Object.defineProperty(t.prototype,"servers",{get:function(){var e=[{_id:"prod",name:"Production",url:t.PROD_URL},{_id:"sandbox",name:"Sandbox",url:t.SANDBOX_URL},{_id:"demo",name:"Demo",url:t.DEMO_URL},{_id:"demofresh",name:"Demo Fresh",url:t.DEMO_FRESH_URL},{_id:"staging",name:"Staging",url:t.STAGING_URL},{_id:"dev",name:"Development",url:t.DEV_URL},{_id:"dev1",name:"Development 1",url:t.DEV1_URL},{_id:"trial",name:"Trial",url:t.TRIAL_URL},{_id:"e2e",name:"E2E",url:t.E2E_URL}];return this.coreConfig.isUniversal()&&"localhost"!==location.hostname||(e.push({_id:"localhost",name:"Localhost",url:t.LOCALHOST_URL}),e.push({_id:"testpen",name:"Testpen",url:t.TESTPEN_URL})),this.isTestpen&&(e=[{_id:"testpen",name:"Testpen",url:t.TESTPEN_URL}]),this.isSandbox&&(e=[{_id:"sandbox",name:"Sandbox",url:t.SANDBOX_URL}]),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverUrl",{get:function(){return this.isTestpen?t.TESTPEN_URL:this.isSandbox?t.SANDBOX_URL:(e=this.server&&""!==this.server?this.server:t.PROD_URL,this.server=this.localStorage.get("SERVER")||e,this.server);var e},set:function(e){this.localStorage.set("SERVER",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverName",{get:function(){var t=this,e=this.servers.filter(function(e){return e.url===t.serverUrl});return e&&1===e.length?e[0].name:this.translate.get("CUSTOM")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"apiUrl",{get:function(){return this.serverUrl+"api/"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"publicApiUrl",{get:function(){return this.serverUrl+"public/api/"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uploadUrl",{get:function(){return(this.localStorage.get("SERVER_IMAGE")||t.IMAGE_URL)+"ImageContainers/cloudinary/upload"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uploadProxyUrl",{get:function(){return(this.localStorage.get("SERVER_IMAGE")||t.IMAGE_URL)+"cloudinary/uploadProxyImage"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zapierInstagramUrl",{get:function(){switch(this.serverUrl){case t.PROD_URL:return t.ZAPIER_INSTAGRAM_PROD_URL;default:return""}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTestpen",{get:function(){return!this.coreConfig.isUniversal()&&("testpen-dashboard.yoobic.com"===location.hostname||"testpen-mobile.yoobic.com"===location.hostname||this.server===t.TESTPEN_URL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSandbox",{get:function(){return!this.coreConfig.isUniversal()&&("dashboard-sandbox.yoobic.com"===location.hostname||"operations-sandbox.yoobic.com"===location.hostname||"operations-mobile-sandbox.yoobic.com"===location.hostname)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isE2E",{get:function(){return this.serverUrl===t.E2E_URL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProduction",{get:function(){return this.serverUrl===t.PROD_URL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDemo",{get:function(){return this.serverUrl===t.DEMO_URL||this.serverUrl===t.DEMO_FRESH_URL},enumerable:!0,configurable:!0}),t.prototype.getCurrentConfig=function(){var e,t=this,o=this.servers.map(function(e){return{title:e.name,url:e.url,_id:e._id,icon:"yo-servers"}}),i={title:this.translate.get("CUSTOM"),url:null,_id:"custom",icon:"yo-edit"},r=o.filter(function(e){return e.url===t.serverUrl});return e=r.length<=0?(i.url=this.serverUrl,i):r[0],o.unshift(i),{items:o,initialSelection:e,custom:i}},t.PROD_URL="https://api.yoobic.com/",t.SANDBOX_URL="https://api-sandbox.yoobic.com/",t.STAGING_URL="https://yoobic-loopback-staging-v3.herokuapp.com/",t.DEMO_URL="https://api-demo.yoobic.com/",t.DEMO_FRESH_URL="https://yoobic-loopback-demo-fresh.herokuapp.com/",t.DEV_URL="https://yoobic-loopback-dev-v3.herokuapp.com/",t.DEV1_URL="https://yoobic-loopback-dev1-v3.herokuapp.com/",t.LOCALHOST_URL="https://localhost:3000/",t.TESTPEN_URL="https://testpen.yoobic.com/",t.TRIAL_URL="https://yoobic-loopback-trial.herokuapp.com/",t.E2E_URL="https://yoobic-loopback-e2e.herokuapp.com/",t.IMAGE_URL="https://upload.yoobic.com/api/",t.ZAPIER_INSTAGRAM_PROD_URL="https://etl.yoobic.com/flows/zapier_instagram_start",t.decorators=[{type:h.Injectable}],t.ctorParameters=function(){return[{type:g.LocalStorage},{type:g.CoreConfig},{type:m.Translate}]},t}(),t=function(){function e(e,t){this.localForage=e,this.config=t,this.openedChannels=[],this.selectedMissionDescription=null,this.selectedLocation=null}return Object.defineProperty(e.prototype,"apiUrl",{get:function(){return this.config.apiUrl},enumerable:!0,configurable:!0}),e.prototype.clear=function(e){return void 0===e&&(e=!0),e&&(this.token="",this.user=null,this.userId=null,this.tenant=null,this.currencies=[],this.groups=[],this.roles=[],this.hideWalkthrough=!1,this.localPendingBadges={},this.debugEvent=!1),Promise.resolve()},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:g.LocalForageService},{type:I}]},A([g.Persistent("login.hideWalkthrough"),x("design:type",Boolean)],e.prototype,"hideWalkthrough",void 0),A([g.Persistent("badges"),x("design:type",Object)],e.prototype,"localPendingBadges",void 0),A([g.Persistent("debugEvent"),x("design:type",Boolean)],e.prototype,"debugEvent",void 0),e}(),N={PROGRESS:0,VISIBLE:1};N[N.PROGRESS]="PROGRESS",N[N.VISIBLE]="VISIBLE";var E=function _o(e,t){this.type=e,this.value=t},w=function(){function e(){var t=this;this.interval=500,this._progress=0,this._visible=!0,this._intervalCounterId=0,this.observable=new v.Observable(function(e){t.subscriber=e})}return Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(e){b.isPresent(e)&&(0<e&&(this.visible=!0),this._progress=e,this.emitEvent(new E(N.PROGRESS,this._progress)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){b.isPresent(e)&&(this._visible=e,this.emitEvent(new E(N.VISIBLE,this._visible)))},enumerable:!0,configurable:!0}),e.prototype.start=function(e){var t=this;void 0===e&&(e=null),this.isStarting||(this.isStarting=!0,this.complete(),this.visible=!0,this._intervalCounterId=setInterval(function(){t.progress++,100===t.progress&&t.complete()},this.interval),this.isStarting=!1)},e.prototype.complete=function(){var e=this;this._intervalCounterId&&(clearInterval(this._intervalCounterId),this._intervalCounterId=null),this.progress=100,setTimeout(function(){e.visible=!1,e.progress=0},250)},e.prototype.emitEvent=function(e){this.subscriber&&this.subscriber.next(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),k=function(){function i(e,t,o,i,r){this.http=e,this.session=t,this.config=o,this.loadingBar=i,this.coreConfig=r}return i.prototype.fetch=function(t,e){var o=this;return e.body&&"object"==typeof e.body&&(e.body=JSON.stringify(e.body)),!0!==e.noHeader&&(e.headers=this.buildFetchHeaders()),delete e.noHeader,this.slimbarStart(),fetch(t,e).then(function(e){return o.slimbarComplete(),e})["catch"](function(e){return o.slimbarComplete(),o.errorHandler(e,t)})},i.prototype.post=function(t,e,o,i,r,n,a){var s=this;return void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=!1),this.slimbarStart(),a&&(t=this.config.apiUrl+t),this.http.post(t,e?JSON.stringify(e):"",{headers:this.buildHeaders(i,o,null,r,!1,n),observe:"response"}).pipe(F.map(function(e){return s.slimbarComplete(),s.updateToken(e),""===e._body?{}:s.formatResponse(e,i)}),F.catchError(function(e){return s.slimbarComplete(),s.errorHandler(e,t)}))},i.prototype.patch=function(t,e,o,i,r,n,a){var s=this;return void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=!1),this.slimbarStart(),a&&(t=this.config.apiUrl+t),this.http.patch(t,e?JSON.stringify(e):"",{headers:this.buildHeaders(i,o,null,r,!1,n),observe:"response"}).pipe(F.map(function(e){return s.slimbarComplete(),s.updateToken(e),""===e._body?{}:s.formatResponse(e,i)}),F.catchError(function(e){return s.slimbarComplete(),s.errorHandler(e,t)}))},i.prototype.postRaw=function(t,e,o,i){var r=this;return this.slimbarStart(),this.http.post(t,e?JSON.stringify(e):"",{headers:this.buildHeaders(!1,null,null,null,!i),responseType:o?"arraybuffer":"json",observe:"response"}).pipe(F.map(function(e){return r.slimbarComplete(),e}),F.catchError(function(e){return r.slimbarComplete(),r.errorHandler(e,t)}))},i.prototype.postMultiPart=function(e,t){var o=this;this.slimbarStart();var i=new FormData;T.keys(t).forEach(function(e){i.append(e,t[e])});var r=new s.HttpHeaders;return this.http.post(e,i,{headers:r,observe:"response",responseType:"text"}).pipe(F.map(function(e){return o.slimbarComplete(),e.body})).pipe(F.catchError(function(e){throw o.slimbarComplete(),e}))},i.prototype.postFile=function(i,r){var n=this;return this.slimbarStart(),new v.Observable(function(e){var t=new FormData;t.append("file",r,r.name);var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?(e.next(o.response?JSON.parse(o.response):""),e.complete()):e.error(o.response),n.slimbarComplete())},o.open("POST",i,!0),o.setRequestHeader("Authorization","Bearer "+n.session.token),o.setRequestHeader("X-Application-Id",n.coreConfig.getAppId()),o.setRequestHeader("Yoobic-Client-Version",n.coreConfig.getAppVersion()),o.send(t)})},i.prototype.get=function(t,o,e,i,r){var n=this;void 0===o&&(o=!1),this.slimbarStart();var a=new s.HttpParams;return i&&0<i.length&&i.forEach(function(e){a=a.set(e.name,e.value)}),this.http.get(t,{headers:this.buildHeaders(o,e,null,null,r),params:a,observe:"response"}).pipe(F.catchError(function(e){return n.slimbarComplete(),n.errorHandler(e,t)}),F.map(function(e){return n.slimbarComplete(),n.updateToken(e),n.formatResponse(e,o)}))},i.prototype.getBinaryContent=function(t){var o=this;return this.slimbarStart(),this.http.get(t,{responseType:"arraybuffer"}).pipe(F.map(function(e){return o.slimbarComplete(),e})).pipe(F.catchError(function(e){return o.slimbarComplete(),o.errorHandler(e,t)}))},i.prototype.put=function(t,e){var o=this;return this.slimbarStart(),this.http.put(t,e?JSON.stringify(e):null,{headers:this.buildHeaders(),observe:"response"}).pipe(F.map(function(e){return o.updateToken(e),o.slimbarComplete(),e.body}),F.catchError(function(e){return o.slimbarComplete(),o.errorHandler(e,t)}))},i.prototype["delete"]=function(t,e){var o=this;return this.slimbarStart(),this.http.request("delete",t,{headers:this.buildHeaders(),observe:"response",body:e}).pipe(F.map(function(e){return o.updateToken(e),o.slimbarComplete(),e.body}),F.catchError(function(e){return o.slimbarComplete(),o.errorHandler(e,t)}))},i.prototype.downloadFile=function(t,e,o,i){var r=this;return this.slimbarStart(),this.fetch(o,i).then(function(e){return e&&e.blob?e.blob():null}).then(function(e){e&&n(e,t),r.slimbarComplete()})["catch"](function(e){return r.slimbarComplete(),r.errorHandler(e,o)})},i.prototype.saveBlob=function(e,t){n(e,t)},i.prototype.saveArrayBuffer=function(e,t){var o=new Blob([new Uint8Array(e)]);n(o,t)},i.prototype.getFilenameSuffix=function(){return"_"+(new Date).toISOString().replace(".","_")},i.prototype.errorHandler=function(e,t){var o=!1;if(e&&401===e.status&&t&&0<=t.indexOf(this.config.serverUrl)&&e.error&&e.error.error&&("InvalidCredentials"===e.error.error.name||"OnlySsoLoginAllowed"===e.error.error.name||"Only SSO login allowed"===e.error.error.message)&&(o=!0),401===e.status&&t&&0<=t.indexOf(this.config.serverUrl)&&!o&&t.indexOf("getCampaignScore")<0&&e.error&&e.error.error&&e.error.error.name&&"LOGOUT"===e.error.error.name.toUpperCase())i.unauthorizedEmitter.emit(e);else if(413===e.status)i.payloadTooBigEmitter.emit(e);else if(404===e.status)return v.of(new s.HttpResponse({body:{},status:404}));throw e},i.prototype.formatResponse=function(e,t){return void 0===t&&(t=!1),t?{data:e.body,count:+(e.headers.get("x-total-count")||e.headers.get("X-Total-Count")||e.headers.get("x-loose-count")||e.headers.get("X-Loose-Count"))||0}:e.body},i.prototype.buildHeaders=function(e,t,o,i,r,n){void 0===e&&(e=!1);var a=new s.HttpHeaders;return a=(a=(a=(a=a.set("Content-Type",o||"application/json")).set("Accept","application/json")).set("X-Application-Id",this.coreConfig.getAppId())).set("Yoobic-Client-Version",this.coreConfig.getAppVersion()),a=e?(n&&(a=a.set("x-loose-count","true")),a.set("x-total-count","true")):a.set("x-loose-count","true"),!0!==r&&(t?a=i?a.set("token",t):a.set("Authorization","Bearer "+t):this.session.token&&(a=a.set("Authorization","Bearer "+this.session.token))),a},i.prototype.buildFetchHeaders=function(e,t,o,i,r,n){void 0===e&&(e=!1);try{if(!this.coreConfig.isIE11()&&Headers){var a=new Headers;return a.append("Content-Type",o||"application/json"),a.append("Accept","application/json"),a.append("X-Application-Id",this.coreConfig.getAppId()),a.append("Yoobic-Client-Version",this.coreConfig.getAppVersion()),e&&(n&&a.append("x-loose-count","true"),a.append("x-total-count","true")),!0!==r&&(t?i?a.append("token",t):a.append("Authorization","Bearer "+t):this.session.token&&a.append("Authorization","Bearer "+this.session.token)),a}}catch(s){}return this.buildFetchHeadersFallback(e,t,o,i,r,n)},i.prototype.buildFetchHeadersFallback=function(e,t,o,i,r,n){void 0===e&&(e=!1);var a={};return a["Content-Type"]=[o||"application/json"],a.Accept=["application/json"],a["X-Application-Id"]=[this.coreConfig.getAppId()],a["Yoobic-Client-Version"]=[this.coreConfig.getAppVersion()],e&&(n&&(a["x-loose-count"]=["true"]),a["x-total-count"]=["true"]),!0!==r&&(t?i?a.token=[t]:a.Authorization=["Bearer "+t]:this.session.token&&(a.Authorization=["Bearer "+this.session.token])),a},i.prototype.updateToken=function(e){e&&e.url&&0<=e.url.indexOf(this.config.serverUrl)&&e.headers&&e.headers.get("authorization")&&(this.session.token=e.headers.get("authorization"))},i.prototype.slimbarStart=function(){this.loadingBar.start()},i.prototype.slimbarComplete=function(){this.loadingBar.complete()},i.unauthorizedEmitter=new h.EventEmitter,i.payloadTooBigEmitter=new h.EventEmitter,i.decorators=[{type:h.Injectable}],i.ctorParameters=function(){return[{type:s.HttpClient},{type:t},{type:I},{type:w},{type:g.CoreConfig}]},i}(),L=function(){function e(e,t){this.config=e,this.rq=t}return e.prototype.process=function(e,t){var o=this.config.apiUrl+"algorithm/process";return this.rq.post(o,{image_url:e,algorithm_id:t}).pipe(F.catchError(function(e){return v.throwError(e)}),F.map(function(e){return e&&e.results&&e.results||{}}))},e.prototype.processMultiple=function(e,t){var o=this.config.apiUrl+"algorithm/process";return this.rq.post(o,{image_url:e,algorithm_id:t}).pipe(F.catchError(function(e){return v.throwError(e)}),F.map(function(e){return e&&e.results&&e.results||{}}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:I},{type:k}]},e}(),q={chart:"chart",missiondescriptions:"missiondescriptions",missiondatas:"missiondatas",missionhistory:"missionhistory",missionprogress:"missionprogress",missions:"missions",missionservices:"missionservices",addresses:"addresses",healthscore:"healthscore",database:"database"},R=function(){function e(e,t,o){this.localForage=e,this.promise=t,this.log=o}return e.prototype.add=function(t,o,i){var r=this;return this.localForage.get(t).then(function(e){return e=e||{},o&&(e[o]=i),r.localForage.set(t,e)}).then(function(){return i})},e.prototype.get=function(e,t){return v.from(this.localForage.get(e).then(function(e){return(e=e||{})[t]||{}}))},e.prototype.getAll=function(e){return this.localForage.get(e).then(function(t){t=t||{};var o=[];return T.keys(t).forEach(function(e){t[e]&&o.push(t[e])}),o})},e.prototype.remove=function(t,o){var i=this;return v.from(this.localForage.get(t).then(function(e){return delete(e=e||{})[o],i.localForage.set(t,e)}))},e.prototype.getDatabaseCacheKey=function(e){return q.database+"."+e},e.prototype.getDatabaseCollection=function(e){var t=this.getDatabaseCacheKey(e);return this.localForage.get(t).then(function(e){return e||[]})},e.prototype.setDatabaseCollection=function(e,t){var o=this.getDatabaseCacheKey(e);return this.localForage.set(o,t)},e.prototype.updateDatabaseCollection=function(t,o,i,r){var n=this;void 0===i&&(i="_id");var a=this.getDatabaseCacheKey(t);return this.localForage.get(a).then(function(e){return e=e||[],o&&0<o.length&&(e=e.filter(function(t){return o.findIndex(function(e){return e[i]===t[i]})<0})),e=D(e,o),r&&0<r.length&&(e=e.filter(function(t){return r.findIndex(function(e){return e[i]===t[i]})<0})),n.log.log("Syncing Database - Syncing "+t+" done : "+e.length+" entities locally"),n.localForage.set(a,e)})},e.prototype.clearDatabaseCollection=function(e){var t=this.getDatabaseCacheKey(e);return this.log.log("Syncing Database - Clearing "+e),this.localForage.remove(t)},e.prototype.upsertInDatabaseCollection=function(t,o,i,r){var n=this;return void 0===i&&(i=!1),void 0===r&&(r="_id"),o[r]=o[r]||e.OFFLINE_PREFIX+b.getUUID(),this.getByIdFromDatabaseCollection(t,o[r]).then(function(e){return e&&i&&(o=O({},e,o)),n.updateDatabaseCollection(t,[o],r).then(function(){return o})})},e.prototype.removeFromDatabaseCollection=function(t,o,i){var r=this;return void 0===i&&(i="_id"),this.getDatabaseCollection(t).then(function(e){return e=e.filter(function(e){return e[i]!==o}),r.setDatabaseCollection(t,e)})},e.prototype.replaceFromDatabaseCollection=function(t,o,i,r){var n=this;return void 0===r&&(r="_id"),this.getDatabaseCollection(t).then(function(e){return e=D(e=e.filter(function(e){return e[r]!==o}),[i]),n.setDatabaseCollection(t,e)})},e.prototype.getByIdFromDatabaseCollection=function(e,t,o){return void 0===o&&(o="_id"),this.getDatabaseCollection(e).then(function(e){return e.find(function(e){return e[o]===t})})},e.OFFLINE_PREFIX="offline_",e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:g.LocalForageService},{type:g.PromiseService},{type:g.Log}]},e}(),P=function(){function e(e){this.className=e,this.searchableFields=new Array,this.mappingFields=new Map,this._formFields=new Array,this.appearance=new Map}return Object.defineProperty(e.prototype,"formFields",{get:function(){return T.cloneDeep(this._formFields)},set:function(e){this._formFields=e},enumerable:!0,configurable:!0}),e}(),U=["field","tags","groups"],M=["dashboard","admin","manager","team","teamplus","creator","service","supervisor","quora","kiosk","score","nochat","anonymous","stat","todo","serviceuser","polluser","newsuser","newscreator","documentsuser","calendaruser","store","clientadmin","missionanalysis","missionviewer","followup","followupnouser","profilenoedit","workplace","trial","videocall","academy","pharmaone","instagram","taskuser","taskcreator","bi","storeinsights","healthscore","visit","imagereco","productbatch","taskassign","scandit"],B=["manager","creator","quora","academy","academyplus"],j={isAdmin:{type:"roles",operator:"in",group:["admin"]},isClientAdmin:{type:"roles",operator:"in",group:["clientadmin"]},isAdminOrClientAdmin:{type:"roles",operator:"in",group:["admin","clientadmin"]},isNotAdmin:{type:"roles",operator:"nin",group:["admin"]},isNeitherAdminNorClientAdmin:{type:"roles",operator:"nin",group:["admin","clientadmin"]},isManager:{type:"roles",operator:"in",group:["manager"]},isNotManager:{type:"roles",operator:"nin",group:["manager","admin"]},isTeam:{type:"roles",operator:"in",group:["team"]},isWorkplace:{type:"roles",operator:"in",group:["admin","workplace"]},hasTodoOrScore:{type:"roles",operator:"in",group:["todo","score"]},hasTodo:{type:"roles",operator:"in",group:["todo"]},hasScore:{type:"roles",operator:"in",group:["score"]},hasService:{type:"roles",operator:"in",group:["admin","service"]},hasProductBatch:{type:"roles",operator:"in",group:["admin","productbatch"]},hasMemoAssign:{type:"roles",operator:"in",group:["admin","taskassign"]}},G=function(){function l(){}return l.addSearchableField=function(e,t){var o=this.createOrGetModel(e);o.searchableFields.push(t),this.updateModel(e,o)},l.addMappingField=function(e,t,o){var i=this.createOrGetModel(e);i.mappingFields.set(o,t),this.updateModel(e,i)},l.addAppearance=function(e,t,o){var i=this.createOrGetModel(e);i.appearance.set(t,o),this.updateModel(e,i)},l.addFormField=function(e,t){var o=this.createOrGetModel(e),i=o.formFields;(i=i.filter(function(e){return e.name!==t.name})).push(t),o.formFields=i,this.updateModel(e,o)},l.addBaseModel=function(e,t,o){var i=this.createOrGetModel(e),r=this.createOrGetModel(t),n=i.formFields||[],a=[];r.formFields&&r.formFields.map(function(t){n.findIndex(function(e){return e.name===t.name})<0&&a.push(T.cloneDeep(t))}),i.formFields=T.compact(T.union(a,n)),i.searchableFields=T.uniq(T.union(T.cloneDeep(r.searchableFields),i.searchableFields)),i.type=o,this.updateModel(e,i)},l.setCollectionName=function(e,t,o,i,r,n,a,s,l,p){var u=this.createOrGetModel(e);u.collectionName=t,u.fields=o,u.include=i,u.searchSubquery=r,u.type=a,u.feathersService=n,u.isCustom=s,u.detailComponent=l,u.icon=p,u.collectionName&&"tenants"!==u.collectionName&&(u.include=u.include||[],u.include.indexOf("_tenant")<0&&u.include.push("_tenant"),u.fields&&1<u.fields.length&&(u.fields.push("_tenant.name"),u.fields.push("_tenant.title"),u.fields.push("_tenant.icon"))),this.updateModel(e,u)},l.clearCollectionName=function(e){l._models["delete"](e)},l.getModel=function(t){var o;return!0===T.isString(t)?o=this.createOrGetModel(t):l._models.forEach(function(e){e.type&&e.type===t&&(o=e)}),o},l.getModelByCollectionName=function(t){var o;if(l._models.forEach(function(e){e.collectionName===t&&(o=e)}),!o&&t&&t.endsWith("_store")){var e=t.replace("_store","");return"missiondescription"===e&&(e+="s"),l.getModelByCollectionName(e)}return o},l.getFilterableFields=function(e,t,o,i){void 0===i&&(i=!1);var r=[],n=l.getModelByCollectionName(e);n&&n.formFields&&(r=T.cloneDeep(n.formFields)),n&&n.isCustom&&r&&r.forEach(function(e){e.filterable=e.searchable,e.sortable=e.type===b.FormFieldType.date||e.type===b.FormFieldType.datetime||e.type===b.FormFieldType.number,e.type===b.FormFieldType.location&&(e.filterName=e.name+"Ref")}),t&&0<t.length&&t.forEach(function(t){var e=T.findIndex(r,function(e){return e.name===t.name});e<0?r.push(t):r[e]=O({},r[e],t)}),o&&((o=T.cloneDeep(o)).forEach(function(e){e.name+=".value",e.filterable=!0}),r=r.concat(o));var a=T.findIndex(r,function(e){return"_tenant"===e.name});0<=a&&!i&&(r[a].filterable=!1);var s=[];return r.forEach(function(t){s.push(t),t.collectionName&&t.collectionName!==e&&!0===t.filterable&&!0===t.showSubQueryFilters&&l.getModelByCollectionName(t.collectionName).formFields.forEach(function(e){delete(e=T.cloneDeep(e)).advanced,e.filterable=!0,e.icon="yo-tag",t.subQuery&&(e.subQuery=e.subQuery||t.subQuery,e.sessionValues||(e.collectionName=e.collectionName||t.collectionName)),e.subQuery&&(t.subQueryOverride&&(e.subQuery=t.subQueryOverride),e.isSubQuery=!0,e.name=e.collectionName+"_"+e.name,s.push(e))})}),s},l.getFieldName=function(e){var t=e.name+(e.columnDefinition&&e.columnDefinition.name?"."+e.columnDefinition.name:"");return e.columnDefinition&&e.columnDefinition.forceName&&(t=e.columnDefinition.name),t},l.getFieldTitle=function(e,t){var o=e.title||e.name;return o=t.polyglot(o)},l.isBooleanField=function(e){return b.isBooleanField(e)},l.isNumberField=function(e){return b.isNumberField(e)},l.isPhotoField=function(e){return b.isPhotoField(e)},l.isMultiPhotosField=function(e){return b.isMultiPhotosField(e)},l.isPhotoOrMultiPhotosField=function(e){return b.isPhotoOrMultiPhotosField(e)},l.isVideoField=function(e){return b.isVideoField(e)},l.isDateTimeField=function(e){return b.isDateTimeField(e)},l.isIntervalField=function(e){return b.isIntervalField(e)},l.isChartableAutoFieldNoPhoto=function(e){return l.isChartableAutoField(e,!1)},l.isChartableAutoField=function(e,t){switch(void 0===t&&(t=!0),e.type){case b.FormFieldType.checkbox:case b.FormFieldType.toggle:case b.FormFieldType.select:case b.FormFieldType.selectmulti:case b.FormFieldType.selectbuttons:case b.FormFieldType.selectbuttonsmulti:case b.FormFieldType.starrating:case b.FormFieldType.number:case b.FormFieldType.range:case b.FormFieldType.ranking:case b.FormFieldType.formula:return!0;case b.FormFieldType.photo:case b.FormFieldType.multiphotos:return t;case b.FormFieldType.autocomplete:return!e.collectionName||!0!==l.getModel(e.collectionName).isCustom}return!1},l.isMultipleField=function(e){return b.isMultipleField(e)},l.isColoredField=function(e){return b.isColoredField(e)},l.getFieldOperator=function(e){return"fieldselector"===e.type?[{title:"in",_id:"inq"}]:l.isBooleanField(e)?[{title:"equals",_id:"eq"},{title:"notequals",_id:"neq"}]:l.isPhotoField(e)?[{title:"exists",_id:"exists"}]:l.isIntervalField(e)||l.isDateTimeField(e)?[{title:"greaterthan",_id:"gte",interval:!0},{title:"between",_id:"between",interval:!0},{title:"lessthan",_id:"lte",interval:!0},{title:"equals",_id:"eq",interval:!0}]:e.type===b.FormFieldType.autocomplete||e.type===b.FormFieldType.location?[{title:"in",_id:"inq"},{title:"notin",_id:"nin"},{title:"all",_id:"all"}]:[{title:"like",_id:"like"},{title:"notlike",_id:"nlike"},{title:"equals",_id:"eq"},{title:"notequals",_id:"neq"}]},l.getMobileFieldIcon=function(t){var e=[].concat(b.MOBILE_FORM_FIELDS_ALL).filter(function(e){return e.type===t});return e&&0<e.length?e[0].icon:""},l.exportWhere=function(i,e,r){void 0===r&&(r=[]);var t=e.map(function(e){var o=[];return e.forEach(function(e){if((!e.subQuery||e.collectionName===i)&&(!r||r.indexOf(e.field)<0)){var t=l.exportFilterField(e);t&&!T.isEmpty(t)&&o.push(t)}}),0===o.length?null:1===o.length?o[0]:{and:o}});return t&&T.pull(t,null),t&&1===t.length?t[0]:t&&0<t.length?{or:t}:null},l.exportSubQuery=function(t,e,o){var i=this,r=[];return e&&T.isArray(e)&&0<e.length&&e.forEach(function(e){e.forEach(function(e){e.subQuery&&e.collectionName!==t&&r.push({collectionName:i.fixCollectionName(e.collectionName,o),where:l.exportFilterField(e),field:e.subQuery.field,values:e.subQuery.values,leftJoin:e.subQuery.leftJoin})})}),1===r.length?r[0]:1<r.length?r:null},l.exportSearch=function(o,i){if(i&&i.match&&i.match(/^[0-9a-fA-F]{24}$/))return{_id:i};var e=l.getModelByCollectionName(o).searchableFields.map(function(e){var t={};return t[e]="_id"===e&&"groups"!==o?i:{like:i,options:"i"},t});return 1===e.length?e[0]:0<e.length?{or:e}:null},l.fixCollectionName=function(e,t){switch(e){case"missiondescriptions":return t?"missiondescription":e;case"groups":return t?"group":e;case"feedsComments":return t?"feedsComment":e;case"users":return"user";default:return e}},l.getPublicCollectionName=function(e){switch(e){case"locations":return"stores";case"user":case"users":return"users";case"locationtypes":return"store-types";case"missiondescriptions":return"campaigns";case"feeds":return"news";default:return e}},l.getPhotoFromParams=function(e){if(e&&e.node&&e.node.data){var t=e.node.data.toJS?e.node.data.toJS():e.node.data,o=e.colDef.field.replace(".value","");return l.extractPhoto(t[o],t,{},o)}return null},l.getPhotosFromParams=function(e){if(e&&e.node&&e.node.data){var o=e.node.data.toJS?e.node.data.toJS():e.node.data,i=e.colDef.field.replace(".value",""),r=[];return o&&i&&o[i]&&o[i].value&&T.isArray(o[i].value)&&o[i].value.forEach(function(e,t){r.push(l.extractPhoto(e,o,{},i,b.FormFieldType.multiphotos,null,t))}),r}return null},l.getEmptyUrl=function(e){switch(e){case"dashboards":case"dashboard":return"dashboard.svg";case"missions":case"mission":return"mission.svg";case"missiondescriptions":case"missiondescription":case"campaign":return"campaign.svg";case"photos":case"photo":return"photo.svg";case"feeds":case"feed":return"feed.svg";case"files":case"file":return"file.svg";case"locations":case"location":return"location.svg";case"notes":case"note":return"note.svg";case"users":case"user":return"user.svg"}return"empty.svg"},l.extractPhoto=function(e,t,o,i,r,n,a){void 0===n&&(n=!1);var s={};if(e||o&&"image"===o.type&&o.image&&o.image._downloadURL){if(!(e&&e.value&&(e.value.indexOf&&0===e.value.indexOf("http")||b.isImageFile(e.value)))||r&&e.fieldType&&e.fieldType!==r)if(e&&(e.indexOf&&0===e.indexOf("http")||b.isImageFile(e)))if(r&&r===b.FormFieldType.multiphotos){var l=T.get(t,o.name||i),p=l&&l.extraData?l.extraData:{};s={value:e,tags:p[a]?p[a].tags:null,flagged:p[a]?p[a].flagged:null,edit:p[a]?p[a].edit:null,stitch:p[a]?p[a].stitch:null,editBy:p[a]?p[a].editBy:null,editWidth:p[a]?p[a].editWidth:null,editHeight:p[a]?p[a].editHeight:null,texts:p[a]?p[a].texts:[],svgData:p[a]?p[a].svgData:null,isMulti:!0}}else s={value:e};else o&&"image"===o.type&&o.image&&o.image._downloadURL&&(s={name:o.name||i,title:o.title,value:o.image._downloadURL,isImage:!0});else s={value:e.value,comments:e.comments,tags:e.tags,flagged:e.flagged,edit:e.edit,stitch:e.stitch,editBy:e.editBy,editWidth:e.editWidth,editHeight:e.editHeight,texts:e.texts,svgData:e.svgData};if(!T.isEmpty(s))return o&&"image"===o.type||T.assign(s,{title:o.title,name:o.name||i,multiIndex:a,_id:t._id+" _"+(o.name||i),missiondescriptionRef:t.missiondescriptionRef,missiondescription:t.missiondescription,missiondata:t,missiondataRef:t._id,mission:t.mission,missionRef:t.missionRef,userRef:t.userRef,userDisplayname:n?"":t.userDisplayname,address:t.address,location:t.location,validated:t.validated,_acl:t._acl}),o.isImageRecognition&&s.stitch&&(s.value=s.stitch),s}return null},l.getFieldTransform=function(i){return void 0===i&&(i=[]),function t(e){if(e.data&&e.data.forEach){var o=[];e.data.forEach(function(t){var e=l.getFields(t,i);e=e.map(function(e){return T.assign(e,{_id:e.name,name:e.name+".value",operators:l.getFieldOperator(e),slideTitle:t.title})}),o=o.concat(e)}),e.data=o}return e}},l.getFields=function(e,t,o){return void 0===t&&(t=[]),void 0===o&&(o=[]),l.getFieldsFromSlides(e.slides,t,o)},l.getFieldsFromSlides=function(e,i,r){void 0===i&&(i=[]),void 0===r&&(r=[]);var n=[];return e&&e.forEach(function(t,o){t.items&&t.items.forEach(function(e){e.slideTitle=t.title,(!i||0===i.length||0<=i.indexOf(e.type))&&(!r||0===r.length||r.indexOf(e.type)<0)&&(e.slideIndex=o,n.push(e))})}),n},l.exportFilterField=function(e){var t={};if(T.isArray(e.value)&&0===e.value.length)return t;if(e.handleUndefined&&b.isPresent(e.value)&&T.isArray(e.value))if(e.value.indexOf(undefined)<0&&e.value.indexOf("undefined")<0)t[e.field]={},t[e.field][e.operator._id]=e.value;else{var o=t;o[e.field]={},o[e.field][e.operator._id]=T.map(e.value,function(e){return e===undefined||"undefined"===e?null:e})}else{if(t[e.field]={},e.type===b.FormFieldType.address&&e.value&&(T.isArray(e.value)||T.isArray(e.value._geoloc)))t[e.field]={nearSphere:{$geometry:{type:"Point",coordinates:e.value&&e.value._geoloc?e.value._geoloc:e.value},$maxDistance:1e3*e.radius||4e4}};else if("nearSphere"===e.operator._id&&e.value&&(T.isArray(e.value)||T.isArray(e.value._geoloc)))t[e.field]={nearSphere:{$geometry:{type:"Point",coordinates:e.value&&e.value._geoloc?e.value._geoloc:e.value},$maxDistance:e.max||4e4}};else if(e.type===b.FormFieldType.date&&"eq"===e.operator._id)t[e.field].between=[e.value,b.dateFormat(b.dateAdd(e.value,"days",1),"YYYY-MM-dd")];else if(b.isPresent(e.value)){var i=T.isArray(e.value)&&T.isObject(e.value[0])?T.map(e.value,"_id"):T.isArray(e.value)?e.value:T.isObject(e.value)?e.value._id:e.value;e.operator&&"eq"===e.operator._id?t[e.field]=i:t[e.field][e.operator._id]=i}!e.operator||"like"!==e.operator._id&&"nlike"!==e.operator._id||(t[e.field].options="i")}return t},l.createOrGetModel=function(e,t){if((l._models=l._models||new Map).has(e)&&!0!==t)return l._models.get(e);var o=new P(e);return l._models.set(e,o),o},l.updateModel=function(e,t){var o=t.formFields||[];o.findIndex(function(e){return"_tenant"===e.name})<0&&t.collectionName&&"tenants"!==t.collectionName&&o.push({required:!0,name:"_tenant",title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"},suppressExport:!0,visible:!1}),t.formFields=o,l._models.set(e,t)},l._models=new Map,l.decorators=[{type:h.Injectable}],l}(),$=function(){function e(e,t,o,i){this.session=e,this.geoLoc=t,this.config=o,this.rq=i}return Object.defineProperty(e.prototype,"defaultPosition",{get:function(){return this.geoLoc.defaultPosition},enumerable:!0,configurable:!0}),e.prototype.getLocation=function(e){var t=this;if(void 0===e&&(e=!1),this.hasRole("store")&&!this.hasRole("admin")){var o=void 0;if(this.session.user&&this.session.user.location&&this.session.user.location._geoloc?o=Promise.resolve(this.session.user.location):this.session.user&&this.session.user.locationRef?o=this.getLocationEntity(this.session.user.locationRef):this.session.user&&this.session.user.address&&this.session.user.address._geoloc&&(o=Promise.resolve(this.session.user.address)),o)return o.then(function(e){return e&&e._geoloc&&1<e._geoloc.length?(t.session.user.location=e,new g.Position({latitude:e._geoloc[1],longitude:e._geoloc[0]})):null})}return this.geoLoc.getLocation(e)},e.prototype.getDistance=function(e,t,o,i,r){return void 0===r&&(r="K"),this.geoLoc.getDistance(e,t,o,i,r)},e.prototype.getLocationEntity=function(e){var t=this.config.apiUrl+"locations/"+e;return this.rq.get(t).toPromise()},e.prototype.hasRole=function(e){return this.session.roles&&0<=this.session.roles.indexOf(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:t},{type:g.GeoLocation},{type:I},{type:k}]},e}();function H(e){return e?"string"==typeof e?e:e.southwest.lat+","+e.southwest.lng+"|"+e.northeast.lat+","+e.northeast.lng:""}function V(e){return e?"string"==typeof e?e:e.toStringLoc():""}function Q(e){return e?"string"==typeof e?e:e.join("|"):""}function z(e){return e instanceof v.Observable?e:v.from(Promise.resolve(e))}var W=function(){function e(e,t,o,i,r,n){this.rq=e,this.geo=t,this.config=o,this.injector=i,this.network=r,this.cache=n,this.translate=this.injector.get(m.Translate)}return e.prototype.autocompleteFromSync=function(e,t,o,i,r,n,a,s){return void 0===o&&(o=e.length),void 0===i&&(i=1e5),void 0===r&&(r=this.translate.getCurrentLanguage()),void 0===s&&(s=!1),this._autocomplete({input:e,offset:o,location:V(t),radius:i,language:r,types:n,components:a},s)},e.prototype.autocompleteLocationObserver=function(t,o,e,i,r,n,a,s){var l=this;return void 0===o&&(o=t.length),void 0===e&&(e=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===i&&(i=1e3),void 0===r&&(r=this.translate.getCurrentLanguage()),void 0===s&&(s=!1),z(e).pipe(F.map(function(e){return{input:t,offset:o,location:V(e),radius:i,language:r,types:n,components:a}}),F.concatMap(function(e){return l._autocomplete(e,s)}))},e.prototype.autocompleteMultiObserver=function(e,t,o,i,r,n,a,s){var l=this;return void 0===t&&(t=e.pipe(F.map(function(e){return e.length}))),void 0===o&&(o=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===i&&(i=1e3),void 0===r&&(r=this.translate.getCurrentLanguage()),void 0===s&&(s=!1),v.combineLatest(e,t,o).pipe(F.concatMap(function(e){return l._autocomplete(e,s)}))},e.prototype.nearbySearchFromSync=function(e,t,o,i,r,n,a,s,l,p,u){return void 0===t&&(t=1e3),void 0===i&&(i=this.translate.getCurrentLanguage()),this._nearbySearch({location:V(e),radius:t,keyword:o,language:i,name:Q(r),minprice:n,maxprice:a,opennow:s,rankby:l,type:p,types:Q(u)})},e.prototype.nearbySearchNextResults=function(e){return this._nextSearchResults(e)},e.prototype.nearbySearchLocationObserver=function(e,t,o,i,r,n,a,s,l,p,u){var c=this;return void 0===e&&(e=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===t&&(t=1e3),void 0===i&&(i=this.translate.getCurrentLanguage()),z(e).pipe(F.map(function(e){return{location:V(e),radius:t,keyword:o,language:i,name:Q(r),minprice:n,maxprice:a,opennow:s,rankby:l,type:p,types:Q(u)}}),F.concatMap(function(e){return c._nearbySearch(e)}))},e.prototype.nearbySearchMultiObserver=function(e,t,o,i,r,n,a,s,l,p,u){var c=this;return void 0===e&&(e=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===o&&(o=1e3),void 0===i&&(i=this.translate.getCurrentLanguage()),v.combineLatest(t,r,e).pipe(F.concatMap(function(e){return c._nearbySearch(e)}))},e.prototype.geocodeFromSync=function(e,t,o,i,r){return void 0===i&&(i=this.translate.getCurrentLanguage()),this._geocode({address:e,components:Q(t),bounds:H(o),language:i,region:r})},e.prototype.geocodeAddressObserver=function(e,t,o,i,r){var n=this;return void 0===i&&(i=this.translate.getCurrentLanguage()),e.pipe(F.map(function(e){return{address:e,components:Q(t),bounds:H(o),language:i,region:r}}),F.concatMap(function(e){return n._geocode(e)}))},e.prototype.reverseGeocodeFromSyncLocation=function(e,t,o,i){return void 0===t&&(t=this.translate.getCurrentLanguage()),this._reverseGeocode({latlng:V(e),language:t,result_type:o,location_type:i})},e.prototype.reverseGeocodeLatLngObserver=function(e,t,o,i){var r=this;return void 0===e&&(e=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===t&&(t=this.translate.getCurrentLanguage()),z(e).pipe(F.map(function(e){return{latlng:V(e),language:t,result_type:o,location_type:i}}),F.concatMap(function(e){return r._reverseGeocode(e)}))},e.prototype.reverseGeocodeFromSyncPlaceID=function(e,t,o,i){return void 0===t&&(t=this.translate.getCurrentLanguage()),this._reverseGeocode({place_id:e,language:t,result_type:o,location_type:i}).pipe(F.map(function(e){return e[0]}))},e.prototype.reverseGeocodePlaceIDObserver=function(e,t,o,i){var r=this;return void 0===t&&(t=this.translate.getCurrentLanguage()),e.pipe(F.map(function(e){return{place_id:e,language:t,result_type:o,location_type:i}}),F.concatMap(function(e){return r._reverseGeocode(e)}),F.map(function(e){return e[0]}))},e.prototype.placePredictionsLocationObserver=function(t,e,o,i,r,n,a,s,l,p,u,c,d,y){var f=this;return void 0===e&&(e=v.from(this.geo.getLocation().then(function(e){return e.toStringLoc()}))),void 0===o&&(o=this.translate.getCurrentLanguage()),void 0===i&&(i=t.length),z(e).pipe(F.map(function(e){return{input:t,offset:i,location:V(e),radius:r,language:o,types:n,components:a,address:s,search:l,type:p,limit:u,nearbyRadius:c,skipName:d,debug:y}}),F.concatMap(function(e){return f._placePredictions(e)}))},e.prototype.placePredictionsFromSync=function(e,t,o,i,r,n,a,s,l,p,u,c,d,y){return void 0===o&&(o=this.translate.getCurrentLanguage()),void 0===i&&(i=t.length),this._placePredictions({input:t,offset:i,location:V(e),radius:r,language:o,types:n,components:a,address:s,search:l,type:p,limit:u,nearbyRadius:c,skipName:d,debug:y})},e.prototype.nearbyPlaceCodesFromSync=function(e,t,o,i,r,n,a,s,l,p,u,c,d,y,f,g,m){return void 0===i&&(i=this.translate.getCurrentLanguage()),this._nearbyPlaceCodes({location:V(e),radius:t,keyword:o,language:i,name:r,minprice:n,maxprice:a,opennow:s,rankby:l,types:p,address:u,search:c,type:d,limit:y,nearbyRadius:f,skipName:g,debug:m})},e.prototype.resolveAddressLocation=function(e,t,o,i,r,n,a,s){return void 0===t&&(t=this.translate.getCurrentLanguage()),this._resolveAddressLocation({address:e,language:t,search:o,type:i,limit:r,nearbyRadius:n,skipName:a,debug:s})},e.prototype.getCurrentAddresses=function(e){var o=this;return void 0===e&&(e=!1),this.network.isOffline()?this.cache.get(q.addresses,q.addresses).toPromise():this.geo.getLocation(e).then(function(e){return o.reverseGeocodeFromSyncLocation(e).toPromise()}).then(function(e){var t=[];return e&&0<e.length&&(t=e.map(function(e){var t=new g.Position(e.geometry.location);return{address:e.formatted_address,_id:e.id||e.formatted_address,_geoloc:t.toGeoLoc(!0),coords:t.toJson()}})),o.cache.add(q.addresses,q.addresses,t),t})},Object.defineProperty(e.prototype,"apiUrl",{get:function(){return this.config.apiUrl+"GoogleMaps/"},enumerable:!0,configurable:!0}),e.prototype._autocomplete=function(e,t){return this.rq.post(this.apiUrl+"place/autocomplete?query="+t,e).pipe(F.map(function(e){return e.predictions}))},e.prototype._placePredictions=function(e){return this.rq.post(this.apiUrl+"place/predictions",e)},e.prototype._nearbyPlaceCodes=function(e){return this.rq.post(this.apiUrl+"place/nearby-place-codes",e)},e.prototype._resolveAddressLocation=function(e){return this.rq.post(this.apiUrl+"resolve-address-location",e)},e.prototype._nearbySearch=function(e){return this.rq.post(this.apiUrl+"place/nearby",e)},e.prototype._nextSearchResults=function(e){return this.rq.post(this.apiUrl+"place/nearby",{next_page_token:e})},e.prototype._geocode=function(e){return this.rq.post(this.apiUrl+"geocode",e).pipe(F.map(function(e){return e.results}))},e.prototype._reverseGeocode=function(e){return this.rq.post(this.apiUrl+"reverse-geocode",e).pipe(F.map(function(e){return T.isString(e)&&(e=JSON.parse(e)),T.uniqBy(e.results,function(e){return e.formatted_address})}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:$},{type:I},{type:h.Injector},{type:g.Network},{type:R}]},e}(),Y=function(){function e(e,t){this.rq=e,this.config=t}return Object.defineProperty(e.prototype,"apiUrl",{get:function(){return this.config.apiUrl+"workplace/"},enumerable:!0,configurable:!0}),e.prototype.getAllGroups=function(){var e=this.apiUrl+"getGroups";return this.rq.post(e,{query:{limit:20,fields:"icon, name, cover, description"}}).pipe(F.map(function(e){return e.data.forEach(function(e){return e._id=e.id}),e}))},e.prototype.postOnGroup=function(e,t){var o=this.apiUrl+"post";return this.rq.post(o,{groupIds:e,options:t})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:I}]},e}(),K=function(){function e(e,t,o,i){this.rq=e,this.coreConfig=t,this.log=o,this.config=i}return e.prototype.isFile=function(e){return b.isFile(e)},e.prototype.isBase64=function(e){return b.isBase64(e)},e.prototype.isFileUri=function(e){return b.isFileUri(e)},e.prototype.isImageFile=function(e){return b.isImageFile(e)},e.prototype.read=function(e,t,o){return void 0===t&&(t="blob"),b.read(e,t,o)},e.prototype.getExtension=function(e){return b.getExtension(e)},e.prototype.changeExtension=function(e,t){return b.changeExtension(e,t)},e.prototype.getMaxSize=function(e){return b.getMaxSize(e)},e.prototype.toPng=function(e){return b.toPng(e)},e.prototype.isValid=function(e){return b.isValid(e)},e.prototype.isImage=function(e){return b.isImage(e)},e.prototype.isVideo=function(e){return b.isVideo(e)},e.prototype.isAudio=function(e){return b.isAudio(e)},e.prototype.isDocument=function(e){return b.isDocument(e)},e.prototype.getType=function(e){return b.getType(e)},e.prototype.getMimeType=function(e){return b.getMimeType(e)},e.prototype.getIcon=function(e){return b.getIcon(e)},e.prototype.getVideoPoster=function(e){return b.getVideoPoster(e)},e.prototype.b64toBlob=function(e,t,o){return void 0===t&&(t=null),void 0===o&&(o=512),b.b64toBlob(e,t,o)},e.prototype.blobToFile=function(e){return b.blobToFile(e)},e.prototype.b64ToFile=function(e,t){return b.b64ToFile(e,t)},e.prototype.saveBase64AsImageFile=function(e){return b.saveBase64AsImageFile(e)},e.prototype.resizeBase64Image=function(e,t,o){return b.resizeBase64Image(e,t,o)},e.prototype.getBase64MimeType=function(e){return b.getBase64MimeType(e)},e.prototype.getBase64Extension=function(e){return b.getBase64Extension(e)},e.prototype.resizeImage=function(e,t,o){return b.resizeImage(e,t,o)},e.prototype.getNativeDirectory=function(e){return b.getNativeDirectory(e)},e.prototype.resolveFilePath=function(e){return b.resolveFilePath(e)},e.prototype.fixImageOrientation=function(e,t){return b.fixImageOrientation(e,t)},e.prototype.moveToImageDirectory=function(e,t){return void 0===t&&(t=!1),b.moveToImageDirectory(e,t)},e.prototype.moveToImageDirectoryBase=function(e,t,o,i){return b.moveToImageDirectoryBase(e,t,o,i)},e.prototype.fileNativeWriteFile=function(e,t,o,i){return b.fileNativeWriteFile(e,t,o,i)},e.prototype.fileNativeCheckFile=function(e,t){return b.fileNativeCheckFile(e,t)},e.prototype.fixAbsolutePath=function(e){return b.fixAbsolutePath(e)},e.prototype.getCloudinaryUrl=function(e){return b.getCloudinaryUrl(e)},e.prototype.downloadFile=function(e,t,o,i){return this.rq.downloadFile(e,t,o,i)},e.prototype.getLocalFilePath=function(){return b.getLocalFilePath()},e.prototype.getLocalFileName=function(e){return b.getLocalFileName(e)},e.prototype.saveToLocalFile=function(e,t){return b.saveToLocalFile(e,t)},e.prototype.getUrlWithAnnotations=function(e,t){return b.getUrlWithAnnotations(e,t)},e.prototype.cleanFileName=function(e){return b.cleanFileName(e)},e.prototype.downloadFileToDevice=function(e,t){return b.downloadFileToDevice(e,t)},e.prototype.showPdfOnDevice=function(e,t){return void 0===t&&(t=null),b.showPdfOnDevice(e,t)},e.prototype.uploadProxy=function(e){var t=this,o=this.config.uploadProxyUrl;return this.rq.post(o,{url:e}).pipe(F.map(function(e){return t.getCloudinaryUrl({cloudinary:e})}))},e.prototype.exportToFile=function(e,t,o,i){i=i||"data.csv",t=t||"data:application/csv;charset=ISO-8859-1;","base64"===(o=o||"charset=ISO-8859-1")&&(e=this.b64toBlob(e,t));var r=new Blob([e],{type:t});return this.rq.saveBlob(r,i)},e.prototype.openBlob=function(e,t,o){return b.openBlob(e,t,o)},e.prototype.afterOpenBlob=function(e,t){return b.afterOpenBlob(e,t)},e.prototype._requestExternalStoragePermission=function(){var n=this;return new Promise(function(o,i){if(n.coreConfig.isAndroid()&&n.coreConfig.isCordova()){var r=window.cordova.plugins.permissions;r.hasPermission(r.READ_EXTERNAL_STORAGE,function(e){if(e.hasPermission)o(!0);else{var t=function(){n.log.error("Storage permission is not turned on"),i(!1)};r.requestPermission(r.READ_EXTERNAL_STORAGE,function(e){e.hasPermission?o(!0):t()},t)}})}else o(!0)})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:g.CoreConfig},{type:g.Log},{type:I}]},e}(),J=function(){function e(e,t,o){this.config=e,this.rq=t,this.coreConfig=o}return e.prototype.upload=function(e){var t=this.config.apiUrl+"businesslogic/uploadToBox";return this.rq.post(t,{params:{documentUrl:e}}).pipe(F.map(function(e){return e&&e.data?e.data.id:null}))},e.prototype.createViewingSession=function(e){var t=this.config.apiUrl+"businesslogic/createViewingSessionBox";return this.rq.post(t,{params:{boxId:e}}).pipe(F.map(function(e){return e&&e.data?e.data:null}))},e.prototype.getViewingContent=function(e){var n=this,t=this.config.apiUrl+"businesslogic/getViewingContentBox";return this.rq.post(t,{params:{contentUrl:e}}).pipe(F.map(function(e){if(e&&e.data){var t=e.data,o=t.indexOf("<head>")+6,i='<style type="text/css">';i+=".controls-center .scroll-previous-btn, .controls-center .scroll-next-btn, .controls-right .zoom-in-btn, .controls-right .zoom-out-btn, .controls-right {",i+="  display: initial !important;",i+="}",i+=".fullscreen-btn {",i+="  display: none !important;",i+="}",i+="</style>";var r=n.coreConfig.getProtocol();return t=(t=(t=[t.slice(0,o),i,t.slice(o)].join("")).replace(new RegExp('href="//',"g"),'href="'+r+"//")).replace(new RegExp('src="//',"g"),'src="'+r+"//")}return null}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:I},{type:k},{type:g.CoreConfig}]},e}(),X=function(){function e(e,t){this.rq=e,this.coreConfig=t}return e.prototype.getAll=function(t,e,o){var i;return t?(i="https://api.unsplash.com/search/photos?client_id="+this.coreConfig.getKey("unsplashAccessKey"),i+="&query="+t,i+="&page="+(e/o+1),i+="&per_page="+o):i="https://api.unsplash.com/photos?page=1&per_page=20&client_id="+this.coreConfig.getKey("unsplashAccessKey"),this.rq.get(i,null,null,null,!0).pipe(F.map(function(e){return(t?e.results:e).map(function(e){return{_id:e.id,title:e.description,value:e.urls.raw,thumb:e.urls.thumb}})}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:g.CoreConfig}]},e}(),Z=function Oo(){},ee=function(){function e(e,t,o,i,r,n,a,s,l,p,u,c,d,y,f,g,m,h){this.rq=e,this.box=t,this.googlemaps=o,this.workplace=i,this.session=r,this.files=n,this.promise=a,this.coreConfig=s,this.log=l,this.network=p,this.transfer=u,this.localForage=c,this.config=d,this.injector=y,this.cache=f,this.geoloc=g,this.translate=m,this.unsplash=h,this.init()}return e.prototype.init=function(){},e.prototype.getApiUrl=function(){return this.config.apiUrl},e.prototype.getServerUrl=function(){return this.config.serverUrl},e.prototype.getCollectionName=function(e){var t=G.getModelByCollectionName(e);return t&&t.isCustom?"custommodelinstances":e},e.prototype.getById=function(e,t,o,i,r){var n=this.getQuery(e,o,i);if(delete n.limit,delete n.skip,delete n.order,delete n.subQuery,this.network.isOffline())return v.from(this.cache.getByIdFromDatabaseCollection(e,t,r));if(r&&"_id"!==r){var a=[[{field:r,operator:{_id:"eq"},value:t}]];return this.getAll(e,o,i,null,a).pipe(F.map(function(e){return e.data&&0<e.data.length?e.data[0]:null}))}var s=this.config.apiUrl+this.getCollectionName(e)+"/"+t+"?filter="+encodeURIComponent(JSON.stringify(n));return this.rq.get(s)},e.prototype.create=function(e,t){var o=this.config.apiUrl+this.getCollectionName(e);return this.updateCustomModel(e,t),this.network.isOffline()?v.from(this.cache.upsertInDatabaseCollection(e,t)):this.rq.post(o,t)},e.prototype.update=function(e,t){if(this.network.isOffline()||this.isOfflineEntity(t))return v.from(this.cache.upsertInDatabaseCollection(e,t));if("groups"!==e)return t._id?this.patch(e,t):this.create(e,t);var o=this.config.apiUrl+this.getCollectionName(e);return this.updateCustomModel(e,t),this.rq.put(o,t)},e.prototype.save=function(t,e,o){var i=this;return this.network.isOffline()||this.isOfflineEntity(e)?v.from(this.cache.upsertInDatabaseCollection(t,e)):this.upsert(t,e).pipe(F.mergeMap(function(e){return i.getById(t,e._id,o)}))},e.prototype.patch=function(e,t){if(!t||!t._id)throw new Error("Cant patch an empty entity or an entity without an id");if(this.updateCustomModel(e,t),this.network.isOffline()||this.isOfflineEntity(t))return v.from(this.cache.upsertInDatabaseCollection(e,t,!0));var o=this.config.apiUrl+this.getCollectionName(e)+"/"+t._id;return this.rq.patch(o,t)},e.prototype.upsert=function(i,e,t,o){var r=this;o||this.setAcl(e,e.group,!1,i),this.incrementTags(i,e).subscribe(function(){});var n="missiondatas"===i?[".value",".edit",".value.fieldValue"]:["._downloadURL",".edit"],a=this._hasFiles(e,n);return this.network.isOffline()||!a?this.update(i,e):new v.Observable(function(o){r.uploadEntityFiles(e,n).then(function(){r.update(i,e).subscribe(function(t){t._downloadURL&&r.files.isDocument(t._downloadURL)?r.box.upload(t._downloadURL).subscribe(function(e){e&&(t.boxId=e),r.update(i,t).subscribe(function(e){o.next(e),o.complete()})}):(o.next(t),o.complete())})},function(e){})})},e.prototype.upsertAll=function(t,e){var o=this,i=e.map(function(e){return o.upsert(t,e)});return v.forkJoin(i)},e.prototype.uploadEntityFiles=function(r,e,n,a,t,s){var l=this;void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===s&&(s=0);var p=this._getFileProperties(r,e),u=0,o=p.map(function(t){var o,i,e=T.get(r,t);return o=u,i=p.length,u+=1,function(){return l.prepareUpload(e).then(function(e){return l.upload(e,n,o,i,a,s)}).then(function(e){T.set(r,t,e)})["catch"](function(e){return Promise.reject(e)})}});return t?0<o.length?o:[function(){return Promise.resolve("empty")}]:this.promise.sequential(o)},e.prototype.uploadEntitiesFiles=function(e,t,o,i){var r=this;void 0===t&&(t=[]);var n=e.map(function(e){return function(){return r.uploadEntityFiles(e,t,o,i,!1)}});return this.promise.sequential(n)},e.prototype.prepareUpload=function(e){var t=this;return this.files._requestExternalStoragePermission().then(function(){return t.files.isBase64(e)?Promise.resolve(t.files.b64toBlob(e)):t.files.isFileUri(e)?t.files.resolveFilePath(e):Promise.resolve(e)})},e.prototype.updateAll=function(e,t,o){var i=T.assign({},t.where);t.subQuery&&(i.__options={subQuery:t.subQuery}),o.group&&(o["_acl.groups.r"]=o.group);var r=this.config.apiUrl+this.getCollectionName(e)+"/update?where="+encodeURIComponent(JSON.stringify(i));return this.rq.post(r,o)},e.prototype.setAcl=function(e,t,o,i,r){void 0===o&&(o=!1),e._acl=e._acl||{groups:{r:[],w:[]}},e._acl.creator=e._acl&&e._acl.creator?e._acl.creator:this.session.user?this.session.user._id:null,e._acl.groups=e._acl&&e._acl.groups?e._acl.groups:{},t&&(e._acl.groups.r=T.uniq([].concat(t).concat(e._acl.groups.r))),e._acl.groups.r=T.compact(e._acl.groups.r),e._acl.groups.w=T.compact(T.uniq([].concat(e._acl.groups.w||[]))),"translations"===i&&t&&(e._acl.groups.r=T.uniq([].concat(t)),e._acl.groups.w=T.uniq([].concat(t))),o&&t&&(e._acl.groups.w=T.compact(T.uniq([].concat(t).concat(e._acl.groups.w)))),r&&0<r.length&&(e._acl.groups.r=e._acl.groups.r.concat(r))},e.prototype.getCurrentGroups=function(){return this.session.roles.indexOf("admin")<0?this.session.groups:["debug_v2"]},e.prototype.updateCustomModel=function(e,t){var o=G.getModelByCollectionName(e);o&&o.isCustom&&(t._modelName=e,t.location&&t.location._id&&(t.locationRef=t.location._id))},e.prototype.upload=function(e,i,r,s,o,l){var p=this;if(void 0===r&&(r=0),void 0===s&&(s=1),void 0===o&&(o=[]),void 0===l&&(l=0),o=T.concat([this.session.userId],o),this.coreConfig.isCordova()&&e.nativeURL){var t=this.transfer.create();return i&&t.onProgress(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100/(s+l)+100*r/(s+l);i.next(t)}}),t.upload(e.nativeURL,this.config.uploadUrl,{fileKey:"file",fileName:e.name,chunkedMode:!1,params:{tags:o}}).then(function(e){var t=JSON.parse(e.response);return p.files.getCloudinaryUrl(t)})["catch"](function(e){var t=e&&e.message?e.message:"File Error";return Promise.reject(t)})}var u=this.getFileUploader(null);return new Promise(function(n,a){u.onBuildItemForm=function(e,t){t.append("tags",JSON.stringify(o))},u.onCompleteItem=function(e,t,o,i){if(p.log.log("upload finish"),u.clearQueue(),200===o){var r=JSON.parse(t);n(p.files.getCloudinaryUrl(r))}else a(t?JSON.parse(t):"error")},i&&(u.onProgressItem=function(e,t){var o=t/(s+l)+100*r/(s+l);i.next(o)}),u.addToQueue([e]),u.queue[0].alias="undefined",p.log.log("upload begin"),u.uploadAll()})},e.prototype.uploadData=function(e,t,o,i){void 0===o&&(o=0),void 0===i&&(i=1);var r=this.files.b64toBlob(e);return this.upload(r,t,o,i)},e.prototype.incrementTags=function(e,t){if(t.tags&&0<t.tags.length&&(t.tags=T.uniq(T.compact([].concat(t.tags))),0<t.tags.length&&!this.network.isOffline())){var o=this.config.apiUrl+"tags/incrementTags";return this.rq.post(o,{params:{collectionName:G.fixCollectionName(e),tags:t.tags,groups:[].concat(t.group||t._acl.groups.r),entity:t}})}return v.of(null)},e.prototype.updateTags=function(e){var t=this.config.apiUrl+"tags/updateTags";return this.rq.post(t,{params:{collection:e}})},e.prototype.createAllTags=function(){var e=this.config.apiUrl+"businessLogic/createAllTags";return this.rq.post(e,{params:{}})},e.prototype["delete"]=function(e,t){if(this.isOfflineId(t))return v.from(this.cache.removeFromDatabaseCollection(e,t));var o=this.config.apiUrl+this.getCollectionName(e)+"/"+encodeURIComponent(t);return this.rq["delete"](o)},e.prototype.deleteAll=function(e,t){var o=this.config.apiUrl+this.getCollectionName(e),i=T.assign({},t.where||{_id:{exists:!0}});return t.subQuery&&(i.__options={subQuery:t.subQuery}),this.rq["delete"](o,i)},e.prototype.getQuery=function(e,t,o,i,r,n,a,s,l,p){void 0===a&&(a=0),void 0===s&&(s=20),void 0===l&&(l=null),void 0===p&&(p=null);var u=G.getModelByCollectionName(e);u&&(t=t&&0<t.length?t:u.fields,o=o||u.include,u&&u.isCustom&&((!r||T.isArray(r)&&r.length<1)&&(r=[[]]),T.isArray(r)&&(r=T.cloneDeep(r)).forEach(function(e){e.push({field:"_modelName",operator:{_id:"eq"},value:u.collectionName})})));var c={};a&&0<a&&(c.skip=a),s&&0<s&&(c.limit=s),n&&0<n.length?c.order=n.filter(function(e){return T.isString(e)||e.colId&&e.sort}).map(function(e){return T.isString(e)?e:e.colId+" "+(e.sort?e.sort.toUpperCase():"ASC")}):n&&0===n.length?c.order=[]:c.order=["_lmt DESC"];var d=null,y=null;i&&u&&!u.searchSubquery&&(d=G.exportSearch(e,i)),r&&T.isArray(r)&&0<r.length?y=G.exportWhere(e,r):r&&!T.isArray(r)&&T.isObject(r)&&(y=r),d&&y?c.where={and:[d,y]}:d?c.where=d:y&&(c.where=y),p&&c.where?c.where={and:[c.where,p]}:p&&(c.where=p),t&&0<t.length&&(c.fields=t),T.isEmpty(o)||(c.include=o),l&&(c.subQuery=l);var f=G.exportSubQuery(e,r);return f&&(c.subQuery?c.subQuery=[].concat(c.subQuery,f):c.subQuery=f),i&&u&&u.searchSubquery&&(d=G.exportSearch(u.searchSubquery.collectionName,i),c.subQuery?c.subQuery&&!T.isArray(c.subQuery)&&c.subQuery.where&&(c.subQuery.where={and:[d,c.subQuery.where]}):c.subQuery={collectionName:u.searchSubquery.collectionName,field:u.searchSubquery.field,values:u.searchSubquery.values,where:d}),c},e.prototype.getCount=function(t,o,i,e,r,n){var a=this;if(void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=!1),this.network.isOffline())return this.getAllOffline(t,!1,o,i,null,null,null,r,!1).pipe(F.map(function(e){return{count:e.count,data:[]}}));var s,l=this.getQuery(t,null,null,o,i,null,null,null,e,r),p=this.config.apiUrl+this.getCollectionName(t)+"/count",u={};return l.where&&(u.where=l.where),l.subQuery&&(u.subQuery=l.subQuery),this.rq.post(p,u).pipe(F.mergeMap(function(e){return s=e,n?v.of([]):v.from(a.getAllOffline(t,!0,o,i,null,null,null,r))})).pipe(F.map(function(e){var t=s||0;return e&&0<e.count&&(t+=e.count),{count:t,data:[]}}))},e.prototype.getAll=function(t,e,o,i,r,n,a,s,l,p,u,c,d,y,f){var g=this;if(void 0===a&&(a=0),void 0===s&&(s=20),void 0===l&&(l=!1),void 0===p&&(p=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===y&&(y=!1),void 0===f&&(f=!1),"googlemaps"===t)return this.getAllGoogleMaps(i);if(0<=t.indexOf("workplace_"))return this.getAllWorkplace(t,i);if("unsplash"===t)return this.getAllUnsplash(i,a,s);if(!0===l)return this.getAllTags(t,i,r,a,s);var m=this.getQuery(t,e,o,i,r,n,a,s,p,u);if(0<=t.indexOf("_store"))return this.getAllOperation(t,m);var h;return this.network.isOffline()?c?v.from(this.localForage.get(c)).pipe(F.map(function(e){return e||(y?[]:{count:0,data:[]})})):this.getAllOffline(t,!1,i,r,n,a,s,u,y):this.getAllQuery(t,m,d,y).pipe(F.mergeMap(function(e){return h=e,c&&g.localForage.set(c,e),f?v.of([]):v.from(g.getAllOffline(t,!0,i,r,n,a,s,u,y))})).pipe(F.map(function(e){return y?h=D(e||[],h||[]):h.data=D(e.data||[],h.data||[]),h}))},e.prototype.getAllTags=function(e,t,o,i,r,n){if(void 0===i&&(i=0),void 0===r&&(r=20),void 0===n&&(n=!1),o=o||[[]],"locations"===e&&(o=o.map(function(e){return e.filter(function(e){return"_geoloc"!==e.field})})),this.network.isOffline())return this.getAllTagsOffline({collectionName:e,search:t,filters:o});if(n){var a=[{$match:{collectionName:G.fixCollectionName(e)}},{$group:{_id:"$tag",count:{$max:"$count"}}},{$sort:{count:-1}},{$project:{_id:1,tag:"$_id",count:1}},{$group:{_id:1,total:{$sum:1},data:{$push:"$$ROOT"}}},{$project:{count:"$total",data:{$slice:["$data",i,i+r]}}}];return this.aggregateQuery("tags",o,a,t).pipe(F.map(function(e){return e&&0<e.length?{data:e[0].data,count:e[0].count}:{data:[],count:0}}))}a=[{$unwind:"$tags"}];return t&&a.push({$match:{tags:{$regex:t.replace(/([^a-z0-9]+)/gi,""),$options:"i"}}}),a=a.concat(D([{$group:{_id:"$tags",count:{$sum:1}}},{$sort:{count:-1}},{$project:{_id:1,tag:"$_id",count:1}}],0<i?[{$skip:i}]:[],0<r?[{$limit:r}]:[])),this.aggregateQuery(e,o,a).pipe(F.map(function(e){return void 0===e&&(e=[]),{data:e,count:e.length}}))},e.prototype.getAllTagsOffline=function(i){return this.getAllOffline(i.collectionName,!1,i.search,i.filters,null,null,null,null,!0).pipe(F.map(function(e){var t=[],o={};return e&&0<e.length&&(e.forEach(function(e){e.tags&&[].concat(e.tags).forEach(function(e){o[e]=0<o[e]?o[e]+1:1})}),T.keys(o).forEach(function(e){t.push({_id:e,tag:e,count:o[e]})}),t=T.orderBy(t,function(e){return-e.count})),{data:t,count:t.length,config:i}}))},e.prototype.getMultipleAllTags=function(o,e,t){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=20),this.network.isOffline()){var r=o.map(function(e){return i.getAllTagsOffline(e)});return v.combineLatest(r).pipe(F.map(function(e){return e}))}var n=D([{$unwind:"$tags"},{$group:{_id:"$tags",count:{$sum:1}}},{$sort:{count:-1}},{$project:{_id:1,tag:"$_id",count:1}}],0<e?[{$skip:e}]:[],0<t?[{$limit:t}]:[]),a=o.map(function(e){var t=e.filters||[];return"locations"===e.collectionName&&(t=t.map(function(e){return e.filter(function(e){return"_geoloc"!==e.field})})),i.getAggregateQuery(e.collectionName,t,n,e.search,null,null,null,e.subQuery)});return this.aggregateQueries(a).pipe(F.map(function(e){return e.map(function(e,t){return{data:e,count:e.length,config:o[t]}})}))},e.prototype.getAllQuery=function(e,t,o,i){var r=this.config.apiUrl+this.getCollectionName(e)+"/find";return this.rq.post(r,{filter:t},null,!i,!1,o)},e.prototype.getAllGoogleMaps=function(e){return e?this.googlemaps.placePredictionsLocationObserver(e).pipe(F.map(function(e){var t=T.flatten(e).filter(function(e){return e.geometry&&e.geometry.location});return{count:t.length,data:t.map(function(e){var t=new g.Position(e.geometry.location);return{address:e.formatted_address,_id:e.id,_geoloc:t.toGeoLoc(!0),coords:t.toJson()}})}})):v.from(this.googlemaps.getCurrentAddresses(!0)).pipe(F.map(function(e){return{count:e.length,data:e}}))},e.prototype.getAllUnsplash=function(e,t,o){return this.unsplash.getAll(e,t,o)},e.prototype.getAllWorkplace=function(e,t){switch(e.replace("workplace_","")){case"groups":return this.workplace.getAllGroups()}return v.of({count:0,data:[]})},e.prototype.getAllOperation=function(e,t){var o=this.config.apiUrl+"Operation/findDocument";return this.rq.post(o,{collectionName:G.fixCollectionName(e.replace("_store",""),!0),where:t.where,limit:t.limit,skip:t.skip},null,!0).pipe(F.map(function(e){return e.data&&e.data.map&&(e.data=e.data),e}))},e.prototype.syncDatabase=function(a,s){var l=this,p=this.coreConfig.getSyncedCollections();if(p&&0<p.length){this.log.log("Syncing Database - Start");var e=p.map(function(r,n){return function(){if(!(r.max<=0))return l.log.log("Syncing Database - Syncing "+r.name),l.cache.getDatabaseCollection(r.name).then(function(i){var e=T.cloneDeep(r.filters||[[]]);return e.forEach(function(e){return e.forEach(function(e){e.value&&T.isArray(e.value)&&0<=e.value.indexOf("currentLanguage")&&(e.value[e.value.indexOf("currentLanguage")]=l.translate.getCurrentLanguage())})}),a&&0<i.length&&e.forEach(function(e){return e.push({field:"_lmt",operator:{_id:"gte"},value:a})}),l.getAll(r.name,r.fields,null,null,e,null,0,Math.min(r.max||1e3,1e3),null,null,null,null,null,null,!0).toPromise().then(function(e){if(s&&s.emit(n/p.length*100),e&&e.data){var t,o=[Promise.resolve(null)];return a&&(o=[l.getDeletedEntities(r.name,i).toPromise().then(function(e){t=e})]),r.addToCache&&0<r.addToCache.length&&r.addToCache.forEach(function(t){e.data.forEach(function(e){e[t]&&o.push(function(){return b.cacheFile(e[t])})})}),Promise.all(o).then(function(){return l.cache.updateDatabaseCollection(r.name,e.data,"_id",t)})}})})}});return this.promise.sequential(e).then(function(e){return s&&s.emit(100),e})}return Promise.resolve(null)},e.prototype.clearDatabase=function(){var t=this,e=this.coreConfig.getSyncedCollections();if(e&&0<e.length){var o=e.map(function(e){return function(){return t.cache.clearDatabaseCollection(e.name)}});return this.promise.sequential(o)}return Promise.resolve(null)},e.prototype.getDeletedEntities=function(e,t){t=t||[];var o=this.config.apiUrl+"businesslogic/getDeletedIds",i=G.fixCollectionName(e,!0);return this.rq.post(o,{modelName:i,ids:t.map(function(e){return e._id})}).pipe(F.map(function(e){return e&&e||[]}))},e.prototype.getOfflineEntitiesCount=function(){return this.uploadDatabaseOrGetCount(!0)},e.prototype.uploadDatabase=function(e){return this.uploadDatabaseOrGetCount(!1,e)},e.prototype.uploadDatabaseOrGetCount=function(o,i){var r=this,n=0,a=0,s={};if(this.isUploadingDatabase&&!this.network.isOffline())return Promise.resolve(o?0:null);this.isUploadingDatabase=!0;var l=this.coreConfig.getSyncedCollections();return this.cache.getDatabaseCollection("custommodels").then(function(e){if(l&&0<l.length){var t=(l=(l=T.cloneDeep(l)).concat(e.map(function(e){return{name:e.name}}))).map(function(t){return function(){return r.cache.getDatabaseCollection(t.name).then(function(e){e=e.filter(function(e){return r.isOfflineEntity(e)&&"draft"!==e.status}),s[t.name]=e,n+=e.length})}});return r.promise.sequential(t).then(function(){if(o)return r.isUploadingDatabase=!1,n;r.log.log("uploadDatabase","total",n),i&&i.emit(0<n?a/n*100:0);var t=[];return 0<n&&l.forEach(function(o){s[o.name].forEach(function(e){t.push(function(){var t=e._id;return delete(e=O({},e))._id,r.upsert(o.name,e).toPromise().then(function(e){return a+=1,i&&i.emit(a/n*100),r.log.log("uploadDatabase","count",a),r.cache.replaceFromDatabaseCollection(o.name,t,e)})})})}),r.promise.sequential(t).then(function(){return setTimeout(function(){i&&i.emit(100)},300),r.isUploadingDatabase=!1,n})})}})},e.prototype.isOfflineEntity=function(e){return e&&e._id&&this.isOfflineId(e._id)},e.prototype.isOfflineId=function(e){return e&&e.startsWith&&e.startsWith(R.OFFLINE_PREFIX)},e.prototype.getAllOffline=function(r,n,a,s,l,p,u,e,c){var d=this;return void 0===p&&(p=0),void 0===u&&(u=20),void 0===e&&(e=null),void 0===c&&(c=!1),v.from(this.cache.getDatabaseCollection(r).then(function(o){var e=G.getModelByCollectionName(r);if(n&&(o=o.filter(function(e){return d.isOfflineEntity(e)})),s&&0<s.length){var i=[];s.forEach(function(e){var t=D(o);e.filter(function(e){return!0!==e.removeFromOffline}).forEach(function(o){t=t.filter(function(e){var t=T.isArray(o.value)&&T.isObject(o.value[0])?T.map(o.value,"_id"):T.isArray(o.value)?o.value:T.isObject(o.value)?o.value._id:o.value;if(e&&e[o.field]!==undefined&&null!==e[o.field])switch(o.operator._id){case"eq":return T.isEqual(e[o.field],t);case"neq":return!T.isEqual(e[o.field],t);case"inq":return 0<T.intersection([].concat(e[o.field]),[].concat(t)).length;case"nin":return T.intersection([].concat(e[o.field]),[].concat(t)).length<=0;case"gt":return e[o.field]>t;case"gte":return e[o.field]>=t;case"lt":return e[o.field]<t;case"lte":return e[o.field]<=t;case"nearSphere":return e.distance=d.geoloc.getDistance(e[o.field][1],e[o.field][0],t[1],t[0]),e.distance<o.max;case"exists":return!b.isNullOrUndefined(e[o.field])}else switch(o.operator._id){case"neq":case"nin":return!0;case"inq":return t&&0<=t.indexOf(null)}})}),i=D(i,t)}),o=T.uniqBy(i,function(e){return e._id})}a&&e&&e.searchableFields&&(o=o.filter(function(t){return!!e.searchableFields.some(function(e){return t[e]&&0<=t[e].toString().toUpperCase().indexOf(a.toUpperCase())})})),s&&s.some(function(e){return e.some(function(e){return"nearSphere"===e.operator._id})})&&(o=T.orderBy(o,["distance"])),l&&(o=T.orderBy(o,l.map(function(e){return e.colId}),l.map(function(e){return e.sort})));var t=o.length;return 0<u&&(p=p||0,o=o.slice(p,p+u)),c?o:{count:t,data:o}}))},e.prototype.aggregateQuery=function(e,t,o,i,r,n,a,s,l,p){var u,c=this;if(void 0===n&&(n=!1),void 0===a&&(a=null),e=G.fixCollectionName(e,!0),this.network.isOffline())u=a?v.from(this.localForage.get(a)):p?v.from(this.cache.getDatabaseCollection(e).then(function(e){return e=p(e),n?{data:[{count:e.length,data:e}]}:{data:e}})):v.of({count:0,data:[]});else{if("aggregateLogs"===e)return this.aggregateLogs(o);var d=this.config.apiUrl+"businesslogic/aggregateQuery",y=this.getAggregateQuery(e,t,o,i,r,n,s,l);u=this.rq.post(d,{params:y}).pipe(F.map(function(e){return a&&c.localForage.set(a,e),e}))}return u.pipe(F.map(function(e){var t=[];return e&&e.data&&0<e.data.length&&(t=n?e.data[0]:e.data),t}))},e.prototype.aggregateQueries=function(i,o,r){var e,n=this;if(void 0===o&&(o=!1),void 0===r&&(r=null),this.network.isOffline())e=r?v.from(this.localForage.get(r)):v.of({count:0,data:[]});else{var t=this.config.apiUrl+"businesslogic/aggregateQueries";e=this.rq.post(t,i).pipe(F.map(function(e){for(var t=Array(i.length),o=0;o<t.length;o++)t[o]=[];return e&&e.data&&e.data.some(function(e){return T.isObject(e.doc)})?(e.data.forEach(function(e){t[e.index]=t[e.index]||[],t[e.index].push(e.doc)}),e.data=t):e&&T.isArray(e.data)&&0===e.data.length&&(e.data=t),r&&n.localForage.set(r,e),e}))}return e.pipe(F.map(function(e){var t=[];return e&&e.data&&0<e.data.length&&(t=o?e.data[0]:e.data),t}))},e.prototype.getAggregateQuery=function(e,t,o,i,r,n,a,s){void 0===n&&(n=!1);var l={},p={},u=null,c=null,d=[],y={collectionName:G.fixCollectionName(e,!0),includeCount:n};return t&&0<t.length&&(u=G.exportWhere(e,t,r)),i&&(c=G.exportSearch(e,i)),c&&u?y.where={and:[c,u]}:c?y.where=c:u&&(y.where=u),a&&y.where?y.where={and:[y.where,a]}:a&&(y.where=a),y.where=y.where||{},d&&0<d.length&&d.forEach(function(e,t){p[e]=1}),T.isEmpty(p)||o.unshift({$project:p}),T.isEmpty(l)||o.unshift({$match:l}),y.options=o,y.subQuery=G.exportSubQuery(e,t,!0),s&&(y.subQuery=s),y},e.prototype.aggregateLogs=function(e,t,o){var i=this.config.apiUrl+"AdminDashboard/aggregateLogs";return this.rq.post(i,{stages:e,groups:t,userIds:o})},e.prototype.textSearch=function(e,t){var o=this.config.apiUrl+"businesslogic/textSearch";return this.rq.post(o,{query:e,modelName:t})},e.prototype.createFile=function(e,t,o,i,r){return void 0===o&&(o=!0),this.upsert("files",{_downloadURL:e,_filename:e.name,group:t,hideMobile:o,mimeType:e.type,size:e.size,_tenantRef:r})},e.prototype.getFileUploader=function(e,t){var o={maxFileSize:t,url:this.config.uploadUrl};return new i.FileUploader(o)},e.prototype.execute=function(e){var t=this.config.apiUrl+"Endpoints/execute";return this.rq.post(t,{params:e})},e.prototype.undoOperation=function(e){var t=this.config.apiUrl+"operation/undoDelete";return this.rq.post(t,{operationId:e})},e.prototype.getMarkers=function(e){return e.filter(function(e){return e._geoloc&&1<e._geoloc.length}).map(function(e){return{_id:e._id,address:e.address,latitude:e._geoloc[1],longitude:e._geoloc[0],title:e.title,color:"place"===e.status?"success":"file"===e.status?"info":"error"===e.status?"danger":"prediction"===e.status?"stable":"dark"}})},e.prototype.getUserOrLocationStat=function(e,t,o){var i="campaign"===t?"descriptionRef":"location"===t?"locationRef":"ownerRef",r=[[{field:i,operator:{_id:"inq"},value:T.isString(e)?[{_id:e}]:e}]],n=[{$project:{_id:"$"+i,booked:{$cond:{"if":{$eq:["$status","booked"]},then:1,"else":0}},finished:{$cond:{"if":{$eq:["$status","finished"]},then:1,"else":0}},archived:{$cond:{"if":{$eq:["$status","archived"]},then:1,"else":0}},validated:{$cond:{"if":{$eq:["$validated",!0]},then:1,"else":0}},rejected:{$cond:{"if":{$eq:["$validated",!1]},then:1,"else":0}},finishedDate:"$finishedDate"}},{$group:{_id:"$_id",booked:{$sum:"$booked"},finished:{$sum:"$finished"},archived:{$sum:"$archived"},validated:{$sum:"$validated"},rejected:{$sum:"$rejected"},latest:{$max:"$finishedDate"},count:{$sum:1}}}];return this.aggregateQuery("missions",r,n,null,null,!1,null,o).pipe(F.map(function(e){return e&&0<e.length&&(e[0].available=(e[0].count||0)-(e[0].finished||0)-(e[0].booked||0)-(e[0].archived||0),e[0].tobevalidated=(e[0].finished||0)-(e[0].validated||0)-(e[0].rejected||0)),e}))},e.prototype.setTimescale=function(e,t,o,i,r){void 0===o&&(o="finishedDate"),void 0===r&&(r=!1),t&&(e=e||[]).forEach(function(e){e=e||[],T.remove(e,function(e){return e.field===o}),e.push({field:o,operator:{_id:"between",interval:!0},value:te(t,i,undefined,undefined,r)})})},e.prototype._hasFiles=function(r,e){var n=this;void 0===e&&(e=[]);var a=!1,t=function(i){r.hasOwnProperty(i)&&o.files.isImageFile(r[i])&&(a=!0),T.forEach(e,function(e){if(e){var t=T.get(r,i+e);if(T.isArray(t)){var o=T.get(r,i+".extraData");t.forEach(function(e,t){n.files.isImageFile(e)&&(a=!0),o&&o[t]&&o[t].edit&&n.files.isImageFile(o[t].edit)&&(a=!0)})}else n.files.isImageFile(T.get(r,i+e))&&(a=!0)}})},o=this;for(var i in r)t(i);return a},e.prototype._getFileProperties=function(t,e){var a=this;void 0===e&&(e=[]);var s=[],o=function(n){t.hasOwnProperty(n)&&i.files.isImageFile(t[n])&&s.push(n),T.forEach(e,function(r){if(r){var e=T.get(t,n+r);if(T.isArray(e)){[".extraData",".value.fieldExtra"].forEach(function(o){var i=T.get(t,n+o);e.forEach(function(e,t){a.files.isImageFile(e)&&s.push(n+r+"["+t+"]"),i&&i[t]&&i[t].edit&&a.files.isImageFile(i[t].edit)&&s.push(n+o+"["+t+"].edit")})})}else a.files.isImageFile(e)&&s.push(n+r)}})},i=this;for(var r in t)o(r);return s=T.uniq(s)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:J},{type:W},{type:Y},{type:t},{type:K},{type:g.PromiseService},{type:g.CoreConfig},{type:g.Log},{type:g.Network},{type:o.FileTransfer},{type:g.LocalForageService},{type:I},{type:h.Injector},{type:R},{type:$},{type:m.Translate},{type:X}]},e}();function te(e,t,o,i,r){void 0===r&&(r=!1);var n=t||new Date;o=o||7;var a="days",s="day";switch(e){case"last30days":o=30,a="days";break;case"last90days":o=90,a="days";break;case"last365days":o=365,a="days";break;case"lastweek":o=0,a="weeks";break;case"lastmonth":o=0,a="months",s="month";break;case"lastquarter":o=2,a="months",s="month";break;case"lastyear":o=0,a="years",s="year";break;case"last7days":o=7,a="days",s="day";break;default:s=i?(o=o?o-1:0,a=e):(o=o||1,a=e,"day")}var l=b.startOf(b.dateAdd(b.utc(b.toDate(n)),a,-o),s),p=b.toDate(n);return r&&(l=b.dateAdd(l,a,-o),p=b.dateAdd(p,a,-o)),[l.toISOString(),p.toISOString()]}function oe(o,i){return function(e,t){i.name=i.name||t,i.filterName=i.filterName||i.name,i.title||(i.title=i.name.toUpperCase()),i.collectionName&&!i.tag&&"_acl.groups.r"!==i.name&&"groups"!==i.collectionName&&(i.filterName+="Ref"),G&&G.addFormField(o,i)}}function ie(o){return function(e,t){G&&G.addSearchableField(o,t)}}function re(t){return function(e){G&&G.setCollectionName(t.className,t.collectionName,t.fields,t.include,t.searchSubquery,t.feathersService,e,null,t.detailComponent,t.icon)}}var ne='type!="field"',ae='type=="field"',se='type=="tags"',le='type=="groups"',pe='field.type=="selectmulti" or field.type=="selectbuttonsmulti"',ue='field.type=="checkbox" or field.type=="toggle"',ce='field.type=="select" or field.type=="selectbuttons" or field.type=="autocomplete"',de='type=="field" and (field.type=="text" or field.type=="email" or field.type=="number" or field.type=="formula" or field.type=="date" or field.type=="tel" or field.type=="time" or field.type=="range" or field.type=="starrating")',ye='type=="field" and (field.type=="checkbox" or field.type=="toggle" or field.type=="select" or field.type=="selectmulti" or field.type=="selectbuttons" or field.type=="selectbuttonsmulti" or field.type=="autocomplete" or field.type=="selectimage")';function fe(e){return e.data&&e.data.filter&&(e.data=e.data.filter(function(e){return M.indexOf(e._id)<0&&!0!==e.isRole})),e}function ge(e){return e.type!==b.FormFieldType.information}function me(){return T.map(b.MOBILE_FORM_FIELDS_ALL.filter(ge),"type")}var he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Condition",{type:b.FormFieldType.text,required:!0}),x("design:type",String)],t.prototype,"title",void 0),A([oe("Condition",{type:b.FormFieldType.autocomplete,translate:!0,values:U,required:!0}),x("design:type",String)],t.prototype,"type",void 0),A([oe("Condition",{type:b.FormFieldType.autocomplete,condition:ae,required:!0,idAttributeName:"name"}),x("design:type",Object)],t.prototype,"field",void 0),A([oe("Condition",{type:b.FormFieldType.autocomplete,required:!0,multiple:!1,translate:!0,condition:"type",conditionalValues:[{condition:ne,values:["in","notin"]},{condition:pe,values:["in","notin"]},{condition:ue,values:["equals","notequals"]},{condition:ce,values:["equals","in","notin"]}],defaultValues:["equals","notequals","greaterthan","lessthan"]}),x("design:type",String)],t.prototype,"operator",void 0),A([oe("Condition",{type:b.FormFieldType.autocomplete,condition:se,tag:!0,multiple:!0,collectionName:"locations",required:!0}),x("design:type",Array)],t.prototype,"tags",void 0),A([oe("Condition",{title:"GROUPS",required:!0,type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,condition:le,multiple:!0,clearable:!1}),x("design:type",Array)],t.prototype,"group",void 0),A([oe("Condition",{type:b.FormFieldType.autocomplete,required:!0,condition:ye,dynamicValues:"field.values",defaultValues:["true","false"],multiple:!0}),x("design:type",Array)],t.prototype,"values",void 0),A([oe("Condition",{dynamicType:"field.type",defaultType:b.FormFieldType.text,required:!0,condition:de}),x("design:type",Object)],t.prototype,"value",void 0),t=A([re({className:"Condition"})],t)}(b.ICondition),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("ConditionalField",{type:b.FormFieldType.text,readonly:!0,title:"FIELDIF"}),x("design:type",String)],t.prototype,"fieldTitle",void 0),A([oe("ConditionalField",{type:b.FormFieldType.autocomplete,required:!0,multiple:!1,translate:!0,title:"FIELDIS",conditionalValues:[{condition:ne,values:["in","notin"]},{condition:pe,values:["in","notin"]},{condition:ue,values:["equals","notequals"]},{condition:ce,values:["equals","in","notin"]}],defaultValues:["equals","notequals","greaterthan","lessthan"]}),x("design:type",String)],t.prototype,"operator",void 0),A([oe("ConditionalField",{type:b.FormFieldType.autocomplete,required:!0,condition:ye,dynamicValues:"field.values",defaultValues:["true","false"],multiple:!0}),x("design:type",Array)],t.prototype,"values",void 0),A([oe("ConditionalField",{dynamicType:"field.type",defaultType:b.FormFieldType.text,required:!0,condition:de}),x("design:type",Object)],t.prototype,"value",void 0),A([oe("ConditionalField",{type:b.FormFieldType.autocomplete,required:!0,title:"FIELDTYPE",values:me(),translate:!0}),x("design:type",String)],t.prototype,"newFieldType",void 0),A([oe("ConditionalField",{type:b.FormFieldType.text,required:!0,title:"TITLE"}),x("design:type",String)],t.prototype,"newfieldTitle",void 0),A([oe("ConditionalField",{title:"INSTRUCTIONS",type:b.FormFieldType.textarea}),x("design:type",String)],t.prototype,"newfieldDescription",void 0),A([oe("ConditionalField",{title:"MANDATORY",type:b.FormFieldType.checkbox}),x("design:type",Boolean)],t.prototype,"newFieldRequired",void 0),t=A([re({className:"ConditionalField"})],t)}(b.IConditionalField),be=["image/png","image/jpg","image/jpeg","image/gif","image/bmp"],Fe=[[{field:"mimeType",operator:{_id:"inq"},value:be}]],Te=[[{field:"mimeType",operator:{_id:"inq"},value:be},{field:"tags",operator:{_id:"inq"},value:["group"]}]],Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Tenant",{required:!0,type:b.FormFieldType.text}),ie("Tenant"),x("design:type",String)],t.prototype,"name",void 0),A([oe("Tenant",{required:!1,type:b.FormFieldType.text}),ie("Tenant"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Tenant",{required:!1,type:b.FormFieldType.textarea}),ie("Tenant"),x("design:type",String)],t.prototype,"description",void 0),A([oe("Tenant",{type:b.FormFieldType.autocomplete,filters:Fe,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,clearable:!0,fixedPosition:!0,maxWidth:160,maxHeight:160,crop:"circle",collectionName:"files",title:"ICON",columnDefinition:{name:"_downloadURL"},filterable:!1,sortable:!1}),x("design:type",Object)],t.prototype,"icon",void 0),A([oe("Tenant",{type:b.FormFieldType.toggle}),x("design:type",Boolean)],t.prototype,"ssoOnly",void 0),A([oe("Tenant",{type:b.FormFieldType.toggle}),x("design:type",Boolean)],t.prototype,"protected",void 0),A([oe("Tenant",{type:b.FormFieldType.json,filterable:!1,sortable:!1,suppressExport:!0}),x("design:type",Array)],t.prototype,"locationKpis",void 0),t=A([re({className:"Tenant",collectionName:"tenants",fields:["*"],include:[],icon:"yo-company"})],t)}(b.ITenant),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("LocationType",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:1}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("LocationType",{type:b.FormFieldType.text,required:!0,exportOrder:2}),ie("LocationType"),x("design:type",String)],t.prototype,"name",void 0),A([oe("LocationType",{title:"GROUPS",type:b.FormFieldType.autocomplete,allowCustomTag:!0,collectionName:"groups",multiple:!0,clearable:!1,required:!0,idOnly:!0,filters:[[{field:"type",operator:{_id:"nin"},value:["plan"]},{field:"isRole",operator:{_id:"neq"},value:!0}]],hiddenFields:["isRole","type"],mapTransform:fe}),x("design:type",Array)],t.prototype,"group",void 0),A([oe("LocationType",{type:b.FormFieldType.number,readonly:!0,visible:!1,forceExport:!0,exportOrder:4}),x("design:type",Number)],t.prototype,"count",void 0),A([oe("LocationType",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"}}),x("design:type",Se)],t.prototype,"_tenant",void 0),t=A([re({className:"LocationType",collectionName:"locationtypes",fields:["*"],include:["_tenant"],icon:"yo-categories"})],t)}(b.ILocationType);function Oe(o,i){return function(e,t){G&&G.addMappingField(o,t,i.order)}}var Ae=["file","geocoder","place","prediction","error"];function xe(e,t,o){e&&e._geoloc&&(t._geoloc=e._geoloc,o._geoloc=e._geoloc,t.address=e.address)}function Ce(e,t){e&&e._id&&(t.typeRef=e._id)}var De=function(){function e(){}return A([Oe("Location",{order:12}),oe("Location",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:13,filterable:!1}),x("design:type",String)],e.prototype,"_id",void 0),A([Oe("Location",{order:11}),oe("Location",{type:b.FormFieldType.text,columnDefinition:{width:100},exportOrder:12}),ie("Location"),x("design:type",String)],e.prototype,"clientid",void 0),A([Oe("Location",{order:0}),oe("Location",{required:!0,type:b.FormFieldType.text,exportOrder:1,sortable:!0}),ie("Location"),x("design:type",String)],e.prototype,"title",void 0),A([Oe("Location",{order:1}),oe("Location",{required:!0,type:b.FormFieldType.address,filterName:"_geoloc",columnDefinition:{width:350},showMap:!0,exportOrder:2,onChange:xe}),ie("Location"),x("design:type",String)],e.prototype,"address",void 0),A([Oe("Location",{order:15}),oe("Location",{type:b.FormFieldType.photo,filterable:!1,title:"PHOTO",columnDefinition:{width:52},exportOrder:16,sortable:!1,allowLibrary:!0}),x("design:type",String)],e.prototype,"imageData",void 0),A([Oe("Location",{order:13}),oe("Location",{type:b.FormFieldType.checkbox,columnDefinition:{width:40},exportOrder:14,filterable:!0}),x("design:type",Boolean)],e.prototype,"vip",void 0),A([Oe("Location",{order:9}),oe("Location",{title:"LOCATIONTAGS",type:b.FormFieldType.autocomplete,tag:!0,collectionName:"locations",multiple:!0,subQuery:{field:"locationRef",values:"_id"},icon:"yo-tag",exportOrder:10}),x("design:type",Array)],e.prototype,"tags",void 0),A([Oe("Location",{order:2}),oe("Location",{type:b.FormFieldType.autocomplete,collectionName:"locationtypes",required:!0,columnDefinition:{name:"name"},exportOrder:3,filterableAdvanced:!0,onChange:Ce,filterable:!0}),x("design:type",_e)],e.prototype,"type",void 0),A([Oe("Location",{order:14}),oe("Location",{type:b.FormFieldType.autocomplete,collectionName:"missiondescriptions",clearable:!0,multiple:!0,filterable:!1,sortable:!1,suppressExport:!0,filters:[[{field:"archived",operator:{_id:"neq"},value:!0}]],hiddenFields:["archived"]}),x("design:type",Object)],e.prototype,"missiondescriptions",void 0),A([Oe("Location",{order:10}),oe("Location",{title:"NOTIFICATIONEMAILS",type:b.FormFieldType.emailreport,showUsers:!0,stateful:!1,tab:"INFORMATION",exportOrder:11,filterableAdvanced:!0}),x("design:type",Array)],e.prototype,"notificationemail",void 0),A([Oe("Location",{order:5}),oe("Location",{type:b.FormFieldType.text,tab:"INFORMATION",exportOrder:6,filterableAdvanced:!0}),ie("Location"),x("design:type",String)],e.prototype,"contactname",void 0),A([Oe("Location",{order:6}),oe("Location",{type:b.FormFieldType.email,tab:"INFORMATION",exportOrder:7,filterableAdvanced:!0}),x("design:type",String)],e.prototype,"contactemail",void 0),A([Oe("Location",{order:7}),oe("Location",{type:b.FormFieldType.text,tab:"INFORMATION",exportOrder:8,filterableAdvanced:!0}),x("design:type",String)],e.prototype,"contactphone",void 0),A([Oe("Location",{order:8}),oe("Location",{type:b.FormFieldType.textarea,tab:"INFORMATION",exportOrder:9,filterableAdvanced:!0}),x("design:type",String)],e.prototype,"info",void 0),A([oe("Location",{readonly:!0,type:b.FormFieldType.autocomplete,values:Ae,clearable:!1,filterableAdvanced:!0,suppressExport:!0}),x("design:type",String)],e.prototype,"status",void 0),A([Oe("Location",{order:4}),oe("Location",{visible:!1,exportOrder:5,forceExport:!0,filterable:!1,sortable:!1}),x("design:type",String)],e.prototype,"placesearch",void 0),A([Oe("Location",{order:3}),oe("Location",{visible:!1,forceExport:!0,exportOrder:4,filterable:!1,sortable:!1}),x("design:type",Array)],e.prototype,"_geoloc",void 0),A([oe("Location",{type:b.FormFieldType.autocomplete,tab:"PROPERTIES",allowCustomTag:!0,multiple:!0,filterable:!1,sortable:!1,suppressExport:!0,condition:j.hasProductBatch}),x("design:type",Array)],e.prototype,"aisles",void 0),A([oe("Location",{type:b.FormFieldType.text,tab:"PROPERTIES",condition:j.hasProductBatch}),x("design:type",String)],e.prototype,"smartTagId",void 0),A([oe("Location",{type:b.FormFieldType.json,tab:"PROPERTIES",filterable:!1,sortable:!1,suppressExport:!0,condition:j.isAdmin}),x("design:type",Array)],e.prototype,"properties",void 0),A([oe("Location",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"}}),x("design:type",Se)],e.prototype,"_tenant",void 0),A([oe("Location",{visible:!1,type:b.FormFieldType.toggle,filterable:!1,invertedSort:!0}),x("design:type",Boolean)],e.prototype,"hasAvailableMissions",void 0),A([oe("Location",{visible:!1,type:b.FormFieldType.number,filterable:!1,invertedSort:!0}),x("design:type",Number)],e.prototype,"availableMissions",void 0),e=A([re({className:"Location",collectionName:"locations",fields:["*","type.name"],include:["type","_tenant"],icon:"yo-store"})],e)}(),Ie='not getAttributeValue("_ect")',Ne='getAttributeValue("_ect")',Ee='not (getAttributeValue("_id") == "multiple")',we='not (username == "smartin@yoobic.com")',ke='not (endsWith(getAttributeValue("username"),"@yoobic.com") == 1 and length("_acl.groups.r") == 0)';function Le(e,t){e||(t.locationRef=null)}var qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.getDisplayName=function(e){if(e){var t=e.username;return e.firstName&&e.lastName?t=T.startCase(e.firstName.toString().toLowerCase())+" "+T.startCase(e.lastName.toString().toLowerCase()):e.first_name&&e.last_name?t=T.startCase(e.first_name.toString().toLowerCase())+" "+T.startCase(e.last_name.toString().toLowerCase()):e._socialIdentity&&e._socialIdentity.facebook&&e._socialIdentity.facebook.name?t=e._socialIdentity.facebook.name:e.email?t=e.email:e._socialIdentity&&e._socialIdentity.facebook&&e._socialIdentity.facebook.email&&(t=e._socialIdentity.facebook.email),t}return""},t.getSimpleFields=function(){return["_id","imageData","firstName","lastName","email","telephone","username"]},A([oe("User",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:11}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("User",{type:b.FormFieldType.photo,filterable:!1,title:"PHOTO",columnDefinition:{width:52},exportOrder:10,sortable:!1,allowLibrary:!0}),x("design:type",String)],t.prototype,"imageData",void 0),A([oe("User",{required:!0,flex:100,type:b.FormFieldType.email,sortable:!0,disableAutocomplete:!0,condition:Ee,readonly:Ne,exportOrder:1}),ie("User"),x("design:type",String)],t.prototype,"username",void 0),A([oe("User",{required:!1,flex:100,type:b.FormFieldType.email,disableAutocomplete:!0,exportOrder:6}),ie("User"),x("design:type",String)],t.prototype,"email",void 0),A([oe("User",{required:!0,type:b.FormFieldType.password,secondary:!0,icon:"yo-password",disableAutocomplete:!0,condition:j.isAdminOrClientAdmin,filterable:!1,sortable:!1,exportOrder:2}),x("design:type",String)],t.prototype,"password",void 0),A([oe("User",{required:!0,flex:100,type:b.FormFieldType.text,sortable:!0,exportOrder:4}),ie("User"),x("design:type",String)],t.prototype,"firstName",void 0),A([oe("User",{flex:100,required:!0,type:b.FormFieldType.text,sortable:!0,exportOrder:5}),ie("User"),x("design:type",String)],t.prototype,"lastName",void 0),A([oe("User",{required:!0,filterable:!0,title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"}}),x("design:type",Se)],t.prototype,"_tenant",void 0),A([oe("User",{type:b.FormFieldType.toggle,flex:100,title:"TEAM",exportOrder:12,condition:[Ie,j.isAdmin],filterableAdvanced:!0}),x("design:type",Boolean)],t.prototype,"isTeam",void 0),A([oe("User",{title:"USERTAGS",type:b.FormFieldType.autocomplete,tag:!0,collectionName:"user",readonly:j.isNeitherAdminNorClientAdmin,multiple:!0,icon:"yo-flag",subQuery:{field:"ownerRef",values:"_id"},exportOrder:13}),x("design:type",Array)],t.prototype,"tags",void 0),A([oe("User",{flex:100,required:!0,filterable:!0,readonly:j.isNeitherAdminNorClientAdmin,type:b.FormFieldType.autocomplete,exportOrder:15,values:b.IRoles,translate:!0,filterableAdvanced:!0}),x("design:type",String)],t.prototype,"role",void 0),A([oe("User",{flex:50,type:b.FormFieldType.tel,exportOrder:7,filterableAdvanced:!0,advanced:!0}),x("design:type",String)],t.prototype,"telephone",void 0),A([oe("User",{flex:50,type:b.FormFieldType.text,exportOrder:8,filterableAdvanced:!0,advanced:!0}),x("design:type",String)],t.prototype,"company",void 0),A([oe("User",{flex:50,type:b.FormFieldType.date,suppressExport:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",String)],t.prototype,"dateOfBirth",void 0),A([oe("User",{flex:50,type:b.FormFieldType.autocomplete,values:["MALE","FEMALE"],translate:!0,suppressExport:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",String)],t.prototype,"gender",void 0),A([oe("User",{type:b.FormFieldType.address,exportOrder:9,advanced:!0}),x("design:type",Object)],t.prototype,"address",void 0),A([oe("User",{title:"LOCATION",filterable:!0,type:b.FormFieldType.autocomplete,onChange:Le,collectionName:"locations",deleteOnHidden:!1,readonly:j.isNotManager,suppressExport:!0,clearable:!0}),x("design:type",De)],t.prototype,"location",void 0),A([oe("User",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:14,filterable:!1}),x("design:type",String)],t.prototype,"locationRef",void 0),A([oe("User",{required:!0,name:"_acl.groups.r",columnDefinition:{name:"_acl?.groups?.r",forceName:!0},title:"GROUPS",condition:[j.isAdminOrClientAdmin,we,ke],type:b.FormFieldType.autocomplete,allowCustomTag:!0,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,multiple:!0,clearable:!1,exportOrder:3,deleteOnHidden:!1,mapTransform:fe}),x("design:type",Object)],t.prototype,"_aclGroupsR",void 0),A([oe("User",{type:b.FormFieldType.date,name:"_lmt",title:"LASTSEEN",sortable:!0,filterable:!0,readonly:!0,suppressExport:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",Object)],t.prototype,"lastSeen",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!1,filterableAdvanced:!0,advanced:!0}),x("design:type",Object)],t.prototype,"version",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!1,filterableAdvanced:!0,advanced:!0}),x("design:type",Object)],t.prototype,"mobileVersion",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",Object)],t.prototype,"platform",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",String)],t.prototype,"language",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!0,filterable:!1,advanced:!0}),x("design:type",String)],t.prototype,"device",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!0,filterable:!1,advanced:!0}),x("design:type",String)],t.prototype,"uuid",void 0),A([oe("User",{type:b.FormFieldType.text,readonly:!0,suppressExport:!0,filterable:!1,advanced:!0}),x("design:type",String)],t.prototype,"target",void 0),A([oe("User",{title:"MAXWIDTH",type:b.FormFieldType.number,condition:j.isAdmin,suppressExport:!0,filterable:!1}),x("design:type",Number)],t.prototype,"photoMaxWidth",void 0),A([oe("User",{title:"SSO",type:b.FormFieldType.toggle,condition:j.isAdmin,exportOrder:18}),x("design:type",Boolean)],t.prototype,"sso",void 0),A([oe("User",{type:b.FormFieldType.toggle,condition:j.isAdmin,suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"disableTracking",void 0),A([oe("User",{type:b.FormFieldType.toggle,condition:j.isAdmin,suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"disableDatabaseSync",void 0),t=A([re({className:"User",collectionName:"user",fields:["*"],include:["location","_tenant"],icon:"yo-user"})],t)}(b.IUser),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("UserSettings",{type:b.FormFieldType.toggle,header:"NOTIFICATIONS",flex:100,title:"DISABLEALLEMAILS",suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"disableEmailNotifications",void 0),A([oe("UserSettings",{type:b.FormFieldType.toggle,flex:100,title:"DISABLEALLPUSH",suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"disablePushNotifications",void 0),A([oe("UserSettings",{type:b.FormFieldType.toggle,flex:100,title:"DISABLEALLSMS",suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"disableSmsNotifications",void 0),A([oe("UserSettings",{type:b.FormFieldType.toggle,flex:100,suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"sendFinishedEmail",void 0),A([oe("UserSettings",{title:"MAXWIDTH",header:"PHOTOS",type:b.FormFieldType.number,suppressExport:!0,filterable:!1,min:600,max:10240}),x("design:type",Number)],t.prototype,"photoMaxWidth",void 0),A([oe("UserSettings",{type:b.FormFieldType.toggle,flex:100,title:"DELETEPHOTOSINALBUM",suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"deletePhotos",void 0),A([oe("UserSettings",{type:b.FormFieldType.toggle,flex:100,header:"MISSIONS",title:"ENABLEMISSIONLIVESYNC",condition:j.isAdmin,suppressExport:!0,filterable:!1,sortable:!1}),x("design:type",Boolean)],t.prototype,"enableMissionLiveSync",void 0),t=A([re({className:"UserSettings"})],t)}(b.IUserSettings),Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("SimpleUser",{type:b.FormFieldType.text,visible:!1}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("SimpleUser",{visible:!0,type:b.FormFieldType.photo,filterable:!1,title:"PHOTO",columnDefinition:{width:52}}),x("design:type",String)],t.prototype,"imageData",void 0),A([oe("SimpleUser",{required:!0,type:b.FormFieldType.email}),ie("SimpleUser"),x("design:type",String)],t.prototype,"username",void 0),A([oe("SimpleUser",{visible:!0,required:!0,type:b.FormFieldType.email}),ie("SimpleUser"),x("design:type",String)],t.prototype,"email",void 0),A([oe("SimpleUser",{required:!0,type:b.FormFieldType.password,condition:Ie,filterable:!1,sortable:!1}),x("design:type",String)],t.prototype,"password",void 0),t=A([re({className:"SimpleUser"})],t)}(b.ISimpleUser),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Notification",{type:b.FormFieldType.autocomplete,translate:!0,values:["email","notification","allnotification"],required:!0,filterable:!0}),x("design:type",String)],t.prototype,"mode",void 0),A([oe("Notification",{type:b.FormFieldType.text,required:!0}),ie("Notification"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Notification",{type:b.FormFieldType.textarea,required:!0}),x("design:type",String)],t.prototype,"body",void 0),A([oe("Notification",{type:b.FormFieldType.datetime,minDate:new Date,condition:'mode!="sms"'}),x("design:type",Date)],t.prototype,"scheduledDate",void 0),A([oe("Notification",{type:b.FormFieldType.autocomplete,collectionName:"user",icon:"yo-user",columnDefinition:{name:"username"},exportOrder:24,title:"SENDBY",filterable:!0}),x("design:type",qe)],t.prototype,"sender",void 0),t=A([re({className:"Notification",collectionName:"notifications",fields:["*","sender._id","sender.firstName","sender.lastName","sender.username","sender.imageData","sender.email","sender.telephone"],include:["sender"],icon:"yo-activity"})],t)}(b.INotification),Me=function(){function e(e,t,o,i,r,n){this.coreConfig=e,this.log=t,this.config=o,this.rq=i,this.oneSignal=r,this.pushNative=n,this.tags=["username","language","isTeam"],this._notificationReceived=new v.Subject,this.registered=!1,this._oneSignalPlayerIdChange=new v.Subject}return Object.defineProperty(e.prototype,"oneSignalPlayerIdChange$",{get:function(){return this._oneSignalPlayerIdChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notificationReceived$",{get:function(){return this._notificationReceived.asObservable()},enumerable:!0,configurable:!0}),e.prototype.registerOneSignal=function(o){var i=this;if(!0===this.registered)return Promise.resolve(o);this.registered=!0;var r=this.coreConfig.getKey("onesignalAppId");return this._parentSubscription=new v.Subscription,this.coreConfig.isCordova()?(this.oneSignal.startInit(r,this.coreConfig.getKey("googleProjectNumber")),this.oneSignal.inFocusDisplaying(this.oneSignal.OSInFocusDisplayOption.None),this._parentSubscription.add(this.oneSignal.handleNotificationReceived().subscribe(function(e){return i.onNotificationReceived(e)})),this._parentSubscription.add(this.oneSignal.handleNotificationOpened().subscribe(function(e){return i.onNotificationOpened(e)})),this.oneSignal.endInit(),this.oneSignal.getIds().then(function(e){return i.oneSignal.setSubscription(!0),i.oneSignal.sendTags(T.pick(o,i.tags)),e&&e.userId&&(i.currentOneSignalId=e.userId,i.updateUserOneSignalIds(o,i.currentOneSignalId),o.email&&i.oneSignal.syncHashedEmail(o.email),e.pushToken&&i.addToken(o,e.pushToken)),i._oneSignalPlayerIdChange.next(e.userId),o},function(e){return i.log.forceLog(e),o})):this.coreConfig.isWeb()&&window.OneSignal?new Promise(function(t,e){if(!window.OneSignal.isPushNotificationsSupported()||"localhost"===location.hostname)return t(o);window.OneSignal.push(["init",{appId:r,autoRegister:!0,notifyButton:{enable:!1},safari_web_id:i.coreConfig.getKey("onesignalSafariWebId")}]),window.OneSignal.push(function(){window.OneSignal.sendTags(T.pick(o,i.tags)),window.OneSignal.on("notificationDisplay",function(e){i.onNotificationReceived(e)}),window.OneSignal.getUserId().then(function(e){i.currentOneSignalId=e,i.updateUserOneSignalIds(o,i.currentOneSignalId),t(o)})})}):Promise.resolve(o)},e.prototype.updateUserOneSignalIds=function(e,t){if(e){e.oneSignalId=T.uniq(T.compact(T.union([].concat(e.oneSignalId),[t]))),e.oneSignalAppIds=e.oneSignalAppIds||{};var o=this.coreConfig.getAppId().replace(/\./g,"_");e.oneSignalAppIds[o]=T.uniq(T.compact(T.union([].concat(e.oneSignalAppIds[o]),[t])))}},e.prototype.onNotificationReceived=function(e){this._notificationReceived.next({type:"received",notification:e})},e.prototype.onNotificationOpened=function(e){this._notificationReceived.next({type:"opened",action:e.action,notification:e.notification})},e.prototype.unregisterOneSignal=function(e){if(this.coreConfig.isCordova()){this.oneSignal.setSubscription(!1),this._parentSubscription&&(this._parentSubscription.unsubscribe(),this._parentSubscription=null),e.oneSignalId=T.without(e.oneSignalId,this.currentOneSignalId),e.oneSignalAppIds=e.oneSignalAppIds||{};var t=this.coreConfig.getAppId().replace(/\./g,"_");e.oneSignalAppIds[t]=T.without(e.oneSignalAppIds[t],this.currentOneSignalId),this.registered=!1}},e.prototype.addToken=function(e,t){var o=this.coreConfig.isIOS()?"ios":"android";e._messaging&&T.isArray(e._messaging.pushTokens)||(e._messaging={pushTokens:[]}),e._messaging.pushTokens.push({token:t,platform:o}),e._messaging.pushTokens=T.uniqBy(e._messaging.pushTokens,function(e){return e.token}),delete e.messaging},e.prototype.removeToken=function(e,t){e._messaging&&T.isArray(e._messaging.pushTokens)&&(e._messaging.pushTokens=T.filter(e._messaging.pushTokens,function(e){return e.token!==t}))},e.prototype.getUserTokens=function(e,t){var o=[];return e._messaging&&e._messaging.pushTokens&&(o=T.union(T.map(T.filter(e._messaging.pushTokens,function(e){return e.platform===t}),"token"))),o},e.prototype.notifyGroups=function(e,t){return(e=[].concat(e))&&0<e.length?(t.group=e,this.notify(t)):v.of(null)},e.prototype.notifyUsers=function(e,t){return e&&0<e.length?this.notify(t,!0,e.map(function(e){return e._id})):v.of(null)},e.prototype.notifyUserById=function(e,t){return e?this.notify(t,!0,[e]):v.of(null)},e.prototype.notifyUsersById=function(e,t){return e&&0<e.length?this.notify(t,!0,e):v.of(null)},e.prototype.notifyUsersByQuery=function(e,t){return T.isEmpty(e)||T.isEmpty(e.where)&&T.isEmpty(e.subQuery.where)?v.of(null):(t.userQuery=e,t._tenantRef=t._tenantRef||T.get(e,["where","_tenantRef"])||T.get(e,["subQuery","where","_tenantRef"]),this.notify(t))},e.prototype.notify=function(e,t,o){if(void 0===t&&(t=!1),e.scheduledDate&&(e.scheduledDate=b.toDate(e.scheduledDate)),e.userQuery&&e.userQuery.limit!==undefined&&delete e.userQuery.limit,e.userQuery&&e.userQuery.field!==undefined&&delete e.userQuery.field,e.notificationOptions=T.merge(e.notificationOptions||{},{ios_badgeType:"Increase",ios_badgeCount:1}),"allnotification"===e.mode&&(e.mode="all"),t){var i=this.config.apiUrl+"notifications/sendTargetedNotification";return this.rq.post(i,{userIds:o,notification:e})}i=this.config.apiUrl+"businesslogic/sendNotification";return this.rq.post(i,e)},e.prototype._registerNative=function(){var e=this;return this.coreConfig.isCordova()?new Promise(function(t,o){var i=!1;e.push=e.pushNative.init({android:{senderID:e.coreConfig.getKey("googleProjectNumber"),iconColor:g.Colors.success,icon:"notify"},ios:{alert:"true",badge:"true",sound:"false"}}),e.push.on("registration").subscribe(function(e){i=!0,t(e.registrationId)}),e.push.on("error").subscribe(function(e){o(e)}),e.push.on("notification").subscribe(function(e){}),setTimeout(function(){i||o("timeout")},1e4)}):Promise.reject("not cordova")},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:g.CoreConfig},{type:g.Log},{type:I},{type:k},{type:y.OneSignal},{type:f.Push}]},e}(),Be=function(){function o(e,t,o,i,r,n,a,s,l){this.rq=e,this.push=t,this.config=o,this.broker=i,this.network=r,this.localStorage=n,this.localForage=a,this.session=s,this.coreConfig=l,this.login$=new v.Subject,this.logout$=new v.Subject,this.profileUpdated$=new h.EventEmitter}return o.prototype.login=function(e,t,o){var i=this,r=this.broker.getServerUrl()+"auth/login";return this.rq.post(r,{username:e,password:t,roles:o}).pipe(F.map(function(e){return i.afterLogin(e),e}),F.catchError(function(e){var t;return i.session.token=null,t=e&&e.json?e.json().error:e&&e.error&&e.error.error?e.error.error:e.name?{message:e.name.toUpperCase()}:{message:"REQUESTERROR"},v.throwError(t)}))},o.prototype.loginSocial=function(e,t){var o=this;void 0===t&&(t="facebook");var i=this.broker.getServerUrl()+"auth/"+t;return this.rq.post(i,{accessToken:e}).pipe(F.map(function(e){return o.afterLogin(e),e}),F.catchError(function(e){return o.session.token=null,v.throwError(e.json().error)}))},o.prototype.getLoginAdvancedUrl=function(e,t,o){return this.broker.getServerUrl()+"auth/"+e.toLowerCase()+"/"+t+"/login?host="+o+"&tokenLocation="+(this.coreConfig.isCordova()?"query":"fragment")},o.prototype.getTenantAdvancedLoginMethods=function(e){var t=this.broker.getServerUrl()+"auth/"+e.toLowerCase()+"/providers";return this.rq.get(t)},o.prototype.getTenantFromToken=function(e){return new r.JwtHelperService({}).decodeToken(e)||{}},o.prototype.afterLogin=function(e){return this.session.token=e.$mcfly$token,this.session.userId=e.userId,this.session.user=e.user,this.session.tenant=e.tenant,this.login$.next(""),this.cleanUpLocalStorage(),e},o.prototype.cleanUpLocalStorage=function(){var t=this;["stats.kpiFilterFormData","stats.selectedDescription","stats.selectedDashboard","stats.customSelectedDashboard"].forEach(function(e){t.localStorage.remove(e)})},o.prototype.getCurrentSession=function(){var t=this;return this.network.isOffline()?v.of(null):this.rq.get(this.broker.getApiUrl()+"businesslogic/getCurrentSession").pipe(F.map(function(e){return T.assign(t.session,e.data),t.session.hasScandit=t.coreConfig.isCordova()?t.hasRoles(["scandit"]):t.hasRoles(["scandit","admin"]),t.session}),F.catchError(function(){return v.of(null)}))},o.prototype.doLogout=function(){var e=this.broker.getApiUrl()+"user/logout";return this.rq.post(e,{})},o.prototype.logout=function(){var e=this,t=Promise.resolve(null);return this.config.isTestpen&&(this.localStorage&&this.localStorage.clear(),this.localForage&&this.localForage.clear()),this.session&&this.session.user&&this.session.user._id&&(this.push.unregisterOneSignal(this.session.user),t=this.updateProfile(this.session.user).toPromise()),this.logout$.next(""),t.then(function(){return e.afterLogout()},function(){return e.afterLogout()})},o.prototype.afterLogout=function(){return this.doLogout().subscribe(function(){},function(){}),this.network.forceOffline(!1,!1),this.session.clear()["catch"](function(){}),Promise.resolve()},o.prototype.signup=function(e,t,o){var i=this,r={username:e,email:e,password:o,imageData:t},n=this.broker.getApiUrl()+"user/signup";return this.rq.post(n,{user:r}).pipe(F.mergeMap(function(){return i.login(e,o)}))},o.prototype.inviteUsers=function(e,t,o,i,r,n,a,s){void 0===o&&(o=null),void 0===i&&(i=!0);var l=this.broker.getApiUrl()+"user/invite",p=a+this.coreConfig.getAppId();return this.rq.post(l,{users:e,groups:t,password:o,sendPassword:i,appName:r,appleStoreUrl:n,playStoreUrl:p,_tenantRef:s})},o.prototype.isLoggedIn=function(){return this.session.token&&0<this.session.token.length&&!this.isTokenExpired(this.session.token)},o.prototype.hasRole=function(e){return this.session.roles&&0<=this.session.roles.indexOf(e)},o.prototype.hasRoles=function(e){var t=this;return T.some(T.map(e,function(e){return t.hasRole(e)}),function(e){return!0===e})},o.prototype.hasAllRoles=function(e){var t=this;return T.every(e,function(e){return t.hasRole(e)})},o.prototype.hasGroup=function(e){return this.session.groups&&0<=this.session.groups.indexOf(e)},o.prototype.hasGroups=function(e){var t=this;return T.some(T.map(e,function(e){return t.hasGroup(e)}),function(e){return!0===e})},o.prototype.hasAllGroups=function(e){var t=this;return T.every(e,function(e){return t.hasGroup(e)})},o.prototype.isAdmin=function(e){void 0===e&&(e=!1);var t=this.hasRole(o.roleAdmin);return e&&"smartin@yoobic.com"!==this.session.user.username&&(t=!1),t},o.prototype.isTrial=function(){return!this.hasRole(o.roleAdmin)&&this.hasRole(o.roleTrial)},o.prototype.isDashboard=function(){return this.hasRole(o.roleDashboard)&&!this.isAdmin()&&!this.hasRole(o.roleMissionViewer)&&!this.hasRole(o.roleManager)},o.prototype.isTeam=function(){return this.hasRole(o.roleTeam)},o.prototype.isCrowd=function(){return!this.hasRole(o.roleTeam)},o.prototype.isStore=function(){return this.session.user&&b.isPresent(this.session.user.locationRef)},o.prototype.isStoreManager=function(){return this.hasRole("store")&&this.session.user&&this.session.user.locationRef},o.prototype.isRoleAdmin=function(){return this.getCurrentUser()&&"ROLEADMIN"===this.getCurrentUser().role},o.prototype.isRoleEditor=function(){return this.getCurrentUser()&&"ROLEEDITOR"===this.getCurrentUser().role},o.prototype.isRoleViewer=function(){return this.getCurrentUser()&&"ROLEVIEWER"===this.getCurrentUser().role},o.prototype.isRoleManager=function(){return this.getCurrentUser()&&"ROLEMANAGER"===this.getCurrentUser().role},o.prototype.isRoleField=function(){return this.getCurrentUser()&&"ROLEFIELD"===this.getCurrentUser().role},o.prototype.isRoleStoreManager=function(){return this.getCurrentUser()&&"ROLESTOREMANAGER"===this.getCurrentUser().role},o.prototype.isRoleStore=function(){return this.getCurrentUser()&&"ROLESTORE"===this.getCurrentUser().role},o.prototype.hasAccessToOperations=function(){return this.hasRole("team")},o.prototype.hasAccessToBoost=function(){return this.hasRole("academy")},o.prototype.getCurrentUser=function(){return this.session.user},o.prototype.passwordChange=function(e,t){return this.rq.post(this.broker.getApiUrl()+"user/changePassword",{oldPassword:e,newPassword:t})},o.prototype.passwordReset=function(e,t,o){return void 0===t&&(t=!1),void 0===o&&(o="https://yoobic.app.link/"),t?this.rq.post(this.broker.getApiUrl()+"user/getMagicLink",{username:e,urlPrefix:o}):this.rq.post(this.broker.getApiUrl()+"user/reset",{email:e})},o.prototype.passwordResetConfirm=function(e,t,o){var i=o?"https://"+o+"/api/":this.broker.getApiUrl();return this.rq.post(i+"Endpoints/resetPassword",{password:t},e,null,!0)},o.prototype.passwordResetAdmin=function(e,t,o){return void 0===o&&(o=!1),this.rq.post(this.broker.getApiUrl()+"AdminDashboard/resetPassword",{options:{userPasswordList:[e].map(function(e){return{username:e.username,_id:e._id,password:t}}),dontSendMail:o}})},o.prototype.impersonate=function(e){return this.rq.post(this.broker.getApiUrl()+"AdminDashboard/impersonate",{username:e})},o.prototype.forceLogout=function(e){return this.rq.post(this.broker.getApiUrl()+"AdminDashboard/forceLogout",{username:e})},o.prototype.generatePassword=function(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="",o=0,i=e.length;o<8;++o)t+=e.charAt(Math.floor(Math.random()*i));return t},o.prototype.updateProfile=function(e,t,o){var i=this;void 0===t&&(t=!1),void 0===o&&(o=[]);var r=e||this.getCurrentUser();return r?(this.isAdmin()||t||this.broker.setAcl(r,this.session.groups),o&&0<o.length&&(r=T.pick(r,o),o.indexOf("_acl")<0&&(t=!0)),this.broker.upsert("user",r,null,t).pipe(F.flatMap(function(e){return i.broker.getById("user",e._id).pipe(F.map(function(e){return i.session.user=e}))}))):v.of(null)},o.prototype.isTokenExpired=function(e){var t=new r.JwtHelperService({});try{return t.isTokenExpired(e)}catch(o){return!0}},o.prototype.setToken=function(e,t){var o=this;return this.session.token=e,this.session.userId=t,this.broker.getById("user",t).pipe(F.map(function(e){return o.session.user=e,o.profileUpdated$.emit(e),e}))},o.prototype.createPublicApiToken=function(e){var t=this.broker.getApiUrl()+"AdminDashboard/generateServiceAccount";return this.rq.post(t,{tenantId:e._id})},o.prototype.invalidatePublicApiToken=function(e){var t=this.broker.getApiUrl()+"publicAPITokens/"+e._id+"/invalidate";return this.rq.post(t,{})},o.roleAdmin="admin",o.roleTeam="team",o.roleTrial="trial",o.roleDashboard="dashboard",o.roleManager="manager",o.roleMissionViewer="missionviewer",o.decorators=[{type:h.Injectable}],o.ctorParameters=function(){return[{type:k},{type:Me},{type:I},{type:ee},{type:g.Network},{type:g.LocalStorage},{type:g.LocalForageService},{type:t},{type:g.CoreConfig}]},o}(),je=function(){function e(e){this.authentication=e}return e.prototype.canActivate=function(e,t){var o=!1;return this.authentication.isLoggedIn()?(o=!e.data||!e.data.roles||(this.authentication.hasRoles(e.data.roles)||this.authentication.isAdmin()),e.data&&e.data.excludedRoles&&!this.authentication.isAdmin()&&(o=o&&!this.authentication.hasRoles(e.data.excludedRoles))):k.unauthorizedEmitter.emit("not logged in"),o},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:Be}]},e}(),Ge=function(){function e(){}return e.prototype.canDeactivate=function(e,t,o){return!e||!e.canDeactivate||e.canDeactivate(e,t,o)},e.decorators=[{type:h.Injectable}],e}(),$e=function(){function e(e,t){this.rq=e,this.config=t}return Object.defineProperty(e.prototype,"apiUrl",{get:function(){return this.config.apiUrl+"AdminDashboard/"},enumerable:!0,configurable:!0}),e.prototype.getAll=function(e){var t=this.apiUrl+"listBackup";return this.rq.post(t,{clusterName:"rs-ds039424",date:b.toDate(e||new Date).toISOString()}).pipe(F.map(function(e){return e&&e.map&&(e=e.map(function(e){var t={_id:e},o=e.lastIndexOf("_"),i=e.substr(o+1).replace(".tgz","");return t.title=b.fromNow(b.dateParse(i,"YYYY-MM-DDTHHmmss.sssZ")),t.badge=b.dateFormat(b.dateParse(i,"YYYY-MM-DDTHHmmss.sssZ"),"L LT"),t.description=e,t}).reverse()),e}))},e.prototype.restore=function(e,t){var o=this.apiUrl+"restoreBackup ";return this.rq.post(o,{s3Key:e,collections:t})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:I}]},e}(),He=function(){function e(e,t,o,i){this.coreConfig=e,this.config=t,this.rq=o,this.translate=i}return e.prototype.getUrl=function(){var e;return"operations"===this.coreConfig.getAppName()?e="fr"===this.translate.getCurrentLanguage()?this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=20417&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=20415&public_link=true":"it"===this.translate.getCurrentLanguage()?this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=21144&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=21143&public_link=true":this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=20416&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=20414&public_link=true":"boost"===this.coreConfig.getAppName()&&(e="fr"===this.translate.getCurrentLanguage()?this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25008&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25006&public_link=true":"it"===this.translate.getCurrentLanguage()?this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25009&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25010&public_link=true":this.coreConfig.isIonic()?"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25007&public_link=true":"https://yoobic.blogin.co/rss.xml?mt=521fe7a42642c458e2403084bad1f468504f2da6&c=25005&public_link=true"),e},e.prototype.get=function(e,t,o){var i=this.config.apiUrl+"businesslogic/getBlog";return this.rq.post(i,{url:e,limit:t,skip:o}).pipe(F.map(function(e){var t=[];return e&&e.rss&&e.rss.channel&&e.rss.channel.item&&0<e.rss.channel.item.length&&(t=[].concat(e.rss.channel.item)),t.forEach(function(e){try{if(e&&e.enclosure&&e.enclosure.$&&e.enclosure.$.url)e.background=e.enclosure.$.url;else{var t=e["content:encoded"],o=/<img[^>]+src="?([^"\s]+)"?[^>]*\/>/g.exec(t);o&&(e.background=o[1])}e.pubDate&&T.isString(e.pubDate)&&(e.pubDate=new Date(e.pubDate)),e.background&&(e.background=e.background.replace("blog.yoobic.com","yoobic.blogin.co"))}catch(i){}}),t}))},e.prototype.getLatestArticleDate=function(e){var t=this.config.apiUrl+"businesslogic/getBlog";return this.rq.post(t,{url:e,limit:1}).pipe(F.map(function(e){var t=[];return e&&e.rss&&e.rss.channel&&e.rss.channel.item&&0<e.rss.channel.item.length&&(t=[].concat(e.rss.channel.item)),t&&0<t.length&&t[0]?t[0].pubDate:null}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:g.CoreConfig},{type:I},{type:k},{type:m.Translate}]},e}(),Ve=function(){function e(e,t){this.authentication=e,this.network=t}return e.prototype.resolve=function(e,t){return this.network.isOffline()?v.of(null):this.authentication.getCurrentSession()},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:Be},{type:g.Network}]},e}(),Qe=function(){function e(e,t,o){this.broker=e,this.translate=t,this.session=o}return e.prototype.publish=function(o,e){var i=this,t=e.filter(function(e){return e._id!==i.session.user._id}).map(function(e){var t=T.cloneDeep(o);return t.originalRef=o._id,delete t._id,t._acl=e._acl,i.broker.setAcl(t,null,null,null,[e._id]),t.creatorRef=e._id,t});return this.broker.deleteAll("dashboards",{where:{originalRef:{inq:[o._id]},creatorRef:{inq:T.map(e,"_id")}}}).pipe(F.mergeMap(function(){return i.broker.upsertAll("dashboards",t)}))},e.prototype.deletePublished=function(e){return this.broker.deleteAll("dashboards",{where:{originalRef:{inq:[e._id]}}})},e.prototype.updatePublished=function(o){var i=this;return this.broker.getAll("dashboards",["_id","_acl","_ect","_lmt"],null,null,[[{field:"originalRef",operator:{_id:"inq"},value:[o._id]}]],null,0,-1).pipe(F.mergeMap(function(e){var t=e.data;return t.forEach(function(e){e.title=o.title+" - "+b.dateFormat(new Date,"L"),e.description=o.description,e.tabs=o.tabs}),i.broker.upsertAll("dashboards",t)}))},e.prototype.copy=function(e,t){var o=T.cloneDeep(e);return o.title=t,delete o._id,o.tabs&&o.tabs.forEach(function(e){e.items&&e.items.forEach(function(e){e.definition._id=b.getUUID()})}),this.broker.upsert("dashboards",o)},e.prototype.aggregateQuery=function(e,t,o,i,r,n){return o=o||[],this.broker.aggregateQuery(e,t,o,null,i,!1,null,r,n)},e.prototype.setTimescale=function(e,t,o,i,r){return void 0===o&&(o="finishedDate"),void 0===r&&(r=!1),this.broker.setTimescale(e,t,o,i,r)},e.prototype.getChartDefinition=function(e,t,o,i,r,n){return void 0===t&&(t=[[]]),void 0===o&&(o="missions"),void 0===i&&(i="day"),void 0===r&&(r=!0),void 0===n&&(n="last7days"),{title:this.translate.get(e),aggregateOptions:[],timescale:n,collectionName:o,dateGrouping:i,filters:t,groupByDate:r,palette:"palette2",showAs:"chart",type:"areaspline",datetimeFormat:"dd"}},e.prototype.getPhotos=function(e,t,o,i){void 0===o&&(o=0);var r=[[]];return e&&e._id&&r[0].push({field:"missiondescriptionRef",operator:{_id:"inq"},value:[e._id]}),t&&(t=[].concat(t),r[0].push({field:"name",operator:{_id:"inq"},value:t.map(function(e){return e.name.replace(".value","")})})),i&&i.length&&r[0].push({field:"tags",collectionName:"locations",operator:{_id:"inq"},value:i,type:b.FormFieldType.autocomplete,subQuery:{field:"locationRef",values:"_id"}}),this.broker.getAll("photos",null,null,null,r,null,o,10)},e.prototype.getFolderFolderStat=function(e){var t=[[{field:"parent",operator:{_id:"inq"},value:e}]];return this.aggregateQuery("folders",t,[{$project:{_id:"$parent"}},{$group:{_id:"$_id",folders:{$sum:1}}}])},e.prototype.getFolderFileStat=function(e,t){void 0===t&&(t=!0);var o=[[{field:"folder",operator:{_id:"inq"},value:e}]];!1===t&&o[0].push({field:"hideMobile",operator:{_id:"neq"},value:!0});return this.aggregateQuery("files",o,[{$project:{_id:"$folder"}},{$group:{_id:"$_id",files:{$sum:1}}}])},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:ee},{type:m.Translate},{type:t}]},e}(),ze=function(){function e(e,t,o){this.dashboard=e,this.broker=t,this.files=o}return e.prototype.getFilesTransform=function(){var t=this;return function(e){return e&&e.data&&e.data.map&&e.data.forEach(function(e){return t.updateFileIcon(e)}),e}},e.prototype.getFilesFoldersTransformAsync=function(){var n=this;return function(r,e,t,o,i){return new v.Observable(function(e){if(r&&r.data&&0<r.data.length){r.data.forEach(function(e){delete e.items,"file"===e.fftype&&n.updateFileIcon(e)});var t=r.data.filter(function(e){return"folder"===e.fftype}).map(function(e){return e._id});n.dashboard.getFolderFolderStat(t).subscribe(function(i){r.data.forEach(function(t){var e=i.find(function(e){return e._id===t._id}),o=e&&e.folders||0;t.stats=[{title:"FOLDERS",color:"dark",value:o}],t.hasChildren=0<o}),n.dashboard.getFolderFileStat(t,!1).subscribe(function(o){r.data.forEach(function(t){var e=o.find(function(e){return e._id===t._id});t.stats.push({title:"FILES",color:"dark",value:e&&e.files||0})}),e.next({count:r.count,data:r.data}),e.complete()})})}else e.next({count:0,data:[]}),e.complete()})}},e.prototype.cleanupFolder=function(e){return this.broker.deleteAll("files",{where:{folder:e}})},e.prototype.updateFileIcon=function(e){this.files.isImage(e)?e.imgSrc=e._downloadURL:this.files.isVideo(e)?e.imgSrc=this.files.getVideoPoster(e._downloadURL):e.icon=this.files.getIcon(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:Qe},{type:ee},{type:K}]},e}(),We=function(){function e(){}return e.get=function(t,e,o,i){var r=this.fixLanguage(e),n=this.fixLanguage(o);if(r===n)return v.of(t);return i.post("businesslogic/translate",{query:t,sourceLang:r,targetLang:n},null,null,null,null,!0).pipe(F.map(function(e){return e||t}))},e.fixLanguage=function(e){switch(e){case"us":return"en";case"zhs":return"zh-CN";case"zht":return"zh-TW";case"ua":return"uk";case"kr":return"ko";case"cz":return"cs";case"gr":return"el";case"br":return"pt";default:return e}},e.getAll=function(o,i,e){var r=this,t=m.Translate.availablesLanguage.filter(function(e){return e!==i}).filter(function(e){return"key"!==e}).map(function(t){return r.get(o,i,t,e).pipe(F.map(function(e){return{language:t,value:e||o}}))});return v.forkJoin(t)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),Ye=function(){function e(e,t,o){this.config=e,this.network=t,this.log=o}return e.prototype.intercept=function(e,t){return this.network.isOffline()&&e.url&&!e.url.startsWith("./")&&this.log.error(e),t.handle(e)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:I},{type:g.Network},{type:g.Log}]},e}(),Ke=function(){function e(e){this.coreConfig=e,this.data$=new v.ReplaySubject(1,2e3)}return e.prototype.handler=function(e){e&&this.data$.next(e)},e.prototype.onReadyOrResume=function(e){var t=this;void 0===e&&(e=!1),this.coreConfig.isCordova()&&window.Branch&&(window.Branch.setDebug(e),window.Branch.initSession().then(function(e){t.handler(e)}))},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:g.CoreConfig}]},e}(),Je=function(){function e(e,t,o,i,r,n,a,s,l){this.geoloc=e,this.broker=t,this.rq=o,this.config=i,this.session=r,this.network=n,this.cache=a,this.authentication=s,this.googleMaps=l}return e.prototype.loadMarkers=function(e,t){var o=this;void 0===t&&(t=5e3);var i=[[{field:"_geoloc",operator:{_id:"nearSphere"},value:[(e=e||this.geoloc.defaultPosition).longitude,e.latitude],max:4e4}]];return this.broker.getAll("locations",["_id","title","_geoloc","address"],null,null,i,null,0,t).pipe(F.map(function(e){return o.getMarkers(e.data)}))},e.prototype.getMarkers=function(e){return this.broker.getMarkers(e)},e.prototype.getMarkersData=function(e,t,o,i,r){var n=this;return void 0===t&&(t=5e3),this.broker.getAll(e,o||["_id","title","_geoloc","address"],null,null,i,null,0,t,!1,r).pipe(F.map(function(e){return{markers:n.getMarkers(e.data),legendColors:{available:"energized",booked:"info",validated:"success",rejected:"danger",tobevalidated:"royal",archived:"dark"}}}))},e.prototype.getLegendColors=function(){return{available:"energized",booked:"info",validated:"success",rejected:"danger",tobevalidated:"royal",archived:"dark"}},e.prototype.getLastVisitDate=function(e,t){var o=[[{field:"locationRef",operator:{_id:"inq"},value:e},{field:"ownerRef",operator:{_id:"eq"},value:t||this.session.userId},{field:"status",operator:{_id:"eq"},value:"finished"}]];return this.broker.aggregateQuery("missions",o,[{$group:{_id:"$locationRef",finishedDate:{$max:"$finishedDate"},count:{$sum:1}}}],null,null,!1,null)},e.prototype.getStatsAndDistanceTransformAsync=function(t){var o=this;return function(r){return new v.Observable(function(i){if(r&&r.data&&0<r.data.length){t&&(r.data=o.calculateDistanceAndKpiData(r,t));var e=r.data.map(function(e){return e._id});o.getLastVisitDate(e).subscribe(function(o){r.data.forEach(function(t){var e=o.find(function(e){return e._id===t._id});e&&e.finishedDate&&(t.lastVisit=e.finishedDate,t.countVisits=e.count),i.next({count:r.count,data:r.data}),i.complete()})})}else i.next({count:0,data:[]}),i.complete()})}},e.prototype.getDistanceTransform=function(){var i=this;return this.geoloc.getLocation().then(function(o){return function(t){return new v.Observable(function(e){t&&t.data&&0<t.data.length?(t.data=i.calculateDistanceAndKpiData(t,o),e.next({count:t.count,data:t.data})):e.next({count:0,data:[]}),e.complete()})}})},e.prototype.getDistanceAndLastVisitTransform=function(t){var o=this;return function(r){return new v.Observable(function(i){if(r&&r.data&&0<r.data.length){r.data=o.calculateDistanceAndKpiData(r,t);var e=r.data.map(function(e){return e._id});o.getLastVisitDate(e).subscribe(function(o){r.data.forEach(function(t){var e=o.find(function(e){return e._id===t._id});e&&e.finishedDate&&(t.lastVisit=e.finishedDate,t.countVisits=e.count),i.next({count:r.count,data:r.data}),i.complete()})})}else i.next({count:0,data:[]}),i.complete()})}},e.prototype.calculateDistanceAndKpiData=function(e,i){var r=this;return e.data.map(function(e){e._geoloc&&i&&T.isNumber(i.latitude)&&T.isNumber(i.longitude)&&(e.distance=r.geoloc.getDistance(i.latitude,i.longitude,e._geoloc[1],e._geoloc[0]));var t=e.kpiData,o=[];return r.session.tenant&&r.session.tenant.locationKpis&&0<r.session.tenant.locationKpis.length&&r.session.tenant.locationKpis.forEach(function(e){(r.authentication.isAdmin()||"healthscore"===e.category&&r.authentication.hasRole("healthscore")||"healthscore"!==e.category&&r.authentication.hasRole("storeinsights"))&&o.push({category:e.category,value:t&&t[e.category]?t[e.category].value:null,icon:e.icon,extraSymbol:e.extraSymbol,variation:t&&t[e.category]?t[e.category].variation:null})}),e.kpiData=o,e})},e.prototype.getAroundMeFilter=function(t,o,e){var i,r,n,a=this;return this.geoloc.getLocation(e).then(function(e){return n=o?a.getStatsAndDistanceTransformAsync(e):a.getDistanceAndLastVisitTransform(e),t&&e?(r=[],i=[[{field:"_geoloc",operator:{_id:"nearSphere"},value:[e.longitude,e.latitude],max:4e4}]]):(i=[[]],r=[{colId:"title",sort:"asc"}]),{filters:i,sortModel:r,mapTransform:n,position:e}})},e.prototype.getLocationTypesTransform=function(){var n=this;return function(o,e,t,i,r){return new v.Observable(function(e){if(o&&o.data&&0<o.data.length){var t=o.data.map(function(e){return e._id});n.getLocationTypesStat(t).subscribe(function(i){o.data.forEach(function(t){var e=i.find(function(e){return e._id===t._id}),o=e&&e.count||0;t.count=o}),e.next({count:o.count,data:o.data}),e.complete()})}else e.next({count:0,data:[]}),e.complete()})}},e.prototype.getLocationTypesStat=function(e){var t=[[{field:"typeRef",operator:{_id:"inq"},value:e}]];return this.broker.aggregateQuery("locations",t,[{$project:{_id:"$typeRef"}},{$group:{_id:"$_id",count:{$sum:1}}}])},e.prototype.getHealthscore=function(o,e){var i=this;if(void 0===e&&(e=[7,30,90]),this.network.isOffline())return v.from(this.cache.get(q.healthscore,o));var t=this.config.apiUrl+"locations/healthScore?storeId="+o+"&days=["+e.toString()+"]";return this.rq.get(t).pipe(F.map(function(e){var t=e.data?e.data:e;return i.cache.add(q.healthscore,o,t),t}))},e.prototype.getUserLocations=function(e){var t=this.config.apiUrl+"businesslogic/getUserLocations";return this.rq.post(t,{userId:e})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:$},{type:ee},{type:k},{type:I},{type:t},{type:g.Network},{type:R},{type:Be},{type:W}]},e}(),Xe=function(){function e(e){this.session=e,this._client=window.loopbackClient,this._client&&this._client.setAccessToken(this.session.token)}return Object.defineProperty(e.prototype,"client",{get:function(){return this._client},enumerable:!0,configurable:!0}),e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:t}]},e}(),Ze=["mission","service","poll","todo","lesson"],et=["booked","finished","archived","scheduled"],tt='type == "poll"',ot='type == "mission"',it="quizz == 1",rt='type == "service"',nt='not (type == "service")',at='not (type == "service") and not (type == "poll")',st='type=="poll" or type=="service"';function lt(e,t,o){}var pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("MissionDescription",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:1}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("MissionDescription",{type:b.FormFieldType.autocomplete,title:"TYPE",values:Ze,translate:!0,clearable:!1,required:!0,exportOrder:3,filterable:!0,onChange:lt}),x("design:type",String)],t.prototype,"type",void 0),A([oe("MissionDescription",{required:!0,title:"TITLE",sortable:!0,type:b.FormFieldType.text,exportOrder:2}),ie("MissionDescription"),x("design:type",String)],t.prototype,"title",void 0),A([oe("MissionDescription",{required:!0,title:"DESCRIPTION",type:b.FormFieldType.textarea,filterable:!1,sortable:!1,language:"html"}),x("design:type",String)],t.prototype,"text",void 0),A([oe("MissionDescription",{type:b.FormFieldType.autocomplete,filters:Fe,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,fixedPosition:!0,maxWidth:160,maxHeight:160,crop:"circle",collectionName:"files",title:"ICON",required:!0,flex:50,columnDefinition:{name:"_downloadURL"},filterable:!1,sortable:!1}),x("design:type",Object)],t.prototype,"icon",void 0),A([oe("MissionDescription",{title:"CAMPAIGNTAGS",filterable:!0,type:b.FormFieldType.autocomplete,clearable:!0,tag:!0,allowCustomTag:!0,collectionName:"missiondescriptions",multiple:!0,subQuery:{field:"descriptionRef",values:"_id"},filters:[[{field:"archived",operator:{_id:"neq"},value:!0}]],icon:"yo-tag",secondary:!0}),x("design:type",Array)],t.prototype,"tags",void 0),t=A([re({className:"MissionDescription",collectionName:"missiondescriptions",fields:["_ect","_id","_lmt","_tenant","_tenantRef","allowMultiple","allowSameUserValidation","archived","audit","autoRenew","autoRenewOnBooking","background","bookingDuration","category","categoryRef","count","duration","finishedGroups","generateTitle","group","icon","language","locationOptions","missionTags","multiple","notificationemail","notify","notifyBody","notifyScheduledDate","pdfMode","price","priority","public","quizz","quizzMode","recurring","scoring","showAnswers","skipValidation","submittext","successtext","tags","text","title","type","validFrom","validUntil","versionmin","storesQuery"],include:["_tenant"],icon:"yo-campaign"})],t)}(b.IMissionDescription),ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("MissionDescriptionCreate",{required:!0,title:"TITLE",sortable:!0,type:b.FormFieldType.text,exportOrder:2}),x("design:type",String)],t.prototype,"title",void 0),A([oe("MissionDescriptionCreate",{required:!0,title:"DESCRIPTION",type:b.FormFieldType.textarea,filterable:!1,sortable:!1,language:"html"}),x("design:type",String)],t.prototype,"text",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.autocomplete,filters:Fe,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,fixedPosition:!0,maxWidth:160,maxHeight:160,crop:"circle",collectionName:"files",title:"ICON",required:!0,columnDefinition:{name:"_downloadURL"},filterable:!1,sortable:!1}),x("design:type",Object)],t.prototype,"icon",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.autocomplete,values:T.range(1,5)}),x("design:type",Object)],t.prototype,"priority",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.toggle,condition:[ot],title:"AUDIT",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"audit",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.toggle,condition:[ot],title:"RECURRING",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"recurring",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.toggle,condition:tt,columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"allowMultiple",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.toggle,condition:tt,title:"QUIZZ",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"quizz",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.autocomplete,condition:it,flex:100,title:"MODE",values:["ALLANSWERSVALID","ALLOWUNVALIDANSWERS","LIVEANSWERS"],translate:!0,columnDefinition:{width:80}}),x("design:type",String)],t.prototype,"quizzMode",void 0),A([oe("MissionDescriptionCreate",{type:b.FormFieldType.toggle,condition:it,flex:100,title:"SHOWANSWERS",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"showAnswers",void 0),A([oe("MissionDescription",{type:b.FormFieldType.autocomplete,required:!0,condition:st,title:"LANGUAGE",flex:100,translate:!0,values:m.Translate.availablesLanguageAll,clearable:!1}),x("design:type",String)],t.prototype,"language",void 0),A([oe("MissionDescriptionCreate",{title:"CAMPAIGNTAGS",filterable:!0,type:b.FormFieldType.autocomplete,clearable:!0,tag:!0,allowCustomTag:!0,collectionName:"missiondescriptions",multiple:!0,subQuery:{field:"descriptionRef",values:"_id"},icon:"yo-tag",secondary:!0}),x("design:type",Array)],t.prototype,"tags",void 0),A([oe("MissionDescriptionCreate",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"}}),x("design:type",Se)],t.prototype,"_tenant",void 0),t=A([re({className:"MissionDescriptionCreate"})],t)}(b.IMissionDescription),ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("MissionDescriptionSchedule",{title:"MISSIONVALIDFROMTOOLTIP",type:b.FormFieldType.datetime,condition:nt,externalValidators:[{externalFieldName:"validUntil",rule:"lower"}]}),x("design:type",Date)],t.prototype,"validFrom",void 0),A([oe("MissionDescriptionSchedule",{title:"MISSIONVALIDUNTILTOOLTIP",type:b.FormFieldType.datetime,condition:nt,externalValidators:[{externalFieldName:"validFrom",rule:"higher"}]}),x("design:type",Date)],t.prototype,"validUntil",void 0),A([oe("MissionDescriptionSchedule",{title:"MISSIONDUEDATE",type:b.FormFieldType.datetime,condition:nt}),x("design:type",Date)],t.prototype,"duedate",void 0),t=A([re({className:"MissionDescriptionSchedule"})],t)}(b.IMissionDescription),dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("MissionDescriptionNotifications",{type:b.FormFieldType.toggle,condition:nt}),x("design:type",Boolean)],t.prototype,"notify",void 0),A([oe("MissionDescriptionNotifications",{title:"NOTIFICATION",required:!0,condition:"notify == 1",type:b.FormFieldType.textarea}),x("design:type",String)],t.prototype,"notifyBody",void 0),A([oe("MissionDescriptionNotifications",{title:"SCHEDULEDDATE",required:!1,condition:"notify == 1",type:b.FormFieldType.datetime}),x("design:type",Date)],t.prototype,"notifyScheduledDate",void 0),A([oe("MissionDescriptionNotifications",{title:"NOTIFICATIONEMAILS",type:b.FormFieldType.emailreport,showUsers:!0,stateful:!1,filterable:!1,sortable:!1}),x("design:type",Array)],t.prototype,"notificationemail",void 0),A([oe("MissionDescriptionNotifications",{type:b.FormFieldType.toggle,columnDefinition:{width:80},suppressExport:!0}),x("design:type",Boolean)],t.prototype,"disableLocationNotificationemail",void 0),A([oe("MissionDescriptionNotifications",{title:"PDFEXPORT",type:b.FormFieldType.selectcard,translate:!0,values:[{title:"PDFCLASSIC",description:"PDFCLASSICDESCRIPTION",value:"PDFCLASSIC"},{title:"PDFPHOTOREPORT",description:"PDFPHOTOREPORTDESCRIPTION",value:"PDFPHOTOREPORT"},{title:"PDFAUDITEXPORTS",description:"PDFAUDITEXPORTSDESCRIPTION",value:"PDFAUDITEXPORTS"},{title:"PDFCONTRACT",description:"PDFCONTRACTDESCRIPTION",value:"PDFCONTRACT"}],filterable:!1}),x("design:type",String)],t.prototype,"pdfMode",void 0),t=A([re({className:"MissionDescriptionNotifications"})],t)}(b.IMissionDescription),yt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("MissionDescriptionSettings",{required:!0,title:"MISSIONGROUPS",header:"PERMISSIONS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1}),x("design:type",Array)],t.prototype,"group",void 0),A([oe("MissionDescriptionSettings",{required:!1,title:"MISSIONGROUPS",type:b.FormFieldType.autocomplete,condition:rt,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1}),x("design:type",Array)],t.prototype,"serviceGroups",void 0),A([oe("MissionDescriptionSettings",{required:!1,title:"FINISHEDGROUPS",type:b.FormFieldType.autocomplete,condition:[ot],collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!0}),x("design:type",Array)],t.prototype,"finishedGroups",void 0),A([oe("MissionDescriptionSettings",{multiple:!0,type:b.FormFieldType.autocomplete,exportOrder:15,values:b.IRoles,translate:!0,filterableAdvanced:!0}),x("design:type",Array)],t.prototype,"roles",void 0),A([oe("MissionDescriptionSettings",{title:"CATEGORIES",type:b.FormFieldType.autocomplete,tag:!0,collectionName:"missions",multiple:!0,subQuery:{field:"descriptionRef",values:"_id"},icon:"yo-flag",filterable:!1}),x("design:type",Array)],t.prototype,"missionTags",void 0),A([oe("MissionDescriptionSettings",{header:"COMPLIANCE",type:b.FormFieldType.toggle,title:"SKIPVALIDATION",columnDefinition:{width:80},filterableAdvanced:!0}),x("design:type",Boolean)],t.prototype,"skipValidation",void 0),A([oe("MissionDescriptionSettings",{type:b.FormFieldType.toggle,title:"ALLOWSAMEUSERVALIDATION",condition:[j.isManager,j.isAdminOrClientAdmin],columnDefinition:{width:80},filterableAdvanced:!0}),x("design:type",Boolean)],t.prototype,"allowSameUserValidation",void 0),A([oe("MissionDescriptionSettings",{header:"MISSIONSETTINGS",type:b.FormFieldType.toggle,condition:at,flex:100}),x("design:type",Boolean)],t.prototype,"autoRenew",void 0),A([oe("MissionDescriptionSettings",{type:b.FormFieldType.toggle,condition:[at]}),x("design:type",Boolean)],t.prototype,"autoRenewOnBooking",void 0),A([oe("MissionDescriptionSettings",{title:"CHECK",clearable:!0,type:b.FormFieldType.selectcard,values:[{title:"AVAILABLE",description:"CHECKAVAILABLE",value:"CHECKAVAILABLE"},{title:"EXISTING",description:"CHECKEXISTING",value:"CHECKEXISTING"}],translate:!0,condition:at}),x("design:type",String)],t.prototype,"locationOptions",void 0),A([oe("MissionDescriptionSettings",{header:"MISC",required:!1,title:"MISSIONDURATION",type:b.FormFieldType.number}),x("design:type",Number)],t.prototype,"duration",void 0),A([oe("MissionDescriptionSettings",{condition:rt,title:"SUBMITTEXT",type:b.FormFieldType.text,filterable:!1,sortable:!1}),x("design:type",String)],t.prototype,"submittext",void 0),A([oe("MissionDescriptionSettings",{condition:rt,title:"SUCCESSTEXT",type:b.FormFieldType.text,filterable:!1,sortable:!1}),x("design:type",String)],t.prototype,"successtext",void 0),A([oe("MissionDescriptionSettings",{title:"VERSIONMIN",type:b.FormFieldType.text,sortable:!1,condition:j.isAdmin,filterableAdvanced:!0}),x("design:type",String)],t.prototype,"versionmin",void 0),t=A([re({className:"MissionDescriptionSettings"})],t)}(b.IMissionDescription),ft="isPercentage == 1",gt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Scoring",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"title",void 0),A([oe("Scoring",{type:b.FormFieldType.textarea}),x("design:type",String)],t.prototype,"description",void 0),A([oe("Scoring",{title:"INITIALSCORE",type:b.FormFieldType.number,advanced:!0,condition:j.isAdmin}),x("design:type",Number)],t.prototype,"initialValue",void 0),A([oe("Scoring",{title:"MINSCOREFORVALIDATION",type:b.FormFieldType.number,advanced:!0}),x("design:type",Number)],t.prototype,"minValue",void 0),A([oe("Scoring",{type:b.FormFieldType.checkbox,title:"ISPRIMARYSCORE",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"isActive",void 0),A([oe("Scoring",{type:b.FormFieldType.checkbox,title:"ISLIVE",columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"isLive",void 0),A([oe("Scoring",{type:b.FormFieldType.checkbox,title:"PERCENTAGE",columnDefinition:{width:80},advanced:!0}),x("design:type",Boolean)],t.prototype,"isPercentage",void 0),A([oe("Scoring",{title:"TOTAL",type:b.FormFieldType.number,condition:ft,required:!0}),x("design:type",Number)],t.prototype,"percentageBasis",void 0),A([oe("Scoring",{type:b.FormFieldType.autocomplete,multiple:!0,title:"FIELDS",displayType:"formfield"}),x("design:type",Array)],t.prototype,"selectedFields",void 0),t=A([re({className:"Scoring"})],t)}(b.IScoring),mt=function(){function e(){}return e.getFieldTransform=function(e){return void 0===e&&(e=[]),G.getFieldTransform(e)},e.getFields=function(e,t,o){return void 0===t&&(t=[]),void 0===o&&(o=[]),G.getFields(e,t,o)},e.getFieldsFromSlides=function(e,t,o){return void 0===t&&(t=[]),void 0===o&&(o=[]),G.getFieldsFromSlides(e,t,o)},e.getFormFields=function(e,i,r){void 0===r&&(r=!1);var t=G.getFields(e,null,["information"]);return t=t.reduce(function(e,t){var o=T.cloneDeep(t);return o.name+=".value",o.operators=G.getFieldOperator(t),e.push(o),t.allowComments&&r&&((o=T.cloneDeep(t)).title=i.polyglot(o.title)+" .C",o.name+=".comments",o.type=b.FormFieldType.text,e.push(o)),t.allowTime&&r&&((o=T.cloneDeep(t)).title=i.polyglot(o.title)+" .T",o.name+=".time",o.type=b.FormFieldType.datetime,e.push(o)),e},[]),"service"===e.type&&(t.unshift({name:"mission.status",title:"STATUS",type:b.FormFieldType.autocomplete,translate:!0,values:T.uniq(T.concat(et,[undefined])),handleUndefined:!0,columnDefinition:{cellRenderer:"missionStatusRenderer"},operators:G.getFieldOperator({type:b.FormFieldType.autocomplete})}),t.unshift({name:"mission.creatorDisplayName",title:"REQUESTOR",type:b.FormFieldType.text,operators:G.getFieldOperator({type:b.FormFieldType.text})}),t.unshift({name:"mission._ect",title:"CREATIONDATE",type:b.FormFieldType.datetime,operators:G.getFieldOperator({type:b.FormFieldType.datetime})})),e.scoring&&0<e.scoring.length&&T.forEach(e.scoring,function(e){!0!==e.isActive?t.unshift({name:"extraScores."+e.title+".value",title:e.title,type:b.FormFieldType.number}):t.unshift({name:"score.value",title:e.title,type:b.FormFieldType.number})}),t},e.encodeScoringValue=function(e){return e&&e.toString?e.toString().replace(/\./,"_"):e},e.decorators=[{type:h.Injectable}],e}(),ht=function(){function e(e,t,o,i){this.rq=e,this.config=t,this.authentication=o,this.files=i,this.excludedDashboardColumns=["validated","validatedBy","owner.username","creator.username","user.username"]}return e.prototype.printToMapping=function(e,t,o,i,r,n,a,s,l){var p=this,u=G.getPublicCollectionName(e),c=this.config.publicApiUrl+u+"/export";n="xlsx"===n?"xlsx":"csv",i&&(o.subQuery=i);var d=G.getModelByCollectionName(e);o.include=d.include;var y=T.sortBy(T.cloneDeep(t.filter(function(e){return!e.suppressExport})),function(e){return e.exportOrder||100}).map(function(e){return e.field&&(e.field=e.field.replace(/\?/g,"")),e});(this.authentication.isDashboard()&&(y=y.filter(function(e){return p.excludedDashboardColumns.indexOf(e.field)<0})),s=this.files.cleanFileName(s||u)+this.rq.getFilenameSuffix()+"."+n,a&&0<a.length)&&(T.uniq(a.filter(function(e){return e.type===b.FormFieldType.catalog}).map(function(e){return e.catalog})).length,T.compact(T.uniq(a.filter(function(e){return e.type===b.FormFieldType.autocomplete}).map(function(e){return e.collectionName}))).length);return delete(o=T.cloneDeep(o)).fields,this.rq.get(c,!1,null,[{name:"filter",value:JSON.stringify(o)},{name:"type",value:"xlsx"===n?"excel":"csv"}]).toPromise().then(function(e){if(e._id)return v.timer(1e3,500).pipe(F.concatMap(function(){return p.rq.get(p.config.publicApiUrl+"jobs/"+e._id,!1,null).pipe(F.catchError(function(){return v.of({})}))})).pipe(F.filter(function(e){return l&&e&&e.progress&&l.emit(100*e.progress),e&&1===e.progress})).pipe(F.take(1)).toPromise().then(function(e){var t=T.get(e,"data.output.data.download_url");if(t)return b.downloadFile(t,s)})})},e.prototype.printToSpreadsheet=function(e,t,o,i,r,n,a,s,l){var p=this,u=this.config.apiUrl+"print/write-spreadsheet",c=G.fixCollectionName(e);a="csv"===a?"csv":"xlsx",i&&(o.subQuery=i);var d=G.getModelByCollectionName(e);o.include=d.include;var y=T.sortBy(T.cloneDeep(t.filter(function(e){return!e.suppressExport})),function(e){return e.exportOrder||100}).map(function(e){return e.field&&(e.field=e.field.replace(/\?/g,"")),e});this.authentication.isDashboard()&&(y=y.filter(function(e){return p.excludedDashboardColumns.indexOf(e.field)<0}));var f="csv"===a?"text/plain":"application/xlsx";l=this.files.cleanFileName(l||c)+this.rq.getFilenameSuffix()+"."+a;var g={};if(s&&0<s.length){var m=T.uniq(s.filter(function(e){return e.type===b.FormFieldType.catalog}).map(function(e){return e.catalog}));0<m.length&&(g.products={where:{catalogRef:{inq:m}}});var h=T.compact(T.uniq(s.filter(function(e){return e.type===b.FormFieldType.autocomplete}).map(function(e){return e.collectionName})));0<h.length&&(g.custommodels={where:{name:{inq:h}},cacheKey:"name"})}var v={collectionName:c,columns:y,query:o,aggregateOptions:r,channel:n,type:a,cacheQuery:g};return this.rq.downloadFile(l,f,u,{method:"post",headers:{"Content-Type":"application/json"},body:v})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:I},{type:Be},{type:K}]},e}(),vt='getAttributeValue("_ect")',bt='not getAttributeValue("_ect")',Ft="not (isRole == 1)",Tt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Group",{required:!0,title:"ID",type:b.FormFieldType.text,readonly:vt,forceExport:!0,exportOrder:1}),ie("Group"),x("design:type",String)],t.prototype,"_id",void 0),A([oe("Group",{required:!1,type:b.FormFieldType.text}),ie("Group"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Group",{required:!1,type:b.FormFieldType.textarea}),ie("Group"),x("design:type",String)],t.prototype,"description",void 0),A([oe("Group",{type:b.FormFieldType.autocomplete,filters:Te,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,clearable:!0,fixedPosition:!0,maxWidth:160,maxHeight:160,crop:"circle",collectionName:"files",title:"ICON",columnDefinition:{name:"_downloadURL"},filterable:!1,sortable:!1}),x("design:type",Object)],t.prototype,"icon",void 0),A([oe("Group",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,condition:[j.isAdmin,Ft],collectionName:"tenants",multiple:!1,columnDefinition:{name:"name"}}),x("design:type",Se)],t.prototype,"_tenant",void 0),A([oe("Group",{type:b.FormFieldType.toggle,condition:[bt,j.isAdmin]}),x("design:type",Boolean)],t.prototype,"team",void 0),A([oe("Group",{title:"ROLE",type:b.FormFieldType.toggle,condition:[j.isAdmin]}),x("design:type",Boolean)],t.prototype,"isRole",void 0),A([oe("Group",{type:b.FormFieldType.toggle,condition:[bt,j.isAdmin]}),x("design:type",Boolean)],t.prototype,"service",void 0),A([oe("Group",{readonly:!0,visible:!1,forceExport:!0,filterable:!1,columnDefinition:{name:"list.length"},type:b.FormFieldType.number,exportOrder:2}),x("design:type",Object)],t.prototype,"users",void 0),A([oe("Group",{readonly:!0,visible:!1,forceExport:!0,filterable:!1,columnDefinition:{name:"length"},type:b.FormFieldType.number,exportOrder:3}),x("design:type",Object)],t.prototype,"groups",void 0),A([oe("Group",{name:"_ect",title:"CREATIONDATE",type:b.FormFieldType.date,readonly:!0}),x("design:type",Object)],t.prototype,"_ect",void 0),t=A([re({className:"Group",collectionName:"groups",fields:["*"],include:["_tenant"],icon:"yo-group"})],t)}(b.IGroup),St=function(){function e(e,t,o){this.broker=e,this.rq=t,this.config=o}return e.prototype.getUserSession=function(e){return this.rq.post(this.broker.getApiUrl()+"businesslogic/getUserSession",{userId:e})},e.prototype.addGroupUsers=function(e,t){return this.initGroup(e),e._id?this.broker.patch("groups",{_id:e._id,$addToSet:{"users.list":{$each:T.map(t,"_id")}}}):(e.users.list=T.uniq(T.concat(e.users.list,T.map(t,"_id"))),this.broker.create("groups",e))},e.prototype.removeGroupUsers=function(e,t){return this.initGroup(e),e._id?this.broker.patch("groups",{_id:e._id,$pullAll:{"users.list":T.map(t,"_id")}}):(e.users.list=T.uniq(T.difference(e.users.list,T.map(t,"_id"))),this.broker.create("groups",e))},e.prototype.addGroupGroups=function(e,t){return this.initGroup(e),e._id?this.broker.patch("groups",{_id:e._id,$addToSet:{groups:{$each:T.map(t,"_id")}}}):(e.groups=T.uniq(T.concat(e.groups,T.map(t,"_id"))),this.broker.create("groups",e))},e.prototype.removeGroupGroups=function(e,t){return this.initGroup(e),e._id?this.broker.patch("groups",{_id:e._id,$pullAll:{groups:T.map(t,"_id")}}):(e.groups=T.uniq(T.difference(e.groups,T.map(t,"_id"))),this.broker.create("groups",e))},e.prototype.updateGroup=function(e,t,o,i,r){var n=this;return void 0===o&&(o=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),this.broker.patch("groups",{_id:e,$pullAll:{"users.list":T.map(o,"_id"),groups:T.map(r,"_id")}}).pipe(F.flatMap(function(){return n.broker.patch("groups",{_id:e,$addToSet:{"users.list":{$each:T.map(t,"_id")},groups:{$each:T.map(i,"_id")}}})}))},e.prototype.initGroup=function(e){e.groups=e.groups||[],e.users=e.users||{},e.users.list=e.users.list||[]},e.prototype.getGroupUserSubQuery=function(e){return{collectionName:"group",where:{_id:e._id},field:"_id",values:"users.list"}},e.prototype.getGroupGroupSubQuery=function(e){return{collectionName:"group",where:{_id:e._id},field:"_id",values:"groups"}},e.prototype.getAncestry=function(t,o){void 0===o&&(o="descendants");var e=this.config.apiUrl+"groups/getAncestry";return this.rq.post(e,{groupIds:t}).pipe(F.map(function(e){return"descendants"===o?T.uniq([].concat(e.descendants||[]).concat(t||[])):"ancestors"===o?T.uniq([].concat(e.groups||[]).concat(t||[])):"both"===o?T.uniq([].concat(e.descendants||[]).concat(e.groups||[]).concat(t||[])):void 0}))},e.ROLES=M,e.ROLES_ASK=B,e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:ee},{type:k},{type:I}]},e}(),_t=function(){function e(e,t,o){this.rq=e,this.broker=t,this.config=o}return e.prototype.clone=function(e,t,o){var i=this;return this.rq.post(this.broker.getApiUrl()+"demoManagement/CopyTenantToTenant",{copyFromId:e._id,copyToId:t._id}).toPromise().then(function(e){if(e._id)return v.timer(1e3,500).pipe(F.concatMap(function(){return i.rq.get(i.config.publicApiUrl+"jobs/"+e._id,!1,null).pipe(F.catchError(function(){return v.of({})}))})).pipe(F.filter(function(e){return o&&e&&e.progress&&o.emit(100*e.progress),e&&1===e.progress})).pipe(F.take(1)).toPromise().then(function(e){var t=T.get(e,"data.output.errors");return{data:T.get(e,"data.output.data"),errors:t}})})},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:k},{type:ee},{type:I}]},e}(),Ot=function(){function n(e,t){this.broker=e,this.rq=t}return n.prototype.getSimplifiedProfile=function(e){return this.broker.getById("user",e,n.simplifiedFields)},n.prototype.getFreshdeskUrl=function(){var e=this.broker.getApiUrl()+"endpoints/getFreshdeskUrl";return this.rq.post(e,{host_url:"support-mobile.operations.yoobic.com"}).pipe(F.map(function(e){return e}))},n.prototype.setAcl=function(e,t){this.broker.setAcl(e,t)},n.prototype.getCustomFilterNoAdmin=function(e){void 0===e&&(e=!0);var t=n.adminIds.map(function(e){return e._id});return e||t.push(this.rq.session.userId),{_id:{nin:t}}},n.prototype.isUsernameTaken=function(e){return this.rq.post(this.broker.getApiUrl()+"businesslogic/isUsernameTaken",{params:{username:e}}).pipe(F.map(function(e){return e.data}))},n.prototype.getUsersByLocation=function(e){return this.broker.getAll("user",n.simplifiedFields,null,null,[[{field:"locationRef",operator:{_id:"eq"},value:e}]]).pipe(F.map(function(e){return e.data}))},n.prototype.getGeofilterUsers=function(e,i){var r=this,t={limit:0,fields:["userRef"],subQuery:{collectionName:"locations",field:"locationsRef",values:"_id",where:{_id:{inq:[e]}}}};return this.broker.getAllQuery("geofilters",t).pipe(F.mergeMap(function(e){var t=e.data.map(function(e){return e.userRef}),o=[[{field:"_id",operator:{_id:"inq"},value:t=T.uniq(t)}]];return i&&0<i.length&&o[0].push({field:"tags",operator:{_id:"inq"},value:i}),r.broker.getAll("user",n.simplifiedFields,null,null,o).pipe(F.map(function(e){return e.data}))}))},n.adminIds=[{_id:"53fb03c6546847ee0536386a"}],n.simplifiedFields=["_id","imageData","firstName","lastName","email","telephone","username"],n.decorators=[{type:h.Injectable}],n.ctorParameters=function(){return[{type:ee},{type:k}]},n}(),At=function(){function e(e,t){this.config=e,this.coreConfig=t}return e.prototype.get=function(e){var t=this.config.serverName.toUpperCase();return e&&"PRODUCTION"!==t?this.coreConfig.getAppVersion()+" - "+t:this.coreConfig.getAppVersion()},e.prototype.isCurrentVersionHigherThan=function(e){var t=this.coreConfig.getAppVersion();if(t===e)return!0;for(var o=t.split("."),i=e.split("."),r=Math.min(o.length,i.length),n=0;n<r;n++){if(parseInt(o[n],null)>parseInt(i[n],null))return!0;if(parseInt(o[n],null)<parseInt(i[n],null))return!1}return o.length>i.length||!(o.length<i.length)},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:I},{type:g.CoreConfig}]},e}(),xt=function(){function e(){}return e.prototype.readFile=function(i,r,n){return void 0===r&&(r="blob"),new Promise(function(t,o){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){return o(e)},"blob"===r?e.readAsDataURL(i):"binary"===r?e.readAsBinaryString(i):e.readAsText(i,n)})},e.prototype.read=function(r){return this.readFile(r,"binary").then(function(e){var t="";if(r.name.endsWith("csv"))t=e;else{var o=u.read(e,{type:"binary"}),i=o.Sheets[o.SheetNames[0]];t=u.utils.sheet_to_csv(i,{FS:";"})}return a.parse(t,{skipEmptyLines:!0}).data})},e.prototype.exportToFile=function(e,t,o,i){i=i||"data.csv",t=t||"data:application/csv;charset=ISO-8859-1;","base64"===(o=o||"charset=ISO-8859-1")&&(e=this.b64toBlob(e,t));var r=new Blob([e],{type:t});return this.saveBlob(r,i)},e.prototype.saveBlob=function(e,t){n(e,t)},e.prototype.getBase64MimeType=function(e){return e.split(";")[0].replace("data:","")},e.prototype.b64toBlob=function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=512),t||(t=this.getBase64MimeType(e)),e=e.replace("data:"+t+";base64,","").replace(/\s/g,"");for(var i=atob(e),r=[],n=0;n<i.length;n+=o){for(var a=i.slice(n,n+o),s=new Array(a.length),l=0;l<a.length;l++)s[l]=a.charCodeAt(l);var p=new Uint8Array(s);r.push(p)}return new Blob(r,{type:t})},e.prototype.readSheets=function(t){return this.readFile(t,"binary").then(function(e){var o=[];if(t.name.endsWith("csv"))o.push(a.parse(e,{skipEmptyLines:!0}).data);else{var i=u.read(e,{type:"binary"});i.SheetNames.forEach(function(e){var t=u.utils.sheet_to_csv(i.Sheets[e],{FS:";"});o.push(a.parse(t,{skipEmptyLines:!0}).data)})}return o})},e.prototype.write=function(e,t){var o=new Array,i=new Array;T.forEach(t,function(e){var l=!1,t=[],p=[];T.forEach(e.data,function(a){var s=[];T.forEach(e.columns,function(o){if(!1!==o.visible&&!0!==o.suppressExport&&!o.action||!0===o.forceExport){var i=T.get(a,o.name);if("address"===o.type&&"object"==typeof(i=i&&i.address?i.address:i)&&(i=null),"catalog"===o.type){delete i.valid;var r="";T.keys(i).forEach(function(t){var e=T.find(o.products,function(e){return e._id===t});e&&(r+=e.reference+" * "+i[t]+",")}),i=r}if("date"===o.type&&i){var e=b.toDate(i);e=b.dateAdd(e,"minutes",b.getUTCOffset(e)),i=e}if("time"===o.type&&i){var t=b.toDate(i);i=b.dateFormat(t,"HH:mm:ss")}if("datetime"===o.type&&i){var n=b.toDate(i);i=b.dateFormat(n,"L LT")}"_acl"===o.name&&(i=i.groups.r),i&&i._downloadURL&&(i=i._downloadURL),!T.isObject(i)||T.isDate(i)||T.isArray(i)||(i=null),s.push(i),l||p.push(o.displayName||o.name)}}),l=!0,t.push(s)}),o.push(t),i.push(p)});for(var r={SheetNames:[],Sheets:{},Props:null},n=0;n<o.length;n++){o[n].unshift(i[n]);var a=t[n].title||"SheetJs_"+n,s=this.sheetFromArrayOfArrays(o[n]);r.SheetNames.push(a),r.Sheets[a]=s}var l=u.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"}),p=e+"-"+b.dateFormat(new Date,"YYYY-MM-DDTHH:MM")+".xlsx";this.exportToFile(this.s2ab(l),"application/octet-stream","",p)},e.prototype.datenum=function(e,t){return t&&(e+=1462),(Date.parse(e)-new Date(Date.UTC(1899,11,30)))/864e5},e.prototype.sheetFromArrayOfArrays=function(e,t){for(var o={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},r=0;r!==e.length;++r)for(var n=0;n!==e[r].length;++n){i.s.r>r&&(i.s.r=r),i.s.c>n&&(i.s.c=n),i.e.r<r&&(i.e.r=r),i.e.c<n&&(i.e.c=n);var a={v:e[r][n]};if(null!==a.v){var s=u.utils.encode_cell({c:n,r:r});"number"==typeof a.v?a.t="n":"boolean"==typeof a.v?a.t="b":a.v instanceof Date?(a.t="n",a.z=u.SSF._table[14],a.v=this.datenum(a.v)):T.isArray(a.v)&&0<a.v.length&&T.isNumber(a.v[0])?(a.t="s",a.v="["+a.v.join(",")+"]"):T.isArray(a.v)&&0<a.v.length&&!T.isNumber(a.v[0])?(a.t="s",a.v=a.v.join(",")):T.isArray(a.v)&&0===a.v.length?(a.t="s",a.v=""):a.t="s",o[s]=a}}return i.s.c<1e7&&(o["!ref"]=u.utils.encode_range(i.s,i.e)),o},e.prototype.s2ab=function(e){for(var t=new ArrayBuffer(e.length),o=new Uint8Array(t),i=0;i!==e.length;++i)o[i]=255&e.charCodeAt(i);return t},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[]},e}(),Ct=function(){function e(e){this.translate=e}return e.prototype.transform=function(e){for(var s=this,l=[],t=1;t<arguments.length;t++)l[t-1]=arguments[t];if(!l||!l[0])return e;if(e){var p=l[3];return e.filter(function(e){if("string"==typeof e)return e&&0<=s.getStringToTest(e,p).toLowerCase().indexOf(l[0].toLowerCase());var t=l[1]||T.keys(e);t=[].concat(t);for(var o=!1,i=0;i<t.length;i++){var r=t[i];if(l[0]&&l[0].toLowerCase){if("string"==typeof e[r]||e[r]instanceof String){var n=s.getStringToTest(e[r],p).toLowerCase().indexOf(l[0].toLowerCase());o=o||(!1===l[2]?n<0:0<=n)}}else if(!l[0]&&l[1]){var a=e.hasOwnProperty(r)&&!b.isBlank(e[r]);o=o||(!1===l[2]?!a:a)}}return o})}},e.prototype.getStringToTest=function(e,t){return t&&this.translate?this.translate.get(e.toString().toUpperCase()):e},e.decorators=[{type:h.Pipe,args:[{name:"filter"}]}],e.ctorParameters=function(){return[{type:m.Translate}]},e}(),Dt=[L,Be,je,$e,J,He,ee,Ge,R,I,Ve,Qe,K,ze,W,We,Ye,Ke,w,Je,Xe,mt,G,ht,Me,k,St,t,$,_t,X,Ot,At,Y,xt],It=[Ct],Nt=function(){function t(){}return t.forRoot=function(e){return void 0===e&&(e=[]),{ngModule:t,providers:D(Dt,e,[o.FileTransfer,l.DocumentViewer,p.Device,d.FileOpener,y.OneSignal,f.Push,c.File,{provide:s.HTTP_INTERCEPTORS,useClass:Ye,deps:[I,g.Network,g.Log],multi:!0}])}},t.decorators=[{type:h.NgModule,args:[{declarations:D(It),imports:[g.CommonModule,m.TranslateModule,s.HttpClientModule],exports:D([g.CommonModule,m.TranslateModule,s.HttpClientModule],It)}]}],t}(),Et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t=A([re({className:"AggregateLog",collectionName:"aggregateLogs",fields:["*"],include:[]})],t)}(b.IAggregateLog),wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Algorithm",{required:!0,type:b.FormFieldType.text}),ie("Algorithm"),x("design:type",String)],t.prototype,"name",void 0),t=A([re({className:"Algorithm",collectionName:"algorithm",fields:["name","_id","stitch"],include:[]})],t)}(b.IAlgorithm),kt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("AutorenewConfig",{required:!0,type:b.FormFieldType.text}),ie("AutorenewConfig"),x("design:type",String)],t.prototype,"title",void 0),A([oe("AutorenewConfig",{required:!0,title:"PREFIX",type:b.FormFieldType.text,flex:50}),ie("AutorenewConfig"),x("design:type",String)],t.prototype,"prefix_title",void 0),A([oe("AutorenewConfig",{type:b.FormFieldType.autocomplete,translate:!0,values:T.range(1,5),flex:50,clearable:!0,icon:"yo-flag"}),x("design:type",Number)],t.prototype,"priority",void 0),A([oe("AutorenewConfig",{type:b.FormFieldType.autocomplete,title:"SOURCE",collectionName:"missiondescriptions",required:!1,columnDefinition:{name:"title"},icon:"yo-list2",filterable:!1,sortable:!1,filters:[[{field:"archived",operator:{_id:"neq"},value:!0}]],hiddenFields:["archived"]}),x("design:type",pt)],t.prototype,"descriptionSource",void 0),A([oe("AutorenewConfig",{type:b.FormFieldType.autocomplete,title:"TARGET",collectionName:"missiondescriptions",required:!1,columnDefinition:{name:"title"},icon:"yo-list2",filterable:!1,sortable:!1,filters:[[{field:"archived",operator:{_id:"neq"},value:!0}]],hiddenFields:["archived"]}),x("design:type",pt)],t.prototype,"descriptionTarget",void 0),A([oe("AutorenewConfig",{type:b.FormFieldType.toggle}),ie("AutorenewConfig"),x("design:type",Boolean)],t.prototype,"active",void 0),t=A([re({className:"AutorenewConfig",collectionName:"autorenewConfig",fields:["*"],include:["descriptionSource","descriptionTarget"]})],t)}(b.IAutorenewConfig),Lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Backup",{required:!1,type:b.FormFieldType.date}),x("design:type",Date)],t.prototype,"date",void 0),A([oe("Backup",{required:!0,type:b.FormFieldType.autocomplete,clearable:!0}),x("design:type",Object)],t.prototype,"backup",void 0),A([oe("Backup",{required:!1,type:b.FormFieldType.autocomplete,clearable:!0,multiple:!0,values:["missions","missiondescription","missiondatas","user","locations","locationtypes","missiondatas","photos"]}),x("design:type",Array)],t.prototype,"collections",void 0),t=A([re({className:"Backup",fields:["*"],include:[]})],t)}(b.IBackup),qt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Catalog",{required:!0,type:b.FormFieldType.text}),ie("Catalog"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Catalog",{type:b.FormFieldType.autocomplete,maxWidth:600,filters:Fe,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,fixedPosition:!0,maxHeight:300,crop:"square",collectionName:"files",title:"PHOTO",required:!0,columnDefinition:{name:"_downloadURL"}}),x("design:type",Object)],t.prototype,"image",void 0),A([oe("Catalog",{type:b.FormFieldType.textarea}),x("design:type",String)],t.prototype,"description",void 0),A([oe("Catalog",{title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1,required:!0}),x("design:type",String)],t.prototype,"group",void 0),t=A([re({className:"Catalog",collectionName:"catalogs",fields:["*"],include:[],icon:"yo-catalogue"})],t)}(b.ICatalog),Rt=["line","spline","area","areaspline","column","bar","radar","pie","doughnut","treemap"],Pt=["year","month","week","day","calendar"],Ut=["chart","grid","map","micro"],Mt=["d","dd","DD","w","MMM"],Bt=["last7days","lastweek","last30days","lastmonth","last90days","lastquarter","last365days","lastyear"],jt='showAs=="chart"',Gt='collectionName=="missions" or collectionName=="missiondatas"',$t='collectionName=="missiondatas"',Ht='collectionName=="missions"',Vt="groupByDate == 1";function Qt(e,t){e&&e.selectedDescription&&(t.title||(t.title=e.selectedDescription.title))}var zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("ChartDefinition",{title:"QUERYON",type:b.FormFieldType.autocomplete,translate:!0,values:["missions","missiondatas","custom"],clearable:!1,required:!0,autoselect:!0}),x("design:type",String)],t.prototype,"collectionName",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.missionfield,condition:$t,title:"CAMPAIGN",required:!0,onChange:Qt}),x("design:type",Object)],t.prototype,"missionfields",void 0),A([oe("ChartDefinition",{required:!0,type:b.FormFieldType.text}),ie("ChartDefinition"),x("design:type",String)],t.prototype,"title",void 0),A([oe("ChartDefinition",{required:!1,type:b.FormFieldType.textarea}),ie("ChartDefinition"),x("design:type",String)],t.prototype,"description",void 0),A([oe("ChartDefinition",{title:"SHOWAS",type:b.FormFieldType.autocomplete,flex:33,values:Ut}),x("design:type",String)],t.prototype,"showAs",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.autocomplete,values:Rt,flex:33,condition:jt,translate:!0,clearable:!1}),x("design:type",String)],t.prototype,"type",void 0),A([oe("ChartDefinition",{title:"PALETTE",type:b.FormFieldType.autocomplete,flex:34,condition:jt,translate:!0,values:["palette0","palette1","palette2","palette3"],clearable:!1,autoselect:!0}),x("design:type",String)],t.prototype,"palette",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.checkbox,flex:34,condition:Gt}),x("design:type",Boolean)],t.prototype,"groupByDate",void 0),A([oe("ChartDefinition",{title:"DATETIMEFORMAT",type:b.FormFieldType.autocomplete,flex:33,tag:!0,condition:Vt,values:Mt,clearable:!0}),x("design:type",String)],t.prototype,"datetimeFormat",void 0),A([oe("ChartDefinition",{title:"TIMESCALE",type:b.FormFieldType.autocomplete,flex:33,condition:Vt,values:Bt}),x("design:type",String)],t.prototype,"timescale",void 0),A([oe("ChartDefinition",{title:"GROUPBY",type:b.FormFieldType.autocomplete,translate:!0,flex:34,values:Pt,condition:Vt,clearable:!1}),x("design:type",String)],t.prototype,"dateGrouping",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.checkbox,flex:33,condition:Ht}),x("design:type",Boolean)],t.prototype,"groupByTag",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.checkbox,flex:33,condition:Ht}),x("design:type",Boolean)],t.prototype,"groupByCampaign",void 0),A([oe("ChartDefinition",{flex:33,type:b.FormFieldType.checkbox}),x("design:type",Boolean)],t.prototype,"showLegend",void 0),A([oe("ChartDefinition",{flex:33,type:b.FormFieldType.checkbox}),x("design:type",Boolean)],t.prototype,"showValues",void 0),A([oe("ChartDefinition",{flex:33,type:b.FormFieldType.checkbox}),x("design:type",Boolean)],t.prototype,"colorByPoint",void 0),A([oe("ChartDefinition",{type:b.FormFieldType.autocomplete,flex:34,values:["normal","percent"],clearable:!0}),x("design:type",String)],t.prototype,"stacked",void 0),A([oe("ChartDefinition",{required:!1,type:b.FormFieldType.textarea}),ie("ChartDefinition"),x("design:type",String)],t.prototype,"custom",void 0),t=A([re({className:"ChartDefinition",collectionName:"chartdefinitions",fields:["*"],include:[]})],t)}(b.IChartDefinition),Wt=function(){function e(){}return A([oe("Currency",{required:!0,type:b.FormFieldType.autocomplete,title:"LANGUAGE",translate:!0,values:m.Translate.availablesLanguage,clearable:!1}),ie("Currency"),x("design:type",String)],e.prototype,"currency",void 0),A([oe("Currency",{required:!0,type:b.FormFieldType.text}),ie("Currency"),x("design:type",String)],e.prototype,"symbol",void 0),A([oe("Currency",{required:!0,type:b.FormFieldType.number,title:"RATE1"}),ie("Currency"),x("design:type",Number)],e.prototype,"rate",void 0),e=A([re({className:"Currency",collectionName:"currencies",fields:["*"],include:[]})],e)}(),Yt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Dashboard",{required:!0,type:b.FormFieldType.text,sortable:!0}),ie("Dashboard"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Dashboard",{required:!1,type:b.FormFieldType.textarea}),ie("Dashboard"),x("design:type",String)],t.prototype,"description",void 0),A([oe("Dashboard",{name:"_lmt",title:"DATE",type:b.FormFieldType.datetime,readonly:!0,sortable:!0,filterableAdvanced:!0,advanced:!0}),x("design:type",Object)],t.prototype,"_lmt",void 0),A([oe("Dashboard",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,collectionName:"tenants",columnDefinition:{name:"name"},multiple:!1,filterable:!0,condition:[j.isAdmin]}),x("design:type",Se)],t.prototype,"_tenant",void 0),t=A([re({className:"Dashboard",collectionName:"dashboards",fields:["*"],include:[]})],t)}(b.IDashboard),Kt=function Ao(e){"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e&&void 0!==e||(this._id=e)};function Jt(e,t){e&&e.name&&(t._filename=e.name),e&&e.size&&(t.size=e.size),e&&e.type&&(t.mimeType=e.type)}var Xt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("File",{name:"_ect",title:"CREATIONDATE",type:b.FormFieldType.date,readonly:!0,sortable:!0,exportOrder:21,filterableAdvanced:!0}),x("design:type",Object)],t.prototype,"_ect",void 0),A([oe("File",{type:b.FormFieldType.documentuploader,filterable:!1,required:!0,title:"DOCUMENT",columnDefinition:{width:52},onChange:Jt}),x("design:type",String)],t.prototype,"_downloadURL",void 0),A([oe("File",{title:"TITLE",required:!0,type:b.FormFieldType.text,sortable:!0}),ie("File"),x("design:type",String)],t.prototype,"_filename",void 0),A([oe("File",{visible:!1,type:b.FormFieldType.number,sortable:!0}),x("design:type",Number)],t.prototype,"size",void 0),A([oe("File",{visible:!1,type:b.FormFieldType.autocomplete,filterable:!0}),ie("File"),x("design:type",String)],t.prototype,"mimeType",void 0),A([oe("File",{type:b.FormFieldType.toggle,columnDefinition:{width:80}}),x("design:type",Boolean)],t.prototype,"hideMobile",void 0),A([oe("File",{required:!0,name:"group",columnDefinition:{name:"group",forceName:!0},title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1}),x("design:type",Object)],t.prototype,"group",void 0),A([oe("File",{type:b.FormFieldType.autocomplete,tag:!0,allowCustomTag:!0,collectionName:"files",multiple:!0,icon:"yo-flag",subQuery:{field:"fileRef",values:"_id"}}),ie("File"),x("design:type",Array)],t.prototype,"tags",void 0),A([oe("File",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,collectionName:"tenants",columnDefinition:{name:"name"},multiple:!1,filterable:!0,condition:[j.isAdmin]}),x("design:type",Se)],t.prototype,"_tenant",void 0),t=A([re({className:"File",collectionName:"files",fields:["*"],include:["container"],icon:"yo-file"})],t)}(b.IFile),Zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Folder",{title:"TITLE",required:!0,type:b.FormFieldType.text}),ie("Folder"),x("design:type",String)],t.prototype,"name",void 0),A([oe("Folder",{title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1,required:!0}),x("design:type",String)],t.prototype,"group",void 0),t=A([re({className:"Folder",collectionName:"folders",fields:["*"],include:["container"],icon:"yo-folder"})],t)}(b.IFolder),eo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([ie("FileOrFolder"),x("design:type",String)],t.prototype,"name",void 0),A([ie("FileOrFolder"),x("design:type",String)],t.prototype,"_filename",void 0),A([ie("FileOrFolder"),x("design:type",String)],t.prototype,"mimeType",void 0),t=A([re({className:"FileOrFolder",collectionName:"filesFolders",fields:["*"],include:["container"]})],t)}(b.IFileOrFolder);function to(e,t,o,i){var r=t?b.toDate(t):new Date;o=o||7;var n="days",a="day";switch(e){case"last30days":o=30,n="days";break;case"last90days":o=90,n="days";break;case"last365days":o=365,n="days";break;case"lastweek":o=0,n="weeks";break;case"lastmonth":o=0,n="months",a="month";break;case"lastquarter":o=2,n="months",a="month";break;case"lastyear":o=0,n="years",a="year";break;case"last7days":o=7,n="days",a="day";break;default:a=i?(o=o?o-1:0,n=e):(o=o||1,n=e,"day")}return[b.startOf(b.dateAdd(b.utc(r),n,-o),a).toISOString(),r.toISOString()]}var oo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.getChartDefinition=function(e,t,o){if(T.merge(t,{description:e.description,title:e.title,showAs:e.showAs||t.showAs||"chart",showValues:e.showValues,showLegend:!1!==e.showLegend,legendValue:e.accumulator}),e&&e.groupBySlider)switch(e.groupBySlider.toString()){case"day":t.dateGrouping="hour",e.dates={mode:"dynamic",amount:1,timescale:"day"};break;case"week":t.dateGrouping="day",e.dates={mode:"dynamic",amount:1,timescale:"week"};break;case"month":t.dateGrouping="week",e.dates={mode:"dynamic",amount:4,timescale:"week"};break;case"3months":t.dateGrouping="week",e.dates={mode:"dynamic",amount:3,timescale:"month"};break;case"6months":t.dateGrouping="month",e.dates={mode:"dynamic",amount:6,timescale:"month"};break;case"year":t.dateGrouping="month",e.dates={mode:"dynamic",amount:1,timescale:"year"}}},t.getDateFormat=function(e){var t="%Y-%m-%d";if(e&&e.toString)switch(e.toString()){case"day":t="%Y-%m-%d %H:00";break;case"week":t="%Y-%m-%d";break;case"month":case"3months":t="%G-%V";break;case"6months":t="%Y-%m";break;case"year":case"2":t="%Y-%m"}return t},t.getDates=function(e,t){var o={};if(e.dates&&("calendar"===e.dates.mode&&(e.dates.startDate&&(o.startDate=e.dates.startDate),e.dates.endDate&&(o.endDate=e.dates.endDate)),"dynamic"===e.dates.mode)){var i=this.getStartAndEndDates(e.dates.timescale,null,e.dates.amount,e.dates.notsliding);o.startDate=i[0],o.endDate=i[1]}return t&&(o.startDate&&(o.startDate=b.dateAdd(o.startDate,"years",-1).toISOString()),o.endDate&&(o.endDate=b.dateAdd(o.endDate,"years",-1).toISOString())),o},t.getStartAndEndDates=function(e,t,o,i){return to(e,t,o,i)},t.fixDates=function(e,t){if(!t)return(new Date).getTime();if("week"===e.dateGrouping||e.kpiFormValues&&"week"===e.kpiFormValues.groupBySlider&&"healthscore"!==e.kpiFormValues.category){var o=t.split("-")[0],i=t.split("-")[1],r=new Date(o,0,1+7*(i-1)),n=r.getDay(),a=r;return n<=4?a.setDate(r.getDate()-r.getDay()+1):a.setDate(r.getDate()+8-r.getDay()),a.getTime()}return new Date(t).getTime()},t.getColor=function(e){var t=g.Colors.black;return T.isNaN(e)||(e<33?t=g.Colors.danger:e<75?t=g.Colors.warning:75<=e&&(t=g.Colors.success)),t},t.setDateFilters=function(e,t,o,i){if(void 0===o&&(o="finishedDate"),void 0===i&&(i=!0),t.startDate||t.endDate){var r=void 0;i&&(e.push(T.cloneDeep(e[0])),(r={operator:{_id:"exists"},value:!1}).field=o,e[1].push(r)),t.startDate&&((r={operator:{_id:"gte"},value:t.startDate}).field=o,e[0].push(r)),t.endDate&&((r={operator:{_id:"lt"},value:t.endDate}).field=o,e[0].push(r))}},t.setLocationTagsFilters=function(e,t){t&&t.length&&e[0].push({field:"tags",collectionName:"locations",operator:{_id:"inq"},value:t,type:b.FormFieldType.autocomplete,subQuery:{field:"locationRef",values:"_id"}})},t.setUserTagsFilters=function(e,t){t&&t.length&&e[0].push({field:"tags",collectionName:"user",operator:{_id:"inq"},value:t,type:b.FormFieldType.autocomplete,subQuery:{field:"ownerRef",values:"_id",leftJoin:!0}})},t.setCampaignFilters=function(e,t,o,i){e&&0<e.length?o[0].unshift({field:"descriptionRef",operator:{_id:"inq"},value:e.map(function(e){return e._id})}):t&&0<t.length&&o[0].push({field:"tags",collectionName:"missiondescriptions",operator:{_id:"inq"},value:t,type:b.FormFieldType.autocomplete,subQuery:{field:"descriptionRef",values:"_id"}}),i&&o[0].push({field:"type",operator:{_id:"inq"},value:[i]})},t.getDateFormatMoment=function(e){var t="";if(e&&e.toString)switch(e.toString()){case"week":t="YYYY-WW";break;case"month":t="YYYY-MM";break;case"quarter":case"year":t="YYYY"}return t},A([oe("BaseKpi",{tabIndex:2,tab:"ADVANCED",type:b.FormFieldType.number,advanced:!0}),x("design:type",Boolean)],t.prototype,"pointPadding",void 0),A([oe("BaseKpi",{tabIndex:2,tab:"ADVANCED",type:b.FormFieldType.number,advanced:!0,min:1}),x("design:type",Number)],t.prototype,"numberPrecision",void 0),A([oe("BaseKpi",{tabIndex:2,tab:"ADVANCED",type:b.FormFieldType.autocomplete,translate:!0,values:["sum","avg","min","max"]}),x("design:type",String)],t.prototype,"accumulator",void 0),t=A([re({className:"BaseKpi"})],t)}(b.IKpi),io=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("IMapping",{required:!0,type:b.FormFieldType.documentuploader,filterable:!1,title:"DOCUMENT",extensions:["csv","application","xls","xlsx"]}),x("design:type",Object)],t.prototype,"document",void 0),t=A([re({className:"IMapping"})],t)}(b.IIMapping),ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([ie("Operation"),x("design:type",String)],t.prototype,"operationId",void 0),A([ie("Operation"),x("design:type",String)],t.prototype,"operationName",void 0),A([ie("Operation"),x("design:type",String)],t.prototype,"methodName",void 0),A([ie("Operation"),x("design:type",String)],t.prototype,"modelName",void 0),A([oe("Operation",{type:b.FormFieldType.datetime,readonly:!0}),ie("Operation"),x("design:type",Date)],t.prototype,"_createdAt",void 0),A([oe("Operation",{type:b.FormFieldType.number,readonly:!0}),ie("Operation"),x("design:type",Number)],t.prototype,"count",void 0),t=A([re({className:"Operation",collectionName:"operation",fields:["*"],include:[]})],t)}(b.IOperation),no=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Product",{type:b.FormFieldType.text,visible:!1,forceExport:!0,exportOrder:1}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("Product",{type:b.FormFieldType.autocomplete,collectionName:"catalogs",forceExport:!0,exportOrder:2,required:!0,columnDefinition:{name:"title"},filterable:!0}),x("design:type",Object)],t.prototype,"catalog",void 0),A([oe("Product",{required:!0,type:b.FormFieldType.text,exportOrder:3,filterable:!0,sortable:!0}),ie("Product"),x("design:type",String)],t.prototype,"title",void 0),A([oe("Product",{type:b.FormFieldType.text,exportOrder:4,filterable:!0,sortable:!0}),ie("Product"),x("design:type",String)],t.prototype,"reference",void 0),A([oe("Product",{flex:50,type:b.FormFieldType.text,exportOrder:10,filterable:!0,sortable:!0}),x("design:type",String)],t.prototype,"color",void 0),A([oe("Product",{required:!1,flex:50,type:b.FormFieldType.number,exportOrder:9}),x("design:type",Number)],t.prototype,"price",void 0),A([oe("Product",{flex:50,type:b.FormFieldType.number,min:0,exportOrder:8}),x("design:type",Number)],t.prototype,"step",void 0),A([oe("Product",{type:b.FormFieldType.checkbox,flex:50,columnDefinition:{width:40},exportOrder:11,filterable:!0}),x("design:type",Boolean)],t.prototype,"outofstock",void 0),A([oe("Product",{type:b.FormFieldType.autocomplete,isImage:!0,filters:Fe,forceModal:!0,hiddenFields:["mimeType"],mode:"tile",pageSize:20,fixedPosition:!0,maxWidth:600,maxHeight:300,crop:"square",collectionName:"files",title:"PHOTO",columnDefinition:{name:"_downloadURL"},filterable:!1,exportOrder:7}),x("design:type",Object)],t.prototype,"image",void 0),A([oe("Product",{type:b.FormFieldType.textarea,exportOrder:5}),x("design:type",String)],t.prototype,"description",void 0),A([oe("Product",{type:b.FormFieldType.textarea,exportOrder:6}),x("design:type",String)],t.prototype,"shortdescription",void 0),A([oe("Product",{type:b.FormFieldType.autocomplete,tag:!0,allowCustomTag:!0,collectionName:"products",multiple:!0,icon:"yo-flag",subQuery:{field:"fileRef",values:"_id"},exportOrder:12,filterable:!0}),ie("Product"),x("design:type",Array)],t.prototype,"tags",void 0),t=A([re({className:"Product",collectionName:"products",fields:["*"],include:["catalog"],icon:"yo-product"})],t)}(b.IProduct),ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("PublicApiToken",{type:b.FormFieldType.textarea,readonly:!0,name:"accessToken.id"}),x("design:type",Object)],t.prototype,"accessToken",void 0),t=A([re({className:"PublicApiToken",collectionName:"publicAPITokens",fields:["*"],include:["user"],icon:"yo-badge"})],t)}(b.IPublicApiToken),so=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Slide",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"title",void 0),A([oe("Slide",{type:b.FormFieldType.textarea}),x("design:type",String)],t.prototype,"description",void 0),A([oe("Slide",{type:b.FormFieldType.checkbox,flex:100,advanced:!0}),x("design:type",Boolean)],t.prototype,"hideheader",void 0),A([oe("Slide",{type:b.FormFieldType.checkbox,flex:100,condition:[j.hasService],advanced:!0}),x("design:type",Boolean)],t.prototype,"service",void 0),A([oe("Slide",{type:b.FormFieldType.autocomplete,multiple:!0,clearable:!0,advanced:!0}),x("design:type",Object)],t.prototype,"condition",void 0),t=A([re({className:"Slide"})],t)}(b.ISlide),lo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Tableau",{type:b.FormFieldType.text,required:!0,title:"DASHBOARDID"}),ie("Tableau"),x("design:type",String)],t.prototype,"path",void 0),A([oe("Tableau",{required:!0,title:"TENANT",type:b.FormFieldType.autocomplete,collectionName:"tenants",columnDefinition:{name:"name"},multiple:!1,condition:[j.isAdmin]}),x("design:type",Se)],t.prototype,"_tenant",void 0),t=A([re({className:"Tableau",collectionName:"tableau",fields:["*"],include:["_tenant"],icon:"yo-tableau"})],t)}(b.ITableau),po=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("TagGroup",{required:!0,type:b.FormFieldType.text}),ie("TagGroup"),x("design:type",String)],t.prototype,"title",void 0),A([oe("TagGroup",{title:"LOCATIONTAGS",required:!0,type:b.FormFieldType.autocomplete,tag:!0,collectionName:"locations",multiple:!0,subQuery:{field:"locationRef",values:"_id"},fixedPosition:!0}),x("design:type",Array)],t.prototype,"tags",void 0),A([oe("TagGroup",{title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1,required:!0,fixedPosition:!0}),x("design:type",Object)],t.prototype,"group",void 0),t=A([re({className:"TagGroup",collectionName:"tagGroups",fields:["*"],include:[]})],t)}(b.ITagGroup),uo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([ie("Tag"),x("design:type",String)],t.prototype,"tag",void 0),t=A([re({className:"Tag",collectionName:"tags",fields:["*"],include:[]})],t)}(b.ITag);function co(){this.selectMatch(this.session.user)}var yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Todo",{type:b.FormFieldType.text,name:"title",required:!0}),x("design:type",String)],t.prototype,"title",void 0),A([oe("Todo",{title:"ASSIGNTO",name:"user",type:b.FormFieldType.autocomplete,collectionName:"user",queryFields:qe.getSimpleFields(),multiple:!1,required:!0,extraButton:{title:"ASSIGNTO",buttons:[{text:"ME",handler:co}]}}),x("design:type",Object)],t.prototype,"user",void 0),A([oe("Todo",{title:"DUEDATE",type:b.FormFieldType.datetime,required:!1,clearable:!0,minDate:new Date,secondary:!0,icon:"yo-calendar"}),x("design:type",Date)],t.prototype,"duedate",void 0),A([oe("Todo",{title:"NOTIFICATIONEMAILS",type:b.FormFieldType.emailreport,showUsers:!0,secondary:!0,icon:"yo-email"}),x("design:type",Array)],t.prototype,"notificationemail",void 0),A([oe("Todo",{title:"REMINDER",type:b.FormFieldType.datetime,required:!1,clearable:!0,secondary:!0,icon:"yo-activity"}),x("design:type",Date)],t.prototype,"reminderdate",void 0),A([oe("Todo",{type:b.FormFieldType.starrating,secondary:!0,icon:"yo-priority"}),x("design:type",Number)],t.prototype,"priority",void 0),t=A([re({className:"Todo"})],t)}(b.ITodo),fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("TodoTask",{type:b.FormFieldType.text,title:"TITLE",required:!0}),x("design:type",Object)],t.prototype,"text",void 0),A([oe("TodoTask",{type:b.FormFieldType.textarea,required:!1}),x("design:type",Object)],t.prototype,"comments",void 0),A([oe("TodoTask",{type:b.FormFieldType.datetime,required:!1,clearable:!0,minDate:new Date}),x("design:type",Object)],t.prototype,"duedate",void 0),A([oe("TodoTask",{type:b.FormFieldType.toggle,required:!1,title:"PHOTO",flex:50}),x("design:type",Object)],t.prototype,"hasphoto",void 0),A([oe("TodoTask",{type:b.FormFieldType.toggle,required:!1,title:"MANDATORYPHOTO",flex:50,condition:"hasphoto.value==1"}),x("design:type",Object)],t.prototype,"isphotorequired",void 0),A([oe("TodoTask",{type:b.FormFieldType.toggle,required:!1,title:"ALLOWLIBRARY",flex:50,condition:"hasphoto.value==1"}),x("design:type",Object)],t.prototype,"allowLibrary",void 0),t=A([re({className:"TodoTask"})],t)}(b.ITodoTask),go=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("TodoTaskSimple",{type:b.FormFieldType.textarea,title:"DESCRIPTION",required:!0}),x("design:type",Object)],t.prototype,"text",void 0),A([oe("TodoTaskSimple",{title:"ASSIGNTO",name:"user",type:b.FormFieldType.autocomplete,queryFields:qe.getSimpleFields(),collectionName:"user",multiple:!1,required:!0,extraButton:{title:"ASSIGNTO",buttons:[{text:"ME",handler:co}]}}),x("design:type",Object)],t.prototype,"user",void 0),A([oe("TodoTaskSimple",{type:b.FormFieldType.datetime,required:!1,clearable:!0,minDate:new Date}),x("design:type",Object)],t.prototype,"duedate",void 0),A([oe("TodoTaskSimple",{type:b.FormFieldType.toggle,required:!1,title:"ASKFORPHOTO",flex:50}),x("design:type",Object)],t.prototype,"hasphoto",void 0),A([oe("TodoTaskSimple",{type:b.FormFieldType.toggle,required:!1,title:"MANDATORYPHOTO",flex:50,condition:"hasphoto.value==1"}),x("design:type",Object)],t.prototype,"isphotorequired",void 0),A([oe("TodoTaskSimple",{type:b.FormFieldType.toggle,required:!1,title:"ALLOWLIBRARY",flex:50,condition:"hasphoto.value==1"}),x("design:type",Object)],t.prototype,"allowLibrary",void 0),t=A([re({className:"TodoTaskSimple"})],t)}(b.ITodoTaskSimple);function mo(o,e,t){var i=t.get(k),r=o.language,n=o.value;if(n&&r)return o[r]=n,We.getAll(n,r,i).toPromise().then(function(e){var t=T.capitalize(n)===n;e.forEach(function(e){o[e.language]=t?T.capitalize(e.value):e.value})})}function ho(t,e){m.Translate.availablesLanguage.filter(function(e){return"key"!==e}).forEach(function(e){t[e]=null}),t=O({},t)}var vo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("Translation",{title:"ID",visible:!1,forceExport:!0}),x("design:type",String)],t.prototype,"_id",void 0),A([oe("Translation",{type:b.FormFieldType.autocomplete,title:"LANGUAGE",translate:!0,values:m.Translate.availablesLanguage,clearable:!1,required:!0,autoselect:!0,columnDefinition:{width:40}}),x("design:type",String)],t.prototype,"language",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),ie("Translation"),x("design:type",String)],t.prototype,"key",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"value",void 0),A([oe("Translation",{type:b.FormFieldType.button,title:"TRANSLATE",color:"success",suppressExport:!0,handler:mo}),x("design:type",Object)],t.prototype,"translateButton",void 0),A([oe("Translation",{type:b.FormFieldType.button,title:"RESET",suppressExport:!0,color:"danger",handler:ho}),x("design:type",Object)],t.prototype,"resetButton",void 0),A([oe("Translation",{type:b.FormFieldType.toggle,title:"UNVALIDATEREASON"}),x("design:type",Boolean)],t.prototype,"isReject",void 0),A([oe("Translation",{type:b.FormFieldType.toggle,title:"ANNOTATE"}),x("design:type",Boolean)],t.prototype,"isPhotoAnnotation",void 0),A([oe("Translation",{title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"groups",filters:[[{field:"isRole",operator:{_id:"neq"},value:!0},{field:"type",operator:{_id:"nin"},value:["plan"]}]],hiddenFields:["isRole","type"],idOnly:!0,mapTransform:fe,multiple:!0,clearable:!1,required:!0}),x("design:type",Object)],t.prototype,"group",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"en",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"us",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"fr",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"es",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"pl",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"nl",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"de",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"it",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"ru",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"zhs",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"zht",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"pt",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"kr",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"ja",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"ua",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"he",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"ar",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"cz",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"th",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"tr",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"bg",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"el",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"sl",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"sk",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"ro",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"hu",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"et",void 0),A([oe("Translation",{required:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"br",void 0),t=A([re({className:"Translation",collectionName:"translations",fields:["*"],include:["_tenant"],icon:"yo-translate"})],t)}(b.ITranslation),bo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("WorkplaceGroups",{readonly:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"name",void 0),A([oe("WorkplaceGroups",{readonly:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"icon",void 0),A([oe("WorkplaceGroups",{readonly:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"cover",void 0),A([oe("WorkplaceGroups",{readonly:!0,type:b.FormFieldType.text}),x("design:type",String)],t.prototype,"description",void 0),t=A([re({className:"WorkplaceGroups",collectionName:"workplace_groups",fields:["*"],include:[]})],t)}(b.IWorkplaceGroups),Fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),A([oe("WorkplacePost",{type:b.FormFieldType.textarea,required:!0}),x("design:type",String)],t.prototype,"comments",void 0),A([oe("WorkplacePost",{title:"GROUPS",type:b.FormFieldType.autocomplete,collectionName:"workplace_groups",multiple:!0,required:!0}),x("design:type",Object)],t.prototype,"workplaceGroups",void 0),t=A([re({className:"WorkplacePost"})],t)}(b.IWorkplacePost),To=function(){function e(e,t){this.broker=e,this.rq=t}return e.prototype._viewOrLike=function(e,t,o){var i=this.broker.getApiUrl()+"activity/"+o;return this.rq.post(i,{entityRef:e._id,entityName:t})},e.prototype.getActionFilter=function(e,t){return void 0===t&&(t="view"),[[{field:"action",operator:{_id:"eq"},value:t},{field:"entityRef",operator:{_id:"inq"},value:[e]}]]},e.prototype.getUserTransform=function(){return function(e){return e.data&&(e.data=e.data.map(function(e){return e.user})),e}},e.prototype.getActionAggregateOptions=function(){return function(e,t){return D([{$lookup:{from:"user",localField:"userRef",foreignField:"_id",as:"user"}},{$unwind:"$user"}],0<e?[{$skip:e}]:[],0<t?[{$limit:t}]:[])}},e.decorators=[{type:h.Injectable}],e.ctorParameters=function(){return[{type:ee},{type:k}]},e}(),So=function(){function e(e,t,o,i,r,n,a){void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),this.broker=e,this._currentPage=0,this._total=0,this._collectionName="",this._loading=!1,this._collectionName=G.fixCollectionName(t),this._items=o,this._translate=r,this._looseCount=a,i&&T.isNumber(i)&&0<i?this._pageSize=i:this._pageSize=21,this.filterPipe=new Ct(n)}return Object.defineProperty(e.prototype,"pageSize",{get:function(){return this._pageSize},set:function(e){this._pageSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._total},set:function(e){this._total=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalPage",{get:function(){return Math.ceil(this._total/this.pageSize)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this._loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingPageCount",{get:function(){return this._loadingPageCount},set:function(e){this._loadingPageCount=e},enumerable:!0,configurable:!0}),e.prototype.loadWithSearch=function(e,t,o,i,r,n,a,s,l,p,u,c,d,y,f){return void 0===e&&(e=0),void 0===t&&(t=null),void 0===o&&(o=[]),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===a&&(a=!1),void 0===s&&(s=null),void 0===l&&(l=null),void 0===p&&(p=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===y&&(y=null),void 0===f&&(f=!1),this.load(e,t,o,i,r,n,a,s,l,p,u,c,d,y,f)},e.prototype.loadWithSearchDebounce=function(t,e,o,i,r,n,a,s,l,p,u,c,d,y,f){var g=this;return void 0===t&&(t=0),void 0===e&&(e=null),void 0===o&&(o=[]),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===a&&(a=!1),void 0===s&&(s=null),void 0===l&&(l=null),void 0===p&&(p=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===y&&(y=null),void 0===f&&(f=!1),e?e.pipe(F.debounceTime(400),F.distinctUntilChanged(),F.switchMap(function(e){return g.load(t,e.toString(),o,i,r,n,a,s,l,p,u,c,d,y,f)})):this.load(t,null,o,i,r,n,a,s,l,p,u,c,d,y,f)},e.prototype.load=function(i,r,t,n,o,e,a,s,l,p,u,c,d,y,f){var g=this;if(void 0===i&&(i=0),void 0===r&&(r=null),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===o&&(o=null),void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===s&&(s=null),void 0===l&&(l=null),void 0===p&&(p=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===y&&(y=null),void 0===f&&(f=!1),this._loading=!0,r&&(r=r.trim()),this._items&&0<this._items.length||!this._collectionName||T.isEmpty(this._collectionName)){var m=new v.Observable(function(e){var t=g._items||[];r&&(t=g.filterPipe.transform(t,r,null,null,g._translate)),n&&(t=T.orderBy(t,n.map(function(e){return e.colId}),n.map(function(e){return e.sort.toLowerCase()}))),g._total=t.length,g._currentPage=i,t.slice&&(t=t.slice(i*g.pageSize,(i+1)*g.pageSize));var o={count:g._total,data:t.map?t.map(function(e){return g.convertItem(e)}):[]};e.next(o),e.complete()});return e&&o?m.pipe(F.mergeMap(function(e){return o(e,r,t,i,g.pageSize)})):o?m.pipe(F.map(function(e){return o(e,r,t,i,g.pageSize)})):m}if(u&&T.isFunction(u))return o||(o=function(e){return e}),this.broker.aggregateQuery(this._collectionName,t,u(i*this.pageSize,this.pageSize,n,r,t),r,null,f,d,y,s,c&&T.isFunction(c)?c(i*this.pageSize,this.pageSize,n,r,t):null).pipe(e?F.mergeMap(function(e){return o(e,r,t,i,g.pageSize)}):F.map(function(e){return o(e,r,t,i,g.pageSize)})).pipe(F.map(function(e){return g._currentPage=i,f?g._total=e.count:T.isObject(e)&&T.isArray(e.data)||(e={data:e}),g._loading=!1,e}));var h=this.broker.getAll(this._collectionName,l,p,r,t,n,i*this.pageSize,this.pageSize,a,s,y,d,this._looseCount,!f).pipe(F.map(function(e){return g._currentPage=i,g._loading=!1,f?(g._total=e.count,e):(g._total=Math.max(-1,g._total),{count:g._total,data:e})}));return e&&o?h.pipe(F.mergeMap(function(e){return o(e,r,t,i,g.pageSize)})):o?h.pipe(F.map(function(e){return o(e,r,t,i,g.pageSize)})):h},e.prototype.getQuery=function(e,t,o,i,r,n,a,s,l){return void 0===e&&(e=0),void 0===o&&(o=[]),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=!1),this.broker.getQuery(this._collectionName,n,a,t,o,i,e*this.pageSize,this.pageSize,r,s)},e.prototype.getCount=function(e,t,o,i){var r=this;return void 0===o&&(o=null),void 0===i&&(i=null),this.broker.getCount(this._collectionName,e,t,o,i).pipe(F.map(function(e){return r._total=e.count,e}))},e.prototype.convertItem=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?new Kt(e):T.isEqual(T.keys(e),["_id"])?new Kt(e._id):void 0===e?new Kt("undefined"):e},e}();e.DataCoreModule=Nt,e.DashboardCore=Qe,e.Editable=oe,e.Mapping=Oe,e.Model=re,e.ModelExtended=function xo(t){return function(e){G.addBaseModel(t.extendedClass,t.baseClass,e)}},e.Searchable=ie,e.AggregateLog=Et,e.Algorithm=wt,e.AutorenewConfig=kt,e.Backup=Lt,e.CACHE_KEYS=q,e.Catalog=qt,e.onChartMissionFieldsChange=Qt,e.CHART_TYPES=Rt,e.CHART_DATEGROUPINGBY=Pt,e.CHART_SHOW_AS=Ut,e.CHART_DATETIMEFORMAT=Mt,e.CHART_TIMESCALE=Bt,e.ChartDefinition=zt,e.getGroupsTransform=fe,e.isNotInformationField=ge,e.getFormFieldValues=me,e.CONDITION_TYPES=U,e.ROLES=M,e.ROLES_ASK=B,e.ROLES_CONDITIONS=j,e.Condition=he,e.ConditionalField=ve,e.CONDITION_ALL_OPERATORS=["equals","notequals","in","notin","greaterthan","lessthan"],e.SIMPLE_FIELD_TYPES=["text","email","number","date","tel","time","range","starrating"],e.WITH_VALUES_FIELD_TYPES=["checkbox","toggle","select","selectmulti","selectbuttons","selectbuttonsmulti","autocomplete"],e.ADMIN_FILES_TYPE=["locations","user","geofilters","campaignfilters","products","locationtypes"],e.FORMCREATOR_FILES_TYPE=["pages"],e.FORM_FILES_IMAGE_MIME=be,e.FORM_FILES_IMAGE_FILTER=Fe,e.FORM_FILES_GROUP_FILTER=Te,e.Currency=Wt,e.Dashboard=Yt,e.Entity=Kt,e.onUrlChange=Jt,e.File=Xt,e.Folder=Zt,e.FileOrFolder=eo,e.Group=Tt,e.BaseKpi=oo,e.LocationType=_e,e.onAddressChange=xe,e.onTypeChange=Ce,e.LOCATION_GEOCODESTATUS=Ae,e.Location=De,e.IMapping=io,e.onMissionDescriptionTypeChange=lt,e.MISSION_TYPES_NO_ADMIN=["mission"],e.MISSION_TYPES=Ze,e.MISSION_STATUS=et,e.MissionDescription=pt,e.MissionDescriptionCreate=ut,e.MissionDescriptionSchedule=ct,e.MissionDescriptionNotifications=dt,e.MissionDescriptionSettings=yt,e.Scoring=gt,e.IModel=P,e.Notification=Ue,e.Operation=ro,e.Product=no,e.PublicApiToken=ao,e.ResponseObject=Z,e.Slide=so,e.Tableau=lo,e.TagGroup=po,e.Tag=uo,e.Tenant=Se,e.onUserMeActionHandler=co,e.Todo=yo,e.TodoTask=fo,e.TodoTaskSimple=go,e.translateButtonHandler=mo,e.resetButtonHandler=ho,e.Translation=vo,e.onUserLocationChange=Le,e.User=qe,e.UserSettings=Re,e.SimpleUser=Pe,e.WorkplaceGroups=bo,e.WorkplacePost=Fo,e.FilterPipe=Ct,e.Activity=To,e.Algorithms=L,e.AuthenticationGuard=je,e.CanDeactivateGuard=Ge,e.Authentication=Be,e.CurrentSessionResolver=Ve,e.BackupService=$e,e.Box=J,e.Blog=He,e.getStartAndEndDates=te,e.Broker=ee,e.PlatformService=Ke,e.Config=I,e.Cache=R,e.DataLoader=So,e.Files=K,e.FilesBroker=ze,e.Googlemaps=W,e.Googletranslate=We,e.HttpCustomInterceptor=Ye,e.LoadingBarEventType=N,e.LoadingBarEvent=E,e.LoadingBar=w,e.Locations=Je,e.Loopback=Xe,e.Missiondescriptions=mt,e.Models=G,e.Print=ht,e.Push=Me,e.Requestor=k,e.Security=St,e.Session=t,e.Smartloc=$,e.Tenants=_t,e.Unsplash=X,e.Users=Ot,e.Version=At,e.Workplace=Y,e.Xlsx=xt,e.ɵa=to,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=data-core.umd.min.js.map